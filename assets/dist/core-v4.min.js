var MD5=function(string){function RotateLeft(lValue,iShiftBits){return lValue<<iShiftBits|lValue>>>32-iShiftBits}function AddUnsigned(lX,lY){var lX4,lY4,lX8,lY8,lResult;lX8=lX&2147483648;lY8=lY&2147483648;lX4=lX&1073741824;lY4=lY&1073741824;lResult=(lX&1073741823)+(lY&1073741823);if(lX4&lY4){return lResult^2147483648^lX8^lY8}if(lX4|lY4){if(lResult&1073741824){return lResult^3221225472^lX8^lY8}else{return lResult^1073741824^lX8^lY8}}else{return lResult^lX8^lY8}}function F(x,y,z){return x&y|~x&z}function G(x,y,z){return x&z|y&~z}function H(x,y,z){return x^y^z}function I(x,y,z){return y^(x|~z)}function FF(a,b,c,d,x,s,ac){a=AddUnsigned(a,AddUnsigned(AddUnsigned(F(b,c,d),x),ac));return AddUnsigned(RotateLeft(a,s),b)}function GG(a,b,c,d,x,s,ac){a=AddUnsigned(a,AddUnsigned(AddUnsigned(G(b,c,d),x),ac));return AddUnsigned(RotateLeft(a,s),b)}function HH(a,b,c,d,x,s,ac){a=AddUnsigned(a,AddUnsigned(AddUnsigned(H(b,c,d),x),ac));return AddUnsigned(RotateLeft(a,s),b)}function II(a,b,c,d,x,s,ac){a=AddUnsigned(a,AddUnsigned(AddUnsigned(I(b,c,d),x),ac));return AddUnsigned(RotateLeft(a,s),b)}function ConvertToWordArray(string){var lWordCount;var lMessageLength=string.length;var lNumberOfWords_temp1=lMessageLength+8;var lNumberOfWords_temp2=(lNumberOfWords_temp1-lNumberOfWords_temp1%64)/64;var lNumberOfWords=(lNumberOfWords_temp2+1)*16;var lWordArray=Array(lNumberOfWords-1);var lBytePosition=0;var lByteCount=0;while(lByteCount<lMessageLength){lWordCount=(lByteCount-lByteCount%4)/4;lBytePosition=lByteCount%4*8;lWordArray[lWordCount]=lWordArray[lWordCount]|string.charCodeAt(lByteCount)<<lBytePosition;lByteCount++}lWordCount=(lByteCount-lByteCount%4)/4;lBytePosition=lByteCount%4*8;lWordArray[lWordCount]=lWordArray[lWordCount]|128<<lBytePosition;lWordArray[lNumberOfWords-2]=lMessageLength<<3;lWordArray[lNumberOfWords-1]=lMessageLength>>>29;return lWordArray}function WordToHex(lValue){var WordToHexValue="",WordToHexValue_temp="",lByte,lCount;for(lCount=0;lCount<=3;lCount++){lByte=lValue>>>lCount*8&255;WordToHexValue_temp="0"+lByte.toString(16);WordToHexValue=WordToHexValue+WordToHexValue_temp.substr(WordToHexValue_temp.length-2,2)}return WordToHexValue}function Utf8Encode(string){string=string.replace(/\r\n/g,"\n");var utftext="";for(var n=0;n<string.length;n++){var c=string.charCodeAt(n);if(c<128){utftext+=String.fromCharCode(c)}else if(c>127&&c<2048){utftext+=String.fromCharCode(c>>6|192);utftext+=String.fromCharCode(c&63|128)}else{utftext+=String.fromCharCode(c>>12|224);utftext+=String.fromCharCode(c>>6&63|128);utftext+=String.fromCharCode(c&63|128)}}return utftext}var x=Array();var k,AA,BB,CC,DD,a,b,c,d;var S11=7,S12=12,S13=17,S14=22;var S21=5,S22=9,S23=14,S24=20;var S31=4,S32=11,S33=16,S34=23;var S41=6,S42=10,S43=15,S44=21;string=Utf8Encode(string);x=ConvertToWordArray(string);a=1732584193;b=4023233417;c=2562383102;d=271733878;for(k=0;k<x.length;k+=16){AA=a;BB=b;CC=c;DD=d;a=FF(a,b,c,d,x[k+0],S11,3614090360);d=FF(d,a,b,c,x[k+1],S12,3905402710);c=FF(c,d,a,b,x[k+2],S13,606105819);b=FF(b,c,d,a,x[k+3],S14,3250441966);a=FF(a,b,c,d,x[k+4],S11,4118548399);d=FF(d,a,b,c,x[k+5],S12,1200080426);c=FF(c,d,a,b,x[k+6],S13,2821735955);b=FF(b,c,d,a,x[k+7],S14,4249261313);a=FF(a,b,c,d,x[k+8],S11,1770035416);d=FF(d,a,b,c,x[k+9],S12,2336552879);c=FF(c,d,a,b,x[k+10],S13,4294925233);b=FF(b,c,d,a,x[k+11],S14,2304563134);a=FF(a,b,c,d,x[k+12],S11,1804603682);d=FF(d,a,b,c,x[k+13],S12,4254626195);c=FF(c,d,a,b,x[k+14],S13,2792965006);b=FF(b,c,d,a,x[k+15],S14,1236535329);a=GG(a,b,c,d,x[k+1],S21,4129170786);d=GG(d,a,b,c,x[k+6],S22,3225465664);c=GG(c,d,a,b,x[k+11],S23,643717713);b=GG(b,c,d,a,x[k+0],S24,3921069994);a=GG(a,b,c,d,x[k+5],S21,3593408605);d=GG(d,a,b,c,x[k+10],S22,38016083);c=GG(c,d,a,b,x[k+15],S23,3634488961);b=GG(b,c,d,a,x[k+4],S24,3889429448);a=GG(a,b,c,d,x[k+9],S21,568446438);d=GG(d,a,b,c,x[k+14],S22,3275163606);c=GG(c,d,a,b,x[k+3],S23,4107603335);b=GG(b,c,d,a,x[k+8],S24,1163531501);a=GG(a,b,c,d,x[k+13],S21,2850285829);d=GG(d,a,b,c,x[k+2],S22,4243563512);c=GG(c,d,a,b,x[k+7],S23,1735328473);b=GG(b,c,d,a,x[k+12],S24,2368359562);a=HH(a,b,c,d,x[k+5],S31,4294588738);d=HH(d,a,b,c,x[k+8],S32,2272392833);c=HH(c,d,a,b,x[k+11],S33,1839030562);b=HH(b,c,d,a,x[k+14],S34,4259657740);a=HH(a,b,c,d,x[k+1],S31,2763975236);d=HH(d,a,b,c,x[k+4],S32,1272893353);c=HH(c,d,a,b,x[k+7],S33,4139469664);b=HH(b,c,d,a,x[k+10],S34,3200236656);a=HH(a,b,c,d,x[k+13],S31,681279174);d=HH(d,a,b,c,x[k+0],S32,3936430074);c=HH(c,d,a,b,x[k+3],S33,3572445317);b=HH(b,c,d,a,x[k+6],S34,76029189);a=HH(a,b,c,d,x[k+9],S31,3654602809);d=HH(d,a,b,c,x[k+12],S32,3873151461);c=HH(c,d,a,b,x[k+15],S33,530742520);b=HH(b,c,d,a,x[k+2],S34,3299628645);a=II(a,b,c,d,x[k+0],S41,4096336452);d=II(d,a,b,c,x[k+7],S42,1126891415);c=II(c,d,a,b,x[k+14],S43,2878612391);b=II(b,c,d,a,x[k+5],S44,4237533241);a=II(a,b,c,d,x[k+12],S41,1700485571);d=II(d,a,b,c,x[k+3],S42,2399980690);c=II(c,d,a,b,x[k+10],S43,4293915773);b=II(b,c,d,a,x[k+1],S44,2240044497);a=II(a,b,c,d,x[k+8],S41,1873313359);d=II(d,a,b,c,x[k+15],S42,4264355552);c=II(c,d,a,b,x[k+6],S43,2734768916);b=II(b,c,d,a,x[k+13],S44,1309151649);a=II(a,b,c,d,x[k+4],S41,4149444226);d=II(d,a,b,c,x[k+11],S42,3174756917);c=II(c,d,a,b,x[k+2],S43,718787259);b=II(b,c,d,a,x[k+9],S44,3951481745);a=AddUnsigned(a,AA);b=AddUnsigned(b,BB);c=AddUnsigned(c,CC);d=AddUnsigned(d,DD)}var temp=WordToHex(a)+WordToHex(b)+WordToHex(c)+WordToHex(d);return temp.toLowerCase()};var W30sHelper=function(){return W30sHelper.fn.init()};W30sHelper.fn=W30sHelper.prototype={init:function(){},initToolTip:function($html,config){if($.fn.tooltip){config=$.extend(true,{},{placement:"top",trigger:"hover",html:true},config||{});if(_.isUndefined($html)){$html=$('[data-toggle="tooltip"]')}else{$html=$html.find('[data-toggle="tooltip"]')}$html.each(function(idx,el){$(el).tooltip($.extend(true,{},config,$(el).data()))});$html.on("show.bs.tooltip",function(){$(".tooltip").remove()})}},scrollToElement($scollTo,top=0,speed){if(typeof $scollTo!="undefined"&&$scollTo.length>0){let $container=$("html, body");let scrollTop=$scollTo.offset().top-$container.offset().top-top;let option={duration:speed||800,easing:"swing",queue:true,progress:e=>{let newTop=null;$(".w30s-section.position-fixed").each((idx,el)=>{let topTpm=$(el).position().top+$(el).outerHeight();if(newTop<topTpm||newTop===null){newTop=topTpm}});if(newTop!==null&&top!==newTop){$container.stop(true);this.scrollToElement($scollTo,newTop,speed)}}};$container.animate({scrollTop:scrollTop,scrollLeft:0},option)}},getParamFromUrl(url){url=url.split("?");let items=url[1]!==undefined?url[1].split("&"):[];return items.reduce((data,item)=>{let[key,value]=item.split("=");key=decodeURIComponent(key);if(data[key]!==undefined){if(!Array.isArray(data[key])){data[key]=[data[key]]}data[key].push(decodeURIComponent(value))}else{data[key]=decodeURIComponent(value)}return data},{})},formatSeoUrl:function(str){str=typeof str=="undefined"?"":str;str=str.toLowerCase();str=str.trim();str=str.replace(/à|á|ạ|ả|ã|â|ầ|ấ|ậ|ẩ|ẫ|ă|ằ|ắ|ặ|ẳ|ẵ/g,"a");str=str.replace(/è|é|ẹ|ẻ|ẽ|ê|ề|ế|ệ|ể|ễ/g,"e");str=str.replace(/ì|í|ị|ỉ|ĩ/g,"i");str=str.replace(/ò|ó|ọ|ỏ|õ|ô|ồ|ố|ộ|ổ|ỗ|ơ|ờ|ớ|ợ|ở|ỡ/g,"o");str=str.replace(/ù|ú|ụ|ủ|ũ|ư|ừ|ứ|ự|ử|ữ/g,"u");str=str.replace(/ỳ|ý|ỵ|ỷ|ỹ/g,"y");str=str.replace(/đ/g,"d");str=str.replace(/!|@|%|\^|\*|\(|\)|\+|\=|\<|\>|\?|\/|,|\.|\:|\;|\'| |\"|\&|\#|\[|\]|~|$|_/g,"-");str=str.replace(/-+-/g,"-");str=str.replace(/^\-+|\-+$/g,"");return str},addCommas:function(nStr){nStr+="";x=nStr.split(".");x1=x[0];x2=x.length>1?","+x[1]:"";var rgx=/(\d+)(\d{3})/;while(rgx.test(x1)){x1=x1.replace(rgx,"$1"+","+"$2")}return x1+x2},handleFormatPrice:function($html){var myvalue=$html.val();myvalue=parseInt(myvalue.replace(/[^0-9]/g,""));myvalue=isNaN(myvalue)?0:myvalue;myvalue=this.addCommas(myvalue);$html.val(myvalue)},loadCss(url,id){let link=document.createElement("link");link.type="text/css";link.rel="stylesheet";link.href=url;link.id=id;document.getElementsByTagName("head")[0].appendChild(link)},loadScriptExternal:function(p){let s="script";let js,sjs=document.getElementsByTagName(s)[0];if(document.getElementById(p.id)){if(p.callback){p.callback()}return}js=document.createElement(s);js.id=p.id;js.src=p.src;js.onload=p.callback;sjs.parentNode.insertBefore(js,sjs)},parseFloat(value,defaultValue){defaultValue=defaultValue?defaultValue:0;value=parseFloat(value);return isNaN(value)?defaultValue:value},parseInt(value,defaultValue){defaultValue=defaultValue?defaultValue:0;value=parseInt(value);return isNaN(value)?defaultValue:value},parseString(value,defaultValue){defaultValue=defaultValue?defaultValue:"";return _.isUndefined(value)||value==null?defaultValue:value},merge(target,...sources){const self=this;if(typeof target==="undefined"){target={}}$.each(sources,(idx,source)=>{if(source!==null&&typeof source!="undefined"){for(const key of Object.keys(source)){if(source[key]instanceof Object){Object.assign(source[key],self.merge(target[key],source[key]))}}Object.assign(target||{},source)}});return target},getCss($html){var sheets=document.styleSheets;var o={};for(var i in sheets){var rules=sheets[i].rules()||sheets[i].cssRules();for(var r in rules){if($html.is(rules[r].selectorText)){o=$.extend(o,this.css2json(rules[r].style),this.css2json($html.attr("style")))}}}return o},css2json(css){let s={};if(!css)return s;if(css instanceof CSSStyleDeclaration){for(let i in css){if(css[i].toLowerCase){s[css[i].toLowerCase()]=css[css[i]]}}}else if(typeof css=="string"){css=css.split("; ");for(let i in css){let l=css[i].split(": ");s[l[0].toLowerCase()]=l[1]}}return s},fixStringJson(s){s=s.replace(/\\n/g,"\\n").replace(/\\'/g,"\\'").replace(/\\"/g,'\\"').replace(/\\&/g,"\\&").replace(/\\r/g,"\\r").replace(/\\t/g,"\\t").replace(/\\b/g,"\\b").replace(/\\f/g,"\\f");return s.replace(/[\u0000-\u0019]+/g,"")}};var W30sCore=function(){return W30sCore.fn.init()};W30sCore.fn=W30sCore.prototype={template:null,loader:null,helper:null,config:{CURRENCY_VND:"vnd",CURRENCY_USD:"usd",currency_symbol:"đ",currency_type:0,position:"before",urlAddFormContact:"/contact/sendFormInformationV3Json",selectorLazyLoad:".w30s__lazyload",classLazyLoad:"w30s__lazyload",selectorImageCaptcha:".w30s-box-captcha .img-captcha",selectorRefreshCaptchaBtn:".w30s-btn-refresh-captcha",selectorFormInformation:".w30s-form-information-v3"},init:function(){},setup:function(){this.loader=new W30sLoader;this.helper=new W30sHelper;this.template=new W30sTemplate},initWebshopCurreny:function(data){if(data.hasOwnProperty("currency_type")){this.config.currency_type=data.currency_type}if(data.hasOwnProperty("currency_symbol")){this.config.currency_symbol=data.currency_symbol}if(data.hasOwnProperty("position")){this.config.position=data.position}},initDeniedCopy(){$("body").on("contextmenu",function(e){return false}).bind("cut copy paste",function(e){e.preventDefault();return false})},initLazyLoad:function(){$(this.config.selectorLazyLoad+","+"img[data-lazy='"+this.config.classLazyLoad+"']").lazyload({effect:"fadeIn",failure_limit:9999})},confirmPromise:function(config){config=$.extend(true,{text:"confrim",type:"warning",allowOutsideClick:false,allowEscapeKey:false,showCancelButton:true},config||{});return new Promise(resolve=>{new swal(config).then(resultSwal=>{resolve(resultSwal)})})},showSuccess:function(msg,timer,config){if(!config){config={}}config=$.extend(true,{background:"#00a65a",position:"top"},config);if(typeof timer!="undefined"){config.timer=timer}this.showMessage(msg,"success",config)},showError:function(msg,timer){var config={position:"top",background:"#dd4b39"};if(typeof timer!="undefined"){config.timer=timer}this.showMessage(msg,"error",config)},showWarning:function(msg,config){this.showMessage(msg,"warning",config)},showMessage:function(msg,type,config){var toast=swal.mixin($.extend(true,{toast:true,position:"top-end",showConfirmButton:false,showClass:{popup:""},timer:3e3},config));new toast({icon:type,title:msg})},showErrorForm:function(errors,form,target){form.find(".w30s-error").html("");$.each(errors,function(key,msg){var myTarget=target;if(typeof target!="undefined"){myTarget='[name="'+target.replace("[xxx]","["+key+"]")+'"]'}else{myTarget='[name="'+key+'"]'}var $target=form.find(myTarget);var $parent=$target.parent();$target.addClass("w30s-input-error");var $error=$parent.find(".w30s-error");if($error.length>0){$error.html(msg)}else{$parent.append('<div class="w30s-error">'+msg+"</div>")}})},clearErrorForm:function(){$(".w30s-input-error").removeClass("w30s-input-error");$(".w30s-error").remove()},validateInt:function($html){var myvalue=$html.val().replace(/[^\d].+/,"");$html.val(myvalue)},roudingPrice(price,currency_type){currency_type=!_.isUndefined(currency_type)?currency_type:this.config.currency_type;if(currency_type==this.config.CURRENCY_USD){price=Math.round((price+Number.EPSILON)*100)/100}return price},currencyFormat:function(price,currency_type,currency_symbol,is_format_number_usd=false){price=parseFloat(price);currency_type=!_.isUndefined(currency_type)?currency_type:this.config.currency_type;currency_symbol=!_.isUndefined(currency_symbol)?currency_symbol:this.config.currency_symbol;let position=this.config.position;if(numeral){switch(currency_type){case this.config.CURRENCY_USD:if(is_format_number_usd){price=price.toLocaleString("es-US")}break;case this.config.CURRENCY_VND:price=price.toLocaleString("it-IT");break;default:price=numeral(price).format("0,0");break}if(position=="before"){price=(currency_symbol?currency_symbol:"")+price}else if(position=="after_top"){price=price+(currency_symbol?"<sup>"+currency_symbol+"</sup>":"")}else if(position=="before_top"){price=(currency_symbol?"<sup>"+currency_symbol+"</sup>":"")+price}else{price=price+(currency_symbol?currency_symbol:"")}return price}return price},checkDeviceMobile:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},initCaptcha:function($html){var self=this;$html.find(this.config.selectorImageCaptcha).each(function(){var $box_captha=$(this);var data=$box_captha.data();if(data.src){let tmp=(new Date).getMilliseconds()+(new Date).getTime();let $html=$(template.render({src:data.src+"&time="+tmp},"captcha"));$box_captha.html($html);$box_captha.find(self.config.selectorRefreshCaptchaBtn).click(function(e){e.preventDefault();$box_captha.find("img").prop("src",data.src+"&time="+tmp)});setTimeout(()=>{$box_captha.find(self.config.selectorRefreshCaptchaBtn).trigger("click")},1e3)}})},initFormInformation:function($html){let self=this;$html.find(this.config.selectorFormInformation).each(function(){let $form=$(this);let $btnReset=$(this).find(".btn-reset-form");let $btnSubmit=$(this).find(".btn-submit-form");if($form.hasClass("forms_popup")){$form.find(".close-form-popup").unbind().bind("click",function(e){if(e){e.preventDefault();$(this).closest(".w30s-widget-popup-wrap").remove()}})}$btnReset.unbind().bind("click",function(){$form.find(".w30s-error").html("");$form[0].reset();$form.find("input, textarea, select").not(':submit, :reset, [name="forms_id"]').val("");$form.find(".w30s-btn-refresh-captcha").trigger("click")});$btnSubmit.unbind().bind("click",function(){(async()=>{let resp=await loader.ajaxPromise({type:"POST",url:self.config.urlAddFormContact,data:$form.serializeObject()});if(resp.result){core.showSuccess(resp.message);$btnReset.trigger("click")}else{core.showError(resp.message);core.showErrorForm(resp.error,$form)}})()})})}};var W30sLoader=function(){return W30sLoader.fn.init()};W30sLoader.fn=W30sLoader.prototype={init:function(){},ajaxPromise:function(config,options){let self=this;options=options||{};options=$.extend(true,{hideLoader:true},options);return new Promise(resolve=>{$.ajax($.extend(true,{type:"GET",url:"",dataType:"json",cache:false,async:true,data:{},success:function(resp){if(options.hideLoader===true){self.hideLoader(function(){resolve(resp)})}else{resolve(resp)}}},config))})},hideLoaderPromise:function(timeWaiting){return new Promise(resolve=>{if(typeof time=="undefined"){timeWaiting=50}setTimeout(function(){$(".w30s-loading").remove();resolve()},timeWaiting)})},getAjax:function(url,queryData,isProgress){var def=$.Deferred();var self=this;var config={url:url,type:"GET",data:queryData,dataType:"json",cache:true,success:function(resp){self.hideLoader(function(){def.resolve(resp)})},error:function(){self.hideLoader(function(){def.resolve([])})},complete:function(){setTimeout(function(){$(".w30s-loading-progess").remove()},300)},async:true};if(isProgress){config.xhr=function(){var xhr=new window.XMLHttpRequest;if(isProgress){xhr.addEventListener("progress",function(evt){if(evt.lengthComputable){var percentComplate=evt.loaded/evt.total*100;var loadingProgess=$(".w30s-loading-progess");if(loadingProgess.length==0){loadingProgess=$('<div class="w30s-loading-progess progress progress-xxs active">                                                        <div class="progress-bar progress-bar-danger progress-bar-striped" role="progressbar"                                                         aria-valuemin="0" aria-valuemax="100" style="width: '+percentComplate+'%">                                                        </div>                                                    </div>');$("body").append(loadingProgess)}loadingProgess.find(".progress-bar").css({width:percentComplate+"%"})}},false)}return xhr}}$.ajax(config);return def},postAjax:function(url,data,isProgress){var def=$.Deferred();var self=this;var config={url:url,type:"POST",data:data,dataType:"json",cache:false,async:true,success:function(resp){self.hideLoader(function(){def.resolve(resp)})},error:function(){self.hideLoader(function(){def.resolve([])})},complete:function(){setTimeout(function(){$(".w30s-loading-progess").remove()},300)}};if(isProgress){config.xhr=function(){var xhr=new window.XMLHttpRequest;if(isProgress){xhr.addEventListener("progress",function(evt){if(evt.lengthComputable){var percentComplate=evt.loaded/evt.total*100;var loadingProgess=$(".w30s-loading-progess");if(loadingProgess.length==0){loadingProgess=$('<div class="w30s-loading-progess progress progress-xxs active">                                                        <div class="progress-bar progress-bar-danger progress-bar-striped" role="progressbar"                                                         aria-valuemin="0" aria-valuemax="100" style="width: '+percentComplate+'%">                                                        </div>                                                    </div>');$("body").append(loadingProgess)}loadingProgess.find(".progress-bar").css({width:percentComplate+"%"})}},false)}return xhr}}$.ajax(config);return def},showLoader:function($callback){$("body").append('<div class="loader loader-default is-active w30s-loading"></div>');if(typeof $callback=="function"){$callback()}},showLoaderWidget:function($widget){$widget.html('<div class="widget-loader">Loading...</div>')},hideLoader:function($callback,timeWaiting){if(typeof time=="undefined"){timeWaiting=50}setTimeout(function(){$(".w30s-loading").remove();if(typeof $callback=="function"){$callback()}},timeWaiting)}};var W30sTemplate=function(){return W30sTemplate.fn.init()};W30sTemplate.fn=W30sTemplate.prototype={init:function(){},render:function(dataJson,$fileName,option,source_default){if(document.getElementById("w30s__"+$fileName)!==null||source_default){var self=this;let source;if(source_default){source=source_default}else{source=document.getElementById("w30s__"+$fileName).innerHTML}if(option&&option.hasOwnProperty("partials")){$.each(option.partials,function(idx,partial){self.handlebarsRegisterPartial(partial)})}this.handlebarsVar();this.handlebarsLength();this.handlebarsIfCond();this.handlebarsConCat();this.handlebarsJson();this.handlebarsMath();this.handlebarsNumberFormat();this.handlebarsCutString();this.handlebarsFindWhere();this.handlebarsObject();this.handlebarsWith();this.handlebarsDateFormat();this.handlebarsStripTags();this.handlebarsUrl();var template=Handlebars.compile(source);return template($.extend(true,{},dataJson))}else{console.log("Ko tìm thấy Template: w30s__"+$fileName)}return""},handlebarsJson:function(){Handlebars.registerHelper("json",function(context){return JSON.stringify(context)})},handlebarsStripTags:function(){Handlebars.registerHelper("striptags",function(content){if(typeof content=="undefined")return"";return $.trim($("<span>"+content.toString()+"</span>").text())})},handlebarsIfCond:function(){Handlebars.registerHelper("ifCond",function(v1,operator,v2,options){var result=false;switch(operator){case"!=":result=v1!=v2;break;case"===":result=v1===v2;break;case"!==":result=v1!==v2;break;case">":result=v1>v2;break;case">=":result=v1>=v2;break;case"<":result=v1<v2;break;case"<=":result=v1<=v2;break;case"||":result=v1||v2;break;case"&&":result=v1&&v2;break;case"in":v2=v2.toString().split(",");result=typeof v1!=="undefined"&&_.contains(v2,v1.toString());break;case"not_in":v2=v2.toString().split(",");result=typeof v1!=="undefined"&&!_.contains(v2,v1.toString());break;default:result=v1==v2}if(!options.hasOwnProperty("fn")){return result}else{if(result){return options.fn(this)}else{return options.inverse(this)}}})},handlebarsConCat:function(){Handlebars.registerHelper("concat",function(){var outStr="";for(var arg in arguments){if(typeof arguments[arg]!=="object"){outStr+=arguments[arg]}}return outStr})},handlebarsVar:function(){Handlebars.registerHelper("var",function(name,value,concat,context){if(concat==1){this[name]+=value}else{this[name]=value}})},handlebarsRegisterPartial:function(name){var source=document.getElementById("w30s__"+name).innerHTML;Handlebars.registerPartial(name,source)},handlebarsLength:function(){Handlebars.registerHelper("length",function(value){return value!==""&&value!==undefined?value.length:0})},handlebarsMath:function(){Handlebars.registerHelper("math",function(a,b,op){if(op=="*")return a*b;else if(op=="-")return a-b;else if(op=="+"){return parseFloat(a)+parseFloat(b)}})},handlebarsCutString:function(){Handlebars.registerHelper("cutString",function(content,count,start){var result=core.cutString(content,count,start);return result})},handlebarsWith:function(){Handlebars.registerHelper("with",function(context,options){return options.fn(context)})},handlebarsObject:function(){Handlebars.registerHelper("object",function(hash){return hash})},handlebarsFindWhere:function(){Handlebars.registerHelper("findWhere",function(array,need){return _.findWhere(array,need)})},handlebarsNumberFormat:function(){Handlebars.registerHelper("numberformat",function(value,options){var dl=options.hash["decimalLength"]||0;var tx=options.hash["decimalLength"]||",";var ds=options.hash["decimalLength"]||".";var value=parseFloat(value);var re="\\d(?=(\\d{3})+"+(dl>0?"\\D":"$")+")";var num=value.toFixed(Math.max(0,~~dl));return(ds?num.replace(".",ds):num).replace(new RegExp(re,"g"),"$&"+tx)})},handlebarsDateFormat:function(){Handlebars.registerHelper("dateFormat",function(value,format,options){format=format.toString().trim();format=format.replace(/d/g,"DD");format=format.replace(/m/g,"MM");format=format.replace(/Y/g,"YYYY");format=format.replace(/y/g,"YY");format=format.replace(/i/g,"mm");format=format.replace(/h/g,"hh");format=format.replace(/H/g,"HH");format=format.replace(/s/g,"ss");var timestamp=moment.unix(parseInt(value));timestamp=timestamp.format(format);return timestamp})},handlebarsUrl:function(){Handlebars.registerHelper("buildUrl",function(seo_name){let regex=/http(s?)\:\/\//gi;let match=regex.exec(seo_name);if(match){return seo_name}else{return base_url+"/"+seo_name+url_extension}})}};var DataStorage=function(){return DataStorage.fn.init()};DataStorage.fn=DataStorage.prototype={init:function(){},datastore:{},get:function(key,defaultvalue){defaultvalue=!_.isUndefined(defaultvalue)?defaultvalue:"";let value=defaultvalue;if(this.datastore.hasOwnProperty(key)){value=this.datastore[key]}return value},reset:function(){this.datastore={}},has:function(key){return!_.isUndefined(this.datastore[key])},set:function(key,value){return this.datastore[key]=value},remove:function(key){if(this.has(key)){delete this.datastore[key];return true}else{return false}}};var WidgetEvent=function(){return WidgetEvent.fn.init()};WidgetEvent.fn=WidgetEvent.prototype={config:{urlAddMemberChat:"/member/addMemberChatJson",urlAddFormContact:"/contact/add-contact",urlLoginMember:"/member/do-login-version-3",urlRegiterMember:"/member/do-register-json",urlProductReview:"/product/product-review-json",urlLostPasswordMember:"/member/forgotPasswordJson",urlAddNewsletter:"/page/add-newsletter",urlSetDeviceInfo:"/page/set-device-info",urlClassifiedNewsSave:"/classified-news-save/save-json",urlClassifiedNewsRemove:"/classified-news-save/delete-json",urlQuickViewVideo:"/gallery/detail-video-quick-view-json",selectorShowPopup:".w30s-show-popup",selectorHidePopup:".w30s-hide-popup",selectorToggleSlide:".w30s-toggle-slide",selectorSliderRangeBox:".w30s-slider-range-box",selectorSliderRange:".w30s-slider-range",selectorClearForm:".w30s-clear-form",selectorSendContact:".w30s-send-contact",selectorSendContactFormDynamic:".w30s-send-contact-form-dynamic",selectorRefreshCaptcha:".w30s-btn-refresh-captcha",selectorAddMemberChat:".w30s-add-member-chat",selectorLogin:".w30s-login",selectorLoginSocial:".w30s-login-social",selectorRegister:".w30s-register",selectorProductReview:".w30s-product-review",selectorForgotPassword:".w30s-forgot-password",selectorWidgetHoverDropdown:".w30s-hover-dropdown",selectorWidgetTargetHoverDropdown:".handle-object-hover-dropdown",selectorWidgetClickDropdown:".w30s-click-dropdown",selectorWidgetTargetClickDropdown:".handle-object-click-dropdown",selectorEventWidgetScrollTop:".w30s-scroll-top",selectorRegisterSubscribe:".w30s-registry-subscribe",selectorSeeMoreCollapse:".w30s-see-more-collapse",selectorShowLiveChatPA:".w30s-show-live-chat-pa",selectorOverlay:".w30s-event-overlay",selectorViewImage:".w30s-view-image",selectorLoadMap:".w30s-load-map",selectorNiceScroll:".w30s-event-nice-scroll",selectorAutocomplete:".w30s-event-autocomplete",selectorBootstrapSelect:".w30s-bootstrap-select",selectorCopyContent:".w30s-copy-content",selectorWidgetTableOfContents:".w30s-widget-table-of-contents",selectorWidgetPanorama:".w30s-widget-panorama",selectorWidgetSubmenu:".w30s-widget-submenu",selectorWidgetMenu:".w30s-widget-menu",selectorWidgetTab:".w30s-widget-tab",selectorWidgetCountdownTimer:".w30s-widget-countdown-timer",selectorWidgetQrCode:".w30s-widget-qr-code",selectorWidgetSearch:".w30s-widget-search",selectorWidgetSearchPopup:".w30s-icon-widget-search-popup",selectorWidgetFilterSelect:".w30s-widget-filter-select",selectorWidgetFilterCheckbox:".w30s-widget-filter-checkbox",selectorWidgetSlider:".w30s-widget-slider",selectorAddonWebcall30s:".w30s-event-webcall-addon-web30s",selectorEventWindowPrint:".w30s-event-window-print",selectorEventFilterBrand:".w30s-event-filter-brand",selectorEventCountUp:".w30s-event-count-up",selectorEventClickTranslateX:".w30s-click-translate-x",selectorEventClickLoadMore:".w30s-event-click-load-more",selectorEventClickLoadData:".w30s-event-click-load-data",selectorEventClickStarRate:".w30s-event-click-star-rate",selectorEventChangeLoadData:".w30s-event-changed-load-data",selectorEventClickAddNumberPhoneTongDai:".w30s-add-number-phone-tongdai",selectorEventClickAddServiceTongDai:".w30s-add-service-tongdai",selectorWidgetPopup:".w30s-widget-popup",selectorSliderProduct:".w30s-slider-product",selectorWidget3dFlipBook:".w30s-widget-3d-flip-book",selectorWidgetStatisticAccess:".w30s-widget-statistical-access",selectorAfterSubmitToggleSlide:".w30s-after-submit-toggle-slide",selectorClassNameCustomListView:".w30s-handle-class-name-custom-list-view",classShowPopupSearch:"w30s-show-popup-search",classWidgetSubmenu:"w30s-widget-submenu",classWidgetSubmenuV4:"w30s-widget-submenu-4",classWidgetTitle:"w30s-widget-title",classWidgetText:"w30s-widget-text",classWidgetTab:"w30s-widget-tab",selectorSettingFullHeight:".w30s-full-height",selectorAddClassifiedNewsSave:".w30s-add-classified-news-save",selectorRemoveClassifiedNewsSave:".w30s-remove-classified-news-save",selectorPriceDiscount:".w30s-widget-price-discount",selectorVideoQuickView:".w30s-video-quick-view"},configInitEvent:{},isProcessing:false,curentDevice:"desktop",listDevice:["desktop",1024,768,640,480,375,320],listAnimation:{"w30s-animation--fadeIn":"w30s-animation--fadeOut","w30s-animation--fadeInDown":"w30s-animation--fadeOutDown","w30s-animation--fadeInDownBig":"w30s-animation--fadeOutDownBig","w30s-animation--fadeInLeft":"w30s-animation--fadeOutLeft","w30s-animation--fadeInLeftBig":"w30s-animation--fadeOutLeftBig","w30s-animation--fadeInRight":"w30s-animation--fadeOutRight","w30s-animation--fadeInRightBig":"w30s-animation--fadeOutRightBig","w30s-animation--fadeInUp":"w30s-animation--fadeOutUp","w30s-animation--fadeInUpBig":"w30s-animation--fadeOutUpBig","w30s-animation--fadeInTopLeft":"w30s-animation--fadeOutTopLeft","w30s-animation--fadeInTopRight":"w30s-animation--fadeOutTopRight","w30s-animation--fadeInBottomLeft":"w30s-animation--fadeOutBottomLeft","w30s-animation--fadeInBottomRight":"w30s-animation--fadeOutBottomLeft"},queryDataWidget:{},listWidgetInProcess:{},timeScroll:1e3,Member:null,Cart:null,CONTENT_TYPE_DEFAULT:0,CONTENT_TYPE_BANNER:15,CONTENT_TYPE_PRODUCT_CATEGORY:2,CONTENT_TYPE_PRODUCT:1,CONTENT_TYPE_SERVICE_CATEGORY:12,CONTENT_TYPE_SERVICE:11,CONTENT_TYPE_NEWS_CATEGORY:4,CONTENT_TYPE_NEWS:5,CONTENT_TYPE_ALBUM:6,CONTENT_TYPE_VIDEO:8,CONTENT_TYPE_ALBUM_CATEGORY:3,CONTENT_TYPE_VIDEO_CATEGORY:7,CONTENT_TYPE_ALBUM_PHOTO:10,CONTENT_TYPE_CLASSIFIED_NEWS_CATEGORY:29,CONTENT_TYPE_CLASSIFIED_NEWS:30,CONTENT_TYPE_REALTY_PROJECT_CATEGORY:32,CONTENT_TYPE_REALTY_PROJECT:31,CONTENT_TYPE_TYPE_OF_HOUSING:42,CONTENT_TYPE_MAIN_MENU:34,CONTENT_TYPE_STORE_ADDRESS:35,CONTENT_TYPE_COMPANY_API:800,CONTENT_TYPE_PAGE_CUSTOM:28,CONTENT_TYPE_MULTI_LANGUAGE:23,CONTENT_TYPE_BRAND:33,CONTENT_TYPE_COUPON:38,CONTENT_TYPE_PROMOTION:39,CONTENT_TYPE_SCENARIO:47,CONTENT_TYPE_WIDGET:900,CONTENT_TYPE_ROOT:999,TYPE_PRODUCT:3,TYPE_PRODUCT_BRAND:41,PAGE_TYPE_PRODUCT_DETAIL:4,PAGE_TYPE_NEWS_DETAIL:7,PAGE_TYPE_ALBUM_DETAIL:11,PAGE_TYPE_SEARCH_ALL:5,PAGE_TYPE_NEWS:6,PAGE_TYPE_ALBUM:10,PAGE_TYPE_VIDEO:12,PAGE_TYPE_ALBUM_CATEGORY:15,PAGE_TYPE_VIDEO_CATEGORY:16,PAGE_TYPE_SERVICE:18,PAGE_TYPE_CLASSIFIED_NEWS:33,PAGE_TYPE_CLASSIFIED_NEWS_CATEGORY:35,PAGE_TYPE_REALTY_PROJECT:36,PAGE_TYPE_REALTY_PROJECT_CATEGORY:38,CONTENT_FIELD_LIST_SEARCH:"list_search",CONTENT_FIELD_LIST_VIEWED:"list_viewed",CONTENT_FIELD_LIST_FAVORITE:"list_favorite",CONTENT_FIELD_LIST_CLASSIFIED_SAVE:"list_classified_save",CONTENT_FIELD_PROVINCE:"province",CONTENT_FIELD_DISTRICT:"district",CONTENT_FIELD_WARD:"ward",CONTENT_FIELD_STREET:"street",CONTENT_FIELD_AREA:"area",CONTENT_FIELD_QUANTITY_BEDROOM:"quantity_bedroom",CONTENT_FIELD_DIRECT_HOUSE:"direct_house",CONTENT_FIELD_PRICE_SEARCH:"price_search",CONTENT_FIELD_PRICE_UNIT:"price_unit",CONTENT_FIELD_NUMBER_FLOOR:"number_floor",CONTENT_FIELD_NUMBER_TOILET:"number_toilet",CONTENT_FIELD_LIST_CATEGORY_CHILD:"list_category_child",CONTENT_FIELD_PRODUCT_LIST:"products",CONTENT_FIELD_CLASSIFIED_NEWS_LIST:"classified_news",CONTENT_FIELD_REALTY_PROJECT_LIST:"realty_projects",CONTENT_FIELD_SERVICE_LIST:"services",CONTENT_FIELD_NEWS_LIST:"newses",CONTENT_FIELD_ALBUM_LIST:"albums",CONTENT_FIELD_VIDEO_LIST:"videos",CONTENT_FIELD_STATISTIC:"statistic",CONTENT_FIELD_FILTER_AREA:"filter_area",CONTENT_FIELD_FILTER_NUMBER_TOILET:"filter_number_toilet",CONTENT_FIELD_FILTER_NUMBER_ROOM:"filter_number_room",CONTENT_FIELD_FILTER_NUMBER_FLOOR:"filter_number_floor",CONTENT_FIELD_DIRECT_HOUSE_NAME:"direct_house_name",SEARCH_NAME_CATEGORY_ID:"category_id",SEARCH_NAME_CATEGORY_ID_IN:"category_id_in",init(){},startInit(configInitEvent){let $html=$("body");this.configInitEvent=configInitEvent.loadJs;this.handleAutoComplete($html);this.buildTemplateHandlebar();this.setDataSlider($html);this.setData3DFlipBook($html);this.setDataSubmenu4($html);this.setDataFilterSelect($html);this.setDataWidgetUsedEventLoadDataDefault($html);this.renderAllWidget($html);this.replaceSvgChild($html);this.loadDataMainMenu();this.loadDataConnectApi();this.initWindowResize();this.initSlider();this.handleShowPopup($html);this.handleLogin($html);this.handleAddMemberChat($html);this.handleLoginSocial($html);this.handleRegister($html);this.handleForgotPassword($html);this.handleHoverDropdown($html);this.handleClickDropdown($html);this.handleScrollTop($html);this.handleRegistrySubscribe($html);this.handleSearch($html);this.handleTriggerClickLivechatPA($html);this.handleViewImage($html);this.handleLoadMap($html);this.handleOverlay($html);this.handleHidePopup($html);this.handleTriggerHidePopup($html);this.handleCountDownTimer($html);this.handleQrCode($html);this.handleNiceSroll($html);this.handleWidgetFilterCheckbox($html);this.handleMenu($html);this.handleWidgetTab($html);this.handleWidgetSubmenu($html);this.handleWidgetSubmenuV4($html);this.handleChangeStyleView($html);this.initSliderRange($html);this.handleFilterProductVariant($html);this.handleFilterProductBrand($html);this.handleCountUp($html);this.handleToggleSlide($html);this.handleSeeMoreCollapse($html);this.handleClickTranslateX($html);this.handleClickLoadMore($html);this.handleClickLoadData($html);this.handleEventSlideLandingPage($html);this.handleChangeLoadDataDefault($html);this.renderWidgetTableOfContent($html);$html.find(".w30s-widget-filter-select[data-content_type=0]").map((k,el)=>{this.handleWidgetFilterSelect($(el))});this.handleClickStarRate();this.handleClickAddNumberPhoneTongDai($html);this.handleClassCustomListView($html);if(typeof Member!="undefined"){this.Member=new Member;this.Member.handleUpdateMember($html);this.Member.handleChangePassword($html)}if(typeof Cart!="undefined"){this.Cart=new Cart;this.Cart.setup({})}else{this.handleSaveClassifiedNewsSave($html)}this.initEvents($html);this.handlePagination($(".w30s-widget-repeater[data-render]"));if(this.configInitEvent.initMap===true&&map){map.initMap();$(".w30s-widget-map .w30s-map").each(function(){map.renderMapEmbed($(this))})}$html.find(this.config.selectorAddonWebcall30s).unbind("click").click(function(){if(!_.isUndefined(call30s)&&_.isFunction(call30s)){call30s({})}});$html.find(this.config.selectorEventWindowPrint).unbind("click").click(function(){window.print()});this.scrollToSection();this.handleFullHeight($html);this.initWidget3dFlipbook($html);this.handleHideParentPriceDiscount($html);this.handleHideOptionProduct($html);this.handleClickCopyContent($html);$html=null},initEvents($html){this.handleClearForm($html);this.handleSendContact($html);this.handleRefreshCaptcha($html);this.handleUpDownBtnQuantity($html);this.handleLogin($html);this.handleLoginSocial($html);this.handleForgotPassword($html);this.handleRegister($html);this.handleProductReview($html);this.handlePanorama($html);core.initLazyLoad();core.initCaptcha($html);if(_.isFunction(window.fbAsyncInit)&&$("body").find("#fb-root").children().length>0){window.fbAsyncInit()}this.loadLibVideo()},loadLibVideo(){let $video=$(".w30s-widget-video video");if($video.length>0){helper.loadCss("/assets/libs/plyr-3.5.10/plyr.css","css-plyr-3-5-10");helper.loadScriptExternal({id:"js-plyr-3-5-10",src:"/assets/libs/plyr-3.5.10/plyr.js",callback:()=>{$video.each((idx,el)=>{let option={iconUrl:"/assets/libs/plyr-3.5.10/plyr.svg",controls:[],loop:{active:$(el).data("loop")==1},autopause:false,autoplay:$(el).attr("autoplay")};if($(el).attr("controls")){option.controls=["play-large","play","progress","current-time","mute","volume","airplay"]}new Plyr(el,option)})}})}},clearForm($form){$form.find(".w30s-error").html("");$form[0].reset();$form.find("input, textarea, select").not(":submit, :reset, [name=_token]").val("")},buildTemplateHandlebar(){$(".w30s-widget-render").each((idx,el)=>{try{let $obj=$(el);$.ajax({url:base_url+"/widget/renderTemplate",type:"POST",dataType:"text",data:{data:$obj.html()},complete:(xhr,status)=>{if(status=="success"){$obj.after(xhr.responseText||"");$obj.remove()}}})}catch(e){}})},replaceSvgChild($html){$html.find("svg.w30s-widget>svg").each((idx,el)=>{let $svg=$(el);let $svgParent=$svg.parent();let preserveAspectRatio=$svgParent.attr("preserveAspectRatio");preserveAspectRatio=_.isUndefined(preserveAspectRatio)?"none":preserveAspectRatio;$svg.removeAttr("id").removeAttr("width").removeAttr("height").attr("class",$svgParent.attr("class")).attr("preserveAspectRatio",preserveAspectRatio);$svgParent.after($svg);$svgParent.remove()})},setLocationHash(widgetId,$widgetRender){let content_data_page=DataStorage.get("content_data_page",{});if(this.queryDataWidget.hasOwnProperty(widgetId)&&content_data_page.hasOwnProperty("type_page")&&_.contains([this.TYPE_PRODUCT,this.TYPE_PRODUCT_BRAND,this.PAGE_TYPE_SEARCH_ALL,this.PAGE_TYPE_NEWS,this.PAGE_TYPE_ALBUM,this.PAGE_TYPE_VIDEO,this.PAGE_TYPE_ALBUM_CATEGORY,this.PAGE_TYPE_VIDEO_CATEGORY,this.PAGE_TYPE_SERVICE,this.PAGE_TYPE_CLASSIFIED_NEWS,this.PAGE_TYPE_CLASSIFIED_NEWS_CATEGORY,this.PAGE_TYPE_REALTY_PROJECT,this.PAGE_TYPE_REALTY_PROJECT_CATEGORY],content_data_page.type_page)){let locationhash=$.extend(true,{},this.queryDataWidget[widgetId]);delete locationhash.category_id;if($widgetRender&&!_.isUndefined($widgetRender.data("limit"))&&$widgetRender.data("limit")==locationhash.limit){delete locationhash.limit}delete locationhash._;delete locationhash.keyword;locationhash=$.param(locationhash);if(locationhash.indexOf("&")>=0){window.location.hash=locationhash}else if(window.location.hash&&window.location.hash.length>0){if(history.pushState){history.pushState("",document.title,window.location.pathname)}else{window.location.hash=""}}locationhash=null}},getUrlByContentType($widgetRender){switch(parseInt($widgetRender.data("content_type"))){case this.CONTENT_TYPE_PRODUCT:return"/product/index-v3-json";case this.CONTENT_TYPE_SERVICE_CATEGORY:case this.CONTENT_TYPE_NEWS_CATEGORY:case this.CONTENT_TYPE_PRODUCT_CATEGORY:case this.CONTENT_TYPE_PROMOTION:case this.CONTENT_TYPE_COUPON:case this.CONTENT_TYPE_BRAND:case this.CONTENT_TYPE_MULTI_LANGUAGE:case this.CONTENT_TYPE_PAGE_CUSTOM:case this.CONTENT_TYPE_BANNER:case this.CONTENT_TYPE_REALTY_PROJECT_CATEGORY:case this.CONTENT_TYPE_CLASSIFIED_NEWS_CATEGORY:case this.CONTENT_TYPE_REALTY_PROJECT:case this.CONTENT_TYPE_TYPE_OF_HOUSING:case this.CONTENT_TYPE_ALBUM_CATEGORY:case this.CONTENT_TYPE_VIDEO_CATEGORY:case this.CONTENT_TYPE_SCENARIO:case this.CONTENT_TYPE_ALBUM_PHOTO:return"/widget/index-json";case this.CONTENT_TYPE_SERVICE:return"/service/index-v3-json";case this.CONTENT_TYPE_NEWS:return"/news/index-v3-json";case this.CONTENT_TYPE_ALBUM:case this.CONTENT_TYPE_VIDEO:return"/gallery/index-v3-json";case this.CONTENT_TYPE_CLASSIFIED_NEWS:return"/classified-news/index-v3-json";case this.CONTENT_TYPE_COMPANY_API:return"/widget/data-api-json";case this.CONTENT_TYPE_STORE_ADDRESS:return"/store-address/index-json";case this.CONTENT_TYPE_ROOT:switch($widgetRender.data("content_field")){case this.CONTENT_FIELD_LIST_VIEWED:return"/product/index-v3-json";case this.CONTENT_FIELD_LIST_FAVORITE:return"/product/index-v3-json";case this.CONTENT_FIELD_LIST_CLASSIFIED_SAVE:return"/classified-news-save/index-json";case this.CONTENT_FIELD_PROVINCE:case this.CONTENT_FIELD_DISTRICT:case this.CONTENT_FIELD_WARD:case this.CONTENT_FIELD_STREET:return"/address/get-address-v3-json";case this.CONTENT_FIELD_LIST_SEARCH:return"/widget/index-json"}return null;case this.CONTENT_TYPE_WIDGET:switch($widgetRender.data("content_field")){case"products":return"/product/index-v3-json";case this.CONTENT_FIELD_SERVICE_LIST:return"/service/index-v3-json";case this.CONTENT_FIELD_NEWS_LIST:return"/news/index-v3-json";case this.CONTENT_FIELD_REALTY_PROJECT_LIST:return"/realty-project/index-v3-json";case this.CONTENT_FIELD_ALBUM_LIST:case this.CONTENT_FIELD_CLASSIFIED_NEWS_LIST:case this.CONTENT_FIELD_VIDEO_LIST:return"/widget/index-json"}return null;case-999:return"/widget/data-menu-top-json";default:return null}},getQueryByContentTypeAddress(widgetId,contentField,$widgetRender){this.queryDataWidget[widgetId].type=contentField;let $form=$widgetRender.closest("form");let isDataContentStoreAddress=false;if($form.length>0){let $buttonEvent=$form.find(this.config.selectorEventClickLoadData);if($buttonEvent.length>0){let uniqueObject=$buttonEvent.data("target_unique");let classUniqueObject=".w30s-widget-unique-"+uniqueObject;if($(classUniqueObject).length>0){if($(classUniqueObject).data("content_type")==this.CONTENT_TYPE_STORE_ADDRESS){isDataContentStoreAddress=true}}}}if(isDataContentStoreAddress){this.queryDataWidget[widgetId].is_has_data_store_address=1}else{this.queryDataWidget[widgetId].is_has_data=1}},getQueryByContentType($widgetRender){let pageQuery=DataStorage.get("query_page",{});let contentDataPage=DataStorage.get("content_data_page",{});let widgetId=$widgetRender.data("id");let contentField=$widgetRender.data("content_field");let contentType=parseInt($widgetRender.data("content_type"));if(!this.queryDataWidget.hasOwnProperty(widgetId)){this.queryDataWidget[widgetId]={}}this.queryDataWidget[widgetId].widget_id=widgetId;if(!_.isUndefined($widgetRender.data("apply_condition_page"))&&parseInt($widgetRender.data("apply_condition_page"))===1){let hashQuery=helper.getParamFromUrl(window.location.hash.replace("#","?"));hashQuery.variant_options={};hashQuery.brand_id=[];_.mapObject(hashQuery,(value,key)=>{if(key.indexOf("variant_options[")>=0){hashQuery.variant_options[key.replace("variant_options[","").replace("]","")]=value;if(this.queryDataWidget[widgetId].hasOwnProperty(key)){delete this.queryDataWidget[widgetId][key]}delete hashQuery[key]}if(key.indexOf("brand_id[")>=0){if(_.isArray(hashQuery["brand_id[]"])){hashQuery.brand_id=$.extend(true,[],hashQuery["brand_id[]"])}else{hashQuery.brand_id.push(hashQuery["brand_id[]"])}if(this.queryDataWidget[widgetId].hasOwnProperty(key)){delete this.queryDataWidget[widgetId][key]}delete hashQuery[key]}});if(hashQuery.hasOwnProperty("widget_id")&&widgetId==hashQuery.widget_id){if(hashQuery.hasOwnProperty("page")&&!this.queryDataWidget[widgetId].hasOwnProperty("page")){this.queryDataWidget[widgetId].page=hashQuery.page}if(hashQuery.hasOwnProperty("brand_id")&&!this.queryDataWidget[widgetId].hasOwnProperty("brand_id")){this.queryDataWidget[widgetId].brand_id=$.extend(true,[],hashQuery.brand_id)}if(hashQuery.hasOwnProperty("brand_id")&&!this.queryDataWidget[widgetId].hasOwnProperty("brand_id")){this.queryDataWidget[widgetId].brand_id=$.extend(true,[],hashQuery.brand_id)}if(hashQuery.hasOwnProperty("price_min")&&!this.queryDataWidget[widgetId].hasOwnProperty("price_min")){this.queryDataWidget[widgetId].price_min=hashQuery.price_min}if(hashQuery.hasOwnProperty("price_max")&&!this.queryDataWidget[widgetId].hasOwnProperty("price_max")){this.queryDataWidget[widgetId].price_max=hashQuery.price_max}if(hashQuery.hasOwnProperty("variant_options")&&!this.queryDataWidget[widgetId].hasOwnProperty("variant_options")){this.queryDataWidget[widgetId].variant_options=$.extend(true,{},hashQuery.variant_options)}if(hashQuery.hasOwnProperty("price_min")&&!this.queryDataWidget[widgetId].hasOwnProperty("price_min")){this.queryDataWidget[widgetId].price_min=hashQuery.price_min}if(hashQuery.hasOwnProperty("sortby")&&!this.queryDataWidget[widgetId].hasOwnProperty("sortby")){this.queryDataWidget[widgetId].sortby=hashQuery.sortby}if(hashQuery.hasOwnProperty("sortby")&&!this.queryDataWidget[widgetId].hasOwnProperty("sortby")){this.queryDataWidget[widgetId].sortby=hashQuery.sortby}if(hashQuery.hasOwnProperty("limit")&&!this.queryDataWidget[widgetId].hasOwnProperty("limit")){this.queryDataWidget[widgetId].limit=hashQuery.limit;$(product.config.selectorChangeLimit).val(hashQuery.limit)}}this.queryDataWidget[widgetId].keyword=$widgetRender.data("keyword");if(typeof $widgetRender.data("category_id")!="undefined"){this.queryDataWidget[widgetId].category_id=$widgetRender.data("category_id")}if(typeof $widgetRender.data("parent_id")!="undefined"){this.queryDataWidget[widgetId].parent_id=$widgetRender.data("parent_id")}}if(!_.isUndefined($widgetRender.data("limit"))&&$widgetRender.data("limit")>0&&!this.queryDataWidget[widgetId].hasOwnProperty("limit")){this.queryDataWidget[widgetId].limit=$widgetRender.data("limit")}switch(contentType){case this.CONTENT_TYPE_PRODUCT:if(contentDataPage.hasOwnProperty("type_page")&&parseInt(contentDataPage.type_page)===this.PAGE_TYPE_PRODUCT_DETAIL&&contentDataPage.hasOwnProperty("relate_object_id")){this.queryDataWidget[widgetId].relate_object_id=contentDataPage.relate_object_id}if(!_.isUndefined(pageQuery.category_id)){this.queryDataWidget[widgetId].category_id=pageQuery.category_id}if(!_.isUndefined(pageQuery.brand_id)){this.queryDataWidget[widgetId].brand_id=pageQuery.brand_id}if(!_.isUndefined($widgetRender.data("brand_id"))){if(typeof this.queryDataWidget[widgetId].brand_id=="array"){this.queryDataWidget[widgetId].brand_id.push($widgetRender.data("brand_id"))}else{this.queryDataWidget[widgetId].brand_id=parseInt($widgetRender.data("brand_id"))}}break;case this.CONTENT_TYPE_NEWS:if(contentDataPage.hasOwnProperty("type_page")&&parseInt(contentDataPage.type_page)===this.PAGE_TYPE_NEWS_DETAIL&&contentDataPage.hasOwnProperty("relate_object_id")){this.queryDataWidget[widgetId].relate_object_id=contentDataPage.relate_object_id}break;case this.CONTENT_TYPE_SERVICE:if(!_.isUndefined(pageQuery.category_id)){this.queryDataWidget[widgetId].category_id=pageQuery.category_id}break;case this.CONTENT_TYPE_ALBUM_PHOTO:if(contentDataPage.hasOwnProperty("type_page")&&parseInt(contentDataPage.type_page)===this.PAGE_TYPE_ALBUM_DETAIL&&contentDataPage.hasOwnProperty("relate_object_id")){this.queryDataWidget[widgetId].relate_object_id=contentDataPage.relate_object_id}break;case this.CONTENT_TYPE_CLASSIFIED_NEWS:if(pageQuery.hasOwnProperty("province_id")&&pageQuery.province_id!=""){this.queryDataWidget[widgetId].province_id_in=!_.isArray(pageQuery["province_id"])?[pageQuery["province_id"]]:pageQuery["province_id"];this.queryDataWidget[widgetId].province_id_in=this.queryDataWidget[widgetId].province_id_in.filter(val=>{return val>0})}if(pageQuery.hasOwnProperty("district_id")&&pageQuery.district_id!=""){this.queryDataWidget[widgetId].district_id_in=!_.isArray(pageQuery["district_id"])?[pageQuery["district_id"]]:pageQuery["district_id"];this.queryDataWidget[widgetId].district_id_in=this.queryDataWidget[widgetId].district_id_in.filter(val=>{return val>0})}if(pageQuery.hasOwnProperty("ward_id")&&pageQuery.ward_id!=""){this.queryDataWidget[widgetId].ward_id_in=!_.isArray(pageQuery["ward_id"])?[pageQuery["ward_id"]]:pageQuery["ward_id"];this.queryDataWidget[widgetId].ward_id_in=this.queryDataWidget[widgetId].ward_id_in.filter(val=>{return val>0})}if(pageQuery.hasOwnProperty("area")&&pageQuery.area!=""){this.queryDataWidget[widgetId].area=pageQuery["area"]}if(pageQuery.hasOwnProperty("number_floor")&&pageQuery.number_floor!=""){this.queryDataWidget[widgetId].number_floor=pageQuery["number_floor"]}if(pageQuery.hasOwnProperty("direct_house")){this.queryDataWidget[widgetId].direct_house=pageQuery["direct_house"]}if(pageQuery.hasOwnProperty("number_toilet")&&pageQuery.number_toilet!=""){this.queryDataWidget[widgetId].number_toilet=pageQuery["number_toilet"]}if(pageQuery.hasOwnProperty("quantity_bedroom")&&pageQuery.quantity_bedroom!=""){this.queryDataWidget[widgetId].quantity_bedroom=pageQuery["quantity_bedroom"]}if(pageQuery.hasOwnProperty("street")&&pageQuery.street!=""){this.queryDataWidget[widgetId].street_id=pageQuery["street"]}if(pageQuery.hasOwnProperty("price_search")&&pageQuery.price_search!=""){this.queryDataWidget[widgetId].price_search=pageQuery["price_search"]}this.queryDataWidget[widgetId].category_id_in=[];if(pageQuery.hasOwnProperty("category_id")){if(_.isArray(pageQuery.category_id)){this.queryDataWidget[widgetId].category_id_in=this.queryDataWidget[widgetId].category_id_in.concat(pageQuery.category_id)}else{this.queryDataWidget[widgetId].category_id_in.push(pageQuery.category_id)}}if(pageQuery.hasOwnProperty("category_id_in")){this.queryDataWidget[widgetId].category_id_in=this.queryDataWidget[widgetId].category_id_in.concat(pageQuery.category_id_in)}if(pageQuery.hasOwnProperty("realty_project_id")){this.queryDataWidget[widgetId].realty_project_id=pageQuery.realty_project_id}if(pageQuery.hasOwnProperty("type_of_housing_id")){this.queryDataWidget[widgetId].type_of_housing_id=pageQuery.type_of_housing_id}break;case this.CONTENT_TYPE_REALTY_PROJECT:if(pageQuery.hasOwnProperty("province_id")){this.queryDataWidget[widgetId].province_id_in=!_.isArray(pageQuery["province_id"])?[pageQuery["province_id"]]:pageQuery["province_id"]}if(pageQuery.hasOwnProperty("district_id")){this.queryDataWidget[widgetId].district_id_in=!_.isArray(pageQuery["district_id"])?[pageQuery["district_id"]]:pageQuery["district_id"]}break;case this.CONTENT_TYPE_ROOT:switch(contentField){case this.CONTENT_FIELD_LIST_VIEWED:this.queryDataWidget[widgetId].viewed=1;break;case this.CONTENT_FIELD_LIST_FAVORITE:this.queryDataWidget[widgetId].favorite=1;break;case this.CONTENT_FIELD_PROVINCE:this.getQueryByContentTypeAddress(widgetId,contentField,$widgetRender);break;case this.CONTENT_FIELD_DISTRICT:if(pageQuery.hasOwnProperty("province_id")&&pageQuery.province_id!=""){this.queryDataWidget[widgetId].province_id_in=!_.isArray(pageQuery["province_id"])?[pageQuery["province_id"]]:pageQuery["province_id"]}else{delete this.queryDataWidget[widgetId].province_id_in}this.getQueryByContentTypeAddress(widgetId,contentField,$widgetRender);this.queryDataWidget[widgetId].type=contentField;break;case this.CONTENT_FIELD_STREET:case this.CONTENT_FIELD_WARD:if(pageQuery.hasOwnProperty("district_id")&&pageQuery.district_id!=""){this.queryDataWidget[widgetId].district_id_in=!_.isArray(pageQuery["district_id"])?[pageQuery["district_id"]]:pageQuery["district_id"]}else{delete this.queryDataWidget[widgetId].district_id_in}this.queryDataWidget[widgetId].type=contentField;this.getQueryByContentTypeAddress(widgetId,contentField,$widgetRender);break}break;case this.CONTENT_TYPE_WIDGET:switch(contentField){case this.CONTENT_FIELD_CLASSIFIED_NEWS_LIST:case this.CONTENT_FIELD_PRODUCT_LIST:case this.CONTENT_FIELD_REALTY_PROJECT_LIST:case this.CONTENT_FIELD_NEWS_LIST:case this.CONTENT_FIELD_SERVICE_LIST:case this.CONTENT_FIELD_ALBUM_LIST:case this.CONTENT_FIELD_VIDEO_LIST:this.queryDataWidget[widgetId].category_id=!_.isUndefined(this.queryDataWidget[widgetId].category_id)?this.queryDataWidget[widgetId].category_id:0;if(!_.isUndefined($widgetRender.data("category_id"))){this.queryDataWidget[widgetId].category_id=$widgetRender.data("category_id")}break}break;case this.CONTENT_TYPE_COMPANY_API:if(!_.isUndefined($widgetRender.data("api"))){this.queryDataWidget[widgetId].api=$widgetRender.data("api")}break;case-999:this.queryDataWidget[widgetId].router=!_.isUndefined($widgetRender.data("router"))?$widgetRender.data("router"):"";this.queryDataWidget[widgetId].controller=!_.isUndefined($widgetRender.data("controller"))?$widgetRender.data("controller"):"";break}if(!_.isUndefined($widgetRender.data("apply_condition_page"))&&parseInt($widgetRender.data("apply_condition_page"))===1){if(this.queryDataWidget[widgetId].hasOwnProperty("variant_options")){let variant_options=this.queryDataWidget[widgetId].variant_options;_.mapObject(variant_options,(value,key)=>{$('.w30s-widget-filter-product-variant [data-key="'+key+'"]').each(function(){let $item=$(this);$item.removeClass("active");if((","+value+",").indexOf($item.data("value"))>0){$item.addClass("active")}})})}if(this.queryDataWidget[widgetId].hasOwnProperty("brand_id")){let brand_id=this.queryDataWidget[widgetId].brand_id;$('.w30s-event-filter-brand [type="checkbox"]').prop("checked",false);_.mapObject(brand_id,value=>{$('.w30s-event-filter-brand [type="checkbox"][value="'+value+'"]').prop("checked",true)})}if(this.queryDataWidget[widgetId].hasOwnProperty("price_min")||this.queryDataWidget[widgetId].hasOwnProperty("price_max")){this.initSliderRange($("body"),this.queryDataWidget[widgetId])}this.setLocationHash(widgetId,$widgetRender)}},handleChangeStyleView($html){let self=this;$html.find(".w30s-repeater-view .w30s-item").unbind("click").click(function(e){e.preventDefault();let $obj=$(this);let parentRepeater=$obj.parents(".w30s-widget-repeater").first();if(!$obj.hasClass("active")){$obj.addClass("active").siblings().removeClass("active");let $widgetMain=$obj.parents(".w30s-widget-repeater").first();if($obj.data("type")==="list"){$widgetMain.removeClass("w30s-view-grid").addClass("w30s-view-list")}else{$widgetMain.removeClass("w30s-view-list").addClass("w30s-view-grid")}}if(parentRepeater.length>0&&parentRepeater.hasClass(self.config.selectorOverlay.replace(".",""))){self.handleOverlay(parentRepeater.parent())}})},handleUpDownBtnQuantity($html){$html.find(".w30s-widget-quantity").each(function(idx,el){let $widget=$(el);let $input=$widget.find(".w30s-field-quantity > input");$widget.find(" .w30s-button-up").off().click(function(e){e.preventDefault();let num=$input.val();num=isNaN(num)?1:num;num++;$input.val(num).trigger("change");num=null});$widget.find(" .w30s-button-down").off().click(function(e){e.preventDefault();let num=$input.val();num=isNaN(num)?1:num;num=num>1?num-1:num;$input.val(num).trigger("change");num=null})})},handleHidePopup($html){$html.find(".w30s-backdrop").off().click(function(e){e.preventDefault();$(this).parents(".w30s-widget-popup-wrap").remove();if($(".w30s-widget-popup-wrap").length===0){$("body").removeClass("w30s-popup-open")}})},handleTriggerHidePopup($html){$html.find(this.config.selectorHidePopup).unbind("click").click(function(e){e.preventDefault();$(this).parents(".w30s-widget-popup-wrap").remove();if($(".w30s-widget-popup-wrap").length===0){$("body").removeClass("w30s-popup-open")}})},handleShowPopup($html){let self=this;$html.find(this.config.selectorShowPopup).off().click(function(e){e.preventDefault();(async()=>{let $body=$("body");$body.addClass("w30s-popup-open");let $sectionPopup=$("body .w30s-section-popup");if($sectionPopup.length<=0){$sectionPopup=$('<div class="w30s-section w30s-section-popup"></div>');$body.append($sectionPopup)}let resp=await self.getDataContentPage();let html=$(template.render({content_data_page:resp.data},$(e.currentTarget).data("render")));html.hide();$sectionPopup.append(html);html.show();html.find(self.config.selectorWidgetSlider).each(function(){let dataSlider=_.findWhere(DataStorage.get("dataSlider",[]),{id:$(this).data("id")});if(dataSlider){self.handleSlider(this,dataSlider)}});self.renderAllWidget(html);self.handleHidePopup(html);self.handleTriggerHidePopup(html);self.initEvents(html);$sectionPopup=null;html=null;$body=null;resp=null})()})},handleClickCopyContent($html){let $obj=$html.find(this.config.selectorCopyContent);$obj.off().click(function(e){let data=$(this).data("copy_content");e.preventDefault();let $obj={};if($(this).closest(".w30s-widget-repeater").length>0){$obj=$(this).closest(".w30s-repeater-item").find(".w30s-widget-unique-"+data).first()}else if($(this).closest(".w30s-widget-slider").length>0){$obj=$(this).closest(".w30s-widget-slider-item").find(".w30s-widget-unique-"+data).first()}else{$obj=$(this).closest(".w30s-section").find(".w30s-widget-unique-"+data).first()}if($obj!=undefined&&$obj.length>0){let text=$obj.text();let input=document.createElement("input");input.setAttribute("value",text);input.setAttribute("style","    position: fixed;bottom: -100%;");$("body").append(input);input.select();try{if(document.queryCommandSupported("copy")){if(document.execCommand("copy")){core.showSuccess(lang.copy_content_success)}}}catch(e){console.log(e)}document.body.removeChild(input)}})},_doToggleSlide($target,onlyHide){if(!_.isUndefined($target.data("animation"))&&!_.isUndefined(this.listAnimation[$target.data("animation")])){let class_tmp_hide=this.listAnimation[$target.data("animation")];if($target.is(":visible")||onlyHide){$target.addClass(class_tmp_hide);$target.removeClass($target.data("animation"))}else{$target.addClass($target.data("animation"));$target.removeClass(class_tmp_hide)}if($target.is(":visible")||onlyHide){let duration=0;if(!_.isUndefined($target.data("duration"))){duration=parseInt($target.data("duration"))/1e3}setTimeout(function(){$target.hide()},duration)}else{$target.show()}}else{if(onlyHide){$target.hide()}else{$target.toggle()}}},async handleToggleSlide($html){let self=this;$html.find(this.config.selectorToggleSlide).each(function(){let $widget=$(this);if($(this).data("toggle_slide")!==undefined&&$(this).data("toggle_slide")!=0){if(!_.isUndefined($widget.data("default_hide"))&&parseInt($widget.data("default_hide"))===1){$(".w30s-widget-unique-"+$(this).data("toggle_slide")).hide()}$widget.unbind("click").click(function(e){e.preventDefault();console.log("click an");if($(this).data("toggle_slide")!==undefined){let $target=$(".w30s-widget-unique-"+$(this).data("toggle_slide"));self._doToggleSlide($target)}})}})},async handleSeeMoreCollapse($html){$html.find(this.config.selectorSeeMoreCollapse).each(function(){let $widget=$(this);if($(this).data("object_id")!==undefined&&$(this).data("object_id")!=0){let $target=$(".w30s-widget-unique-"+$(this).data("object_id"));let $widget_text=$($target).find(".w30s-widget-text").first();let height_large=$widget_text.outerHeight()||$target.outerHeight();if(height_large<$target.outerHeight()){$(this).hide()}$widget.unbind("click").click(function(e){e.preventDefault();if($(this).data("object_id")!==undefined){let text=$(this).data("text");let text_current=$(this).find("span.w30s-content").text();if(!$target.hasClass("js-height-auto")){$target.addClass("js-height-auto");$target.css({height:"auto"});$(this).find("span.w30s-content").text(text);$(this).data("text",text_current)}else{$target.css({height:""});$target.removeClass("js-height-auto");$(this).find("span.w30s-content").text(text);$(this).data("text",text_current)}}})}})},handleClearForm($html){let self=this;let $obj=null;if(_.isString($html)){$obj=$($html)}else{$obj=$html.find(this.config.selectorClearForm)}$obj.off().click(function(e){e.preventDefault();self.clearForm($(this).closest("form"))})},initSliderRange($html,dataUpdate){let self=this;$html.find(this.config.selectorSliderRangeBox).each(function(idx,el){let $sliderRangeBox=$(el);let $sliderRange=$sliderRangeBox.find(self.config.selectorSliderRange);let myRange=$sliderRange.data("ionRangeSlider");let config={};if(dataUpdate&&dataUpdate.price_min){config=$.extend(true,{},{from:parseFloat(dataUpdate.price_min),to:parseFloat(dataUpdate.price_max)})}if(myRange){myRange.update(config)}else{$sliderRange.ionRangeSlider($.extend(true,{type:"double",skin:$sliderRangeBox.data("skin")!==""?$sliderRangeBox.data("skin"):"falt",onFinish:function(data){if($sliderRangeBox.data("event")==="product"){$(".w30s-list-product[data-render]").each(function(idx1,el1){let $widgetRender=$(el1);let widgetId=$widgetRender.data("id");if(!self.queryDataWidget.hasOwnProperty(widgetId)){return}$widgetRender.find(".w30s-repeater-box").html("");self.queryDataWidget[widgetId].price_min=data.from;self.queryDataWidget[widgetId].price_max=data.to;self.loadDataWidget($widgetRender)})}}},config))}})},getDevice(){let device="desktop";let deviceWidth=document.body.clientWidth;if(deviceWidth<=1024&&deviceWidth>768){device="1024px"}else if(deviceWidth<=768&&deviceWidth>640){device="768px"}else if(deviceWidth<=640&&deviceWidth>480){device="640px"}else if(deviceWidth<=480&&deviceWidth>375){device="480px"}else if(deviceWidth<=375&&deviceWidth>320){device="375px"}else if(deviceWidth<=320){device="320px"}return device},async getDataContentPage(){if(DataStorage.has("content_data_page")){return{data:DataStorage.get("content_data_page")}}else if(isBase!=1){let resp=await loader.ajaxPromise({url:base_url+"/page/data-content-page-json"});DataStorage.set("content_data_page",resp.data);return resp}return{data:{}}},setDataSlider($html){let dataSlider=DataStorage.get("dataSlider",[]);$html.find(".w30s-data-slider").each((idx,el)=>{let $el=$(el);try{let dataWidget=JSON.parse($el.html());let filterDuplicate=_.filter(dataSlider,item=>{return item.id===dataWidget.id});if(filterDuplicate.length==0){dataSlider.push({id:dataWidget.id,type_config:dataWidget.type_config_slider});DataStorage.set("dataSlider",dataSlider)}}catch(err){console.log(err);console.log("WidgetEvent:setDataSlider")}$el.remove()});dataSlider=null},setData3DFlipBook($html){let data3DFlipBook=DataStorage.get("data3DFlipBook",[]);$html.find(".w30s-data-3d-flip-book").each((idx,el)=>{let $el=$(el);try{let dataWidget=JSON.parse($el.html());let filterDuplicate=_.filter(data3DFlipBook,item=>{return item.id===dataWidget.id});if(filterDuplicate.length==0){data3DFlipBook.push({id:dataWidget.id,config_lib:dataWidget.type_config.config_lib});DataStorage.set("data3DFlipBook",data3DFlipBook)}}catch(err){console.log("WidgetEvent:setData3DFlipBook")}$el.remove()});data3DFlipBook=null},setDataSubmenu4($html){let dataSubmneu=DataStorage.get("dataSubmneu",{});$html.find("."+this.config.classWidgetSubmenuV4).each((idx,el)=>{try{let $el=$(el);let $textarea=$(el).find("textarea");if(!dataSubmneu.hasOwnProperty($el.data("id"))&&$textarea.html().length>0){dataSubmneu[$el.data("id")]=JSON.parse($textarea.html())}DataStorage.set("dataSubmneu",dataSubmneu);$textarea.remove()}catch(err){console.log("setDataSubmenu4 => ",err)}});dataSubmneu=null},setDataFilterSelect($html,dataAdd){let dataFilterSelect=DataStorage.get("dataFilterSelect",[]);let doFuncPush=dataWidget=>{let filterDuplicate=_.filter(dataFilterSelect,(item,key)=>{if(item.id===dataWidget.id){dataFilterSelect[key].content_data=dataWidget.content_data;return true}});if(filterDuplicate.length==0){dataFilterSelect.push({id:dataWidget.id,content_data:dataWidget.content_data});DataStorage.set("dataFilterSelect",dataFilterSelect)}};if(dataAdd!=null&&_.isObject(dataAdd)){doFuncPush(dataAdd)}if($html!=null){$html.find(".w30s-data-filter-select").each((idx,el)=>{let $el=$(el);try{let dataWidget=JSON.parse($el.html());doFuncPush(dataWidget)}catch(err){console.log("WidgetEvent:setDataFilterSelect")}$el.remove()})}dataFilterSelect=null},setDataWidgetUsedEventLoadDataDefault($html,dataAdd){let self=this;let dataFilterSelect=DataStorage.get("dataWidgetUsedEventLoadDataDefault",[]);let doFuncPush=dataWidget=>{let filterDuplicate=_.filter(dataFilterSelect,(item,key)=>{if(item.id===dataWidget.id){dataFilterSelect[key].content_data=dataWidget.content_data;return true}});if(filterDuplicate.length==0){dataFilterSelect.push(dataWidget);DataStorage.set("dataWidgetUsedEventLoadDataDefault",dataFilterSelect)}};if(dataAdd!=null&&_.isObject(dataAdd)){doFuncPush(dataAdd)}if($html!=null){$html.find(this.config.selectorEventChangeLoadData).each((idx,el)=>{try{if(!_.isUndefined($(el).data("content_type"))&&_.contains([self.CONTENT_TYPE_DEFAULT],parseInt($(el).data("content_type")))){let $els=[];$els.push($(el));$els.map($el=>{let dataWidget=JSON.parse($el.find(".w30s-data-widget").html());doFuncPush(dataWidget);$el.find(".w30s-data-widget").remove()})}}catch(err){console.log(err);console.log("WidgetEvent:setDataWidgetUsedEventLoadDataDefault")}})}dataFilterSelect=null},initSlider(){this.curentDevice=this.getDevice();DataStorage.get("dataSlider",[]).map(data=>{$(".w30s-widget-"+data.id).each((idx,el)=>{this.handleSlider($(el),data)})})},initWindowResize(){let $html=$("body");$(window).resize(e=>{let device=this.getDevice();if(this.curentDevice!==device){this.curentDevice=device;widgetAnimation.setPositionMarquee();this.handleScrollTop($html);this.handleMenu($html);this.changeReponsiveSubmenu4($html,device);this.handleNiceSroll();DataStorage.get("dataSlider",[]).map(data=>{let $slider=$(".w30s-widget-"+data.id);let key=0;if($slider.length>1&&data.hasOwnProperty("key")){key=data.key}this.handleSlider($slider[key],data)});if(_.isFunction(window.fbAsyncInit)){window.fbAsyncInit()}}this.handleFullHeight($html)})},setDeviceInfo(){$.when(loader.postAjax(this.config.urlSetDeviceInfo,{device_width:document.body.clientWidth})).then(function(resp){if(resp.reload===true){window.location.reload()}})},handleAddMemberChat($html){let self=this;let $obj=$html.find(this.config.selectorAddMemberChat);let $form=$obj.parents("form").first();let $inputForm=$form.find("input");$obj.off().click(function(e){e.preventDefault();(async()=>{loader.showLoader();let dataForm=$form.serializeObject();dataForm.order_id=$obj.data("order_id");let resp=await loader.ajaxPromise({type:"POST",url:self.config.urlAddMemberChat,data:dataForm});if(resp.result){core.showSuccess(resp.message);self.clearForm($form);$(".w30s-widget-member-chat[data-render]").each((idx,el)=>{self.renderWidget($(el),resp)})}else{if(resp.hasOwnProperty("message")){core.showError(resp.message)}if(resp.hasOwnProperty("error")){core.showErrorForm(resp.error,$form)}}})()});if($inputForm.length>0){$inputForm.on("keydown",function(e){if(e.which===13){$(selector).trigger("click")}})}},handleLogin($html){let self=this;let $obj=null;if(_.isString($html)){$obj=$($html)}else{$obj=$html.find(this.config.selectorLogin)}$obj.each(function(){let selector=$(this);let $form=selector.parents("form").first();let $inputForm=$form.find("input");selector.off().click(function(e){e.preventDefault();(async()=>{loader.showLoader();let dataForm=$form.serializeObject();if(dataForm.password.length>0){dataForm.password=MD5("bang.vn"+dataForm.password)}let resp=await loader.ajaxPromise({type:"POST",url:self.config.urlLoginMember,data:dataForm});if(resp.result){core.showSuccess(resp.message);if(!_.isUndefined(resp.url_referer)&&!_.isEmpty(resp.url_referer)){window.location.href=resp.url_referer}else{window.location.href="/member/info"}}else{if(resp.hasOwnProperty("message")){core.showError(resp.message)}if(resp.hasOwnProperty("error")){core.showErrorForm(resp.error,$form)}}})()});if($inputForm.length>0){$inputForm.on("keydown",function(e){if(e.which===13){selector.trigger("click")}})}})},handleLoginSocial($html){$html.find(this.config.selectorLoginSocial).off().click(function(e){e.preventDefault();let url=$(this).data("url");if(!_.isUndefined(url)&&url.length>0){window.location.href=url}})},handleForgotPassword($html){let self=this;let $obj=$html.find(this.config.selectorForgotPassword);$obj.each(function(){let selector=$(this);let $form=selector.parents("form").first();let $inputForm=$form.find("input");selector.off().click(function(e){e.preventDefault();(async()=>{loader.showLoader();let data=$form.serializeObject();if($form.data("id")){data.widget_id=$form.data("id")}let resp=await loader.ajaxPromise({type:"POST",url:self.config.urlLostPasswordMember,data:data});if(resp.result){core.showSuccess(resp.message);self.clearForm($form);$form.find(self.config.selectorRefreshCaptcha).trigger("click")}else{if(resp.hasOwnProperty("message")){core.showError(resp.message)}if(resp.hasOwnProperty("error")){core.showErrorForm(resp.error,$form)}}})()});if($inputForm.length>0){$inputForm.on("keydown",function(e){if(e.which===13){$(selector).trigger("click")}})}})},handleRegister($html){let self=this;let $obj=$html.find(this.config.selectorRegister);$obj.each(function(){let selector=$(this);let $form=selector.parents("form").first();let $inputForm=$form.find("input");selector.off().click(function(e){e.preventDefault();(async()=>{loader.showLoader();let data=self.registerValidate($form.serializeObject());if($form.data("id")){data.data.widget_id=$form.data("id")}if(!data.pass){core.showError(lang.member_register_fail);core.showErrorForm(data.error,$form);loader.hideLoader()}else{let resp=await loader.ajaxPromise({type:"POST",url:self.config.urlRegiterMember,data:data.data});if(resp.result){core.showSuccess(resp.message);if(resp.data.is_authentication_phone){window.location.href=`/member/phone-authentication/${resp.data.member.id}`}else{window.location.href="/dang-nhap"}}else{if(resp.hasOwnProperty("message")){core.showError(resp.message)}if(resp.hasOwnProperty("error")){core.showErrorForm(resp.error,$form)}}}})()});if($inputForm.length>0){$inputForm.on("keydown",function(e){if(e.which===13){selector.trigger("click")}})}})},registerValidate(formData){let data={pass:true,error:{}};if(formData.fullname.length===0){data.error.fullname=lang.error_password_not_regex;data.pass=false}if(formData.username.length===0){data.error.username=lang.error_username_required;data.pass=false}if(formData.phone.length===0){data.error.phone=lang.error_phone_required;data.pass=false}if(formData.email.length===0){data.error.email=lang.error_email_required;data.pass=false}if(!formData._token){if(formData.captcha.length===0){data.error.captcha=lang.error_captcha_required;data.pass=false}}if(formData.password.match(".*^(?=.{6,})(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9]).*")===null||formData.password.match(".*^(?=.{6,})(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9]).*")<1){data.error.password=lang.error_password_not_regex;data.pass=false}formData.password=MD5("bang.vn"+$.trim(formData.password));formData.password_confirm=MD5("bang.vn"+$.trim(formData.password_confirm));if(formData.password!==formData.password_confirm){data.error.password_confirm=lang.error_password_confirm_invalid;data.pass=false}data.data=formData;return data},handlePanorama($html){$html.find(this.config.selectorWidgetPanorama).each((idx,el)=>{let $widget=$(el);try{let type_config=JSON.parse($widget.find("textarea").html());type_config=$.extend(true,{autoLoad:true,showControls:false,escapeHTML:true,compass:false,northOffset:true,autoRotate:0,mouseZoom:false,disableKeyboardCtrl:true,doubleClickZoom:false},type_config);$.each(type_config.scenes,(kScene,scene)=>{$.each(scene.hotSpots,(kHotspot,hotSpot)=>{hotSpot.showPointTransform3d=false;hotSpot.isCreateHotSpotHelper=false;hotSpot.disableUrl=false;hotSpot.cssClass="w30s-hotspot";hotSpot.createTooltipFunc=((div,hs,_this)=>_this.customBodyHotspot(div,hs,{company_id:company_id}));scene.hotSpots[kHotspot]=hotSpot});type_config.scenes[kScene]=scene});let panoViewer=pannellum.viewer($widget.data("panorama"),type_config);panoViewer.on("load",()=>{panoViewer.resize();setTimeout(()=>panoViewer.resize(),50)});if(type_config.showCustomControls){$widget.find(".w30s-ctrl-up").unbind("click").click(e=>{panoViewer.setPitch(panoViewer.getPitch()+10,50)});$widget.find(".w30s-ctrl-down").unbind("click").click(e=>{panoViewer.setPitch(panoViewer.getPitch()-10,50)});$widget.find(".w30s-ctrl-left").unbind("click").click(e=>{panoViewer.setYaw(panoViewer.getYaw()-10,50)});$widget.find(".w30s-ctrl-right").unbind("click").click(e=>{panoViewer.setYaw(panoViewer.getYaw()+10,50)});$widget.find(".w30s-ctrl-auto-rotate").unbind("click").click(e=>{let $btn=$(e.currentTarget);$btn.toggleClass("w30s-rotating");if($btn.hasClass("w30s-rotating")){panoViewer.startAutoRotate(type_config.autoRotate===0?-2:type_config.autoRotate===0);$btn.find("i").removeClass("fa-play").addClass("fa-pause")}else{$btn.find("i").removeClass("fa-pause").addClass("fa-play");panoViewer.stopAutoRotate()}});$widget.find(".w30s-ctrl-zoom-in").unbind("click").click(e=>{panoViewer.setHfov(panoViewer.getHfov()+10,50)});$widget.find(".w30s-ctrl-zoom-out").unbind("click").click(e=>{panoViewer.setHfov(panoViewer.getHfov()-10,50)});$widget.find(".w30s-ctrl-fullscreen").unbind("click").click(e=>{panoViewer.toggleFullscreen()});helper.initToolTip($widget)}if(type_config.showMenuScene){$widget.find(".w30s-nav-scenes>.w30s-scene").unbind("click").click(e=>{e.preventDefault;let $obj=$(e.currentTarget);let scene=$obj.data("scene");if(scene!==panoViewer.getScene()){$obj.addClass("active").siblings().removeClass("active");panoViewer.loadScene(scene)}});$widget.find('.w30s-nav-scenes [data-scene="'+panoViewer.getScene()+'"]').addClass("active").siblings().removeClass("active")}}catch(e){console.log(e)}})},handleProductReview($html){let self=this;let $obj=$html.find(this.config.selectorProductReview);$obj.each(function(){let selector=$(this);let $form=selector.parents("form").first();let $inputForm=$form.find("input");selector.off().click(function(e){e.preventDefault();(async()=>{loader.showLoader();let data=self.productReviewValidate($form.serializeObject());if(!data.pass){core.showError(lang.send_product_reviews_error);core.showErrorForm(data.error,$form);loader.hideLoader()}else{let resp=await loader.ajaxPromise({type:"POST",url:"product/product-review-json",data:data.data});if(resp.result){core.showSuccess(resp.message);if($form.hasClass("w30s-after-submit-toggle-slide")){if($form.data("toggle_slide")!==undefined){$(".w30s-widget-unique-"+$form.data("toggle_slide")).toggle()}}}else{core.showErrorForm(resp.error,$form);if(resp.hasOwnProperty("message")){core.showError(resp.message)}}}})()});if($inputForm.length>0){$inputForm.on("keydown",function(e){if(e.which===13){selector.trigger("click")}})}})},productReviewValidate(formData){let data={pass:true,error:{}};if(formData.fullname.length===0){data.error.fullname=lang.error_fullname_required;data.pass=false}if(formData.email.length===0){data.error.email=lang.error_email_required;data.pass=false}if(formData.content.length===0){data.error.content=lang.error_content_required;data.pass=false}data.data=formData;return data},handleRegistrySubscribe($html){let self=this;let $obj=$html.find(this.config.selectorRegisterSubscribe);$obj.off().click(function(e){e.preventDefault();let $obj=$(this);let email=$obj.closest("form").find('[name="email"]');let regex=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z-0-9]{2,4})+$/;if(!regex.test(email.val())){core.showError(lang.error_email_invalid);email.focus();return false}loader.showLoader();$.when(loader.postAjax(self.config.urlAddNewsletter,{email:email.val()})).then(function(resp){if(resp.result==1){core.showError(lang.error_email_invalid)}else if(resp.result==2){core.showError(lang.error_email_exists)}else if(resp.result==0){email.val("");core.showSuccess(lang.default_newsletter_thanks)}else{email.val("")}})})},handleRefreshCaptcha($html){let $obj=null;if(_.isString($html)){$obj=$($html)}else{$obj=$html.find(this.config.selectorRefreshCaptcha)}$obj.off().click(function(e){e.preventDefault();let $obj=$(this);let $widget=$obj;if(!$obj.hasClass("w30s-widget")){$widget=$obj.parent()}$widget.find("img").prop("src",$widget.data("src")+"&time="+(new Date).getTime())})},handleSendContact($html){let self=this;let $obj=null;if(_.isString($html)){$obj=$($html)}else{$obj=$html.find(this.config.selectorSendContact+" , "+this.config.selectorSendContactFormDynamic)}$obj.off().click(function(e){e.preventDefault();if(self.isProcessing){return false}self.isProcessing=true;(async()=>{let $form=$(this).parents("form").first();let data=$form.serializeObject();if($obj.hasClass(self.config.selectorSendContactFormDynamic.replace(".",""))){data.has_form_dynamic=1;_.mapObject(data,(idx,key)=>{let $obj=$("input[type=radio][name="+key+']:checked,input[type=radio][name="'+key+'[]"]:checked,'+"input[type=checkbox][name="+key+']:checked,input[type=checkbox][name="'+key+'[]"]:checked,'+"select[name="+key+'] :selected,select[name="'+key+'[]"] :selected');if($obj.length>0){data[key]="";let els=[];if($obj.attr("type")=="radio"){$obj.map((k,elRadio)=>{els.push($(elRadio).siblings("label").first())})}else if($obj.attr("type")=="checkbox"){$obj.map((k,elRadio)=>{els.push($(elRadio).siblings(".item-name").first())})}else{$obj.map((k,elSelect)=>{els.push($(elSelect))})}els.map(elTmp=>{let vTmp=$(elTmp).text();data[key]=data[key]!=""?data[key]+", "+vTmp:vTmp})}})}if($form.data("id")){data.widget_id=$form.data("id")}loader.showLoader();let resp=await loader.ajaxPromise({type:"POST",url:self.config.urlAddFormContact,data:data});$form.find(self.config.selectorRefreshCaptcha).trigger("click");self.isProcessing=false;if(resp.result){if(is_satellite&&typeof dataLayer!="undefined"){if(data.hasOwnProperty("has_form_dynamic")&&data.has_form_dynamic==1){if(!_.isUndefined(resp.data.fields_email)&&resp.data.fields_email.length>0){resp.data.fields_email.map(val=>{data.hasOwnProperty(val)&&dataLayer.push({event:"formSubmission",email:data[val]})})}}else if(data.hasOwnProperty("email")){dataLayer.push({event:"formSubmission",email:data.email})}console.log(dataLayer)}core.showSuccess(resp.message);$form.find(self.config.selectorClearForm).trigger("click")}else{core.showError(resp.message);core.showErrorForm(resp.error,$form)}})()})},handleSearch($html){let self=this;let $widgets=$html;if(!$widgets.hasClass(this.config.selectorWidgetSearch.replace(".",""))){$widgets=$html.find(this.config.selectorWidgetSearch)}const checkKeyword=$widgetSearch=>{let ext_keyword=$widgetSearch.data("ext_keyword")||"";let $input=$widgetSearch.find('input[name="keyword"]');let value=$.trim($input.val());if(ext_keyword&&ext_keyword.length>0&&value.length>0){let arrValue=value.split(".");if(arrValue.length===1||_.isEmpty(arrValue[1])){value+=(value.indexOf(".")<0?".":"")+ext_keyword;$input.val(value).attr("value",value)}}};const checkExtDomainSugest=$widgetSearch=>{let exts_sugest=$widgetSearch.data("list_ext_domain_suggest")||"";if(exts_sugest!=""){$widgetSearch.append("<input type='hidden' name='list_ext_domain_suggest' value='"+exts_sugest+"' />")}};$widgets.each(function(){let $widgetSearch=$(this);if($widgetSearch.hasClass(self.config.classShowPopupSearch)){$widgetSearch.find(self.config.selectorWidgetSearchPopup).click(function(e){if(e.target===this||e.target.nodeName==="I"){e.preventDefault();let $modalPopup=$widgetSearch.find("form");let $buttonSubmit=$widgetSearch.find(".w30s-widget-button:not(.w30s-action-close-popup)");$modalPopup.toggleClass("active");$buttonSubmit.off("click").click(function(){checkKeyword($widgetSearch);$modalPopup.submit()});$widgetSearch.find(".w30s-action-close-popup").on("click",function(e){e.preventDefault();$modalPopup.toggleClass("active")})}})}else{$widgetSearch.find(".w30s-widget-button").unbind("click").click(function(){checkKeyword($widgetSearch);checkExtDomainSugest($widgetSearch);if($widgetSearch.find(self.config.selectorWidgetTab).length>0){$widgetSearch.find(".tab-pane:not(.active)").remove()}let $widgetSelectCategory=$widgetSearch.find(".tab-pane.active").find(self.config.selectorWidgetFilterSelect+" select"+self.config.selectorBootstrapSelect+'[name="'+self.SEARCH_NAME_CATEGORY_ID_IN+'[]"]');if($widgetSelectCategory.length>0&&$widgetSelectCategory.val().length>0){$widgetSearch.find('.tab-pane.active input[name="'+self.SEARCH_NAME_CATEGORY_ID_IN+'[]"]').remove()}$widgetSearch.submit()})}$widgetSearch.find('input[name="keyword"]').unbind("focus").focus(function(e){e.preventDefault();$(this).unbind("keydown").on("keydown",function(e){if(e.keyCode==13||e.which==13){checkKeyword($widgetSearch);if($widgetSearch.prop("tagName").toLowerCase()==="form"){$widgetSearch.submit()}else{$widgetSearch.find("form").submit()}}})});let queryPage=DataStorage.get("query_page",{});$widgetSearch.find(self.config.selectorWidgetFilterSelect).each(function(){let $widgetSelect=$(this);let widgetContentField=$widgetSelect.data("content_field");let widgetContentType=$widgetSelect.data("content_type");if(widgetContentType===self.CONTENT_TYPE_ROOT&&(widgetContentField===self.CONTENT_FIELD_PROVINCE||queryPage.hasOwnProperty("province_id")&&widgetContentField===self.CONTENT_FIELD_DISTRICT||queryPage.hasOwnProperty("district_id")&&widgetContentField===self.CONTENT_FIELD_WARD||queryPage.hasOwnProperty("district_id")&&widgetContentField===self.CONTENT_FIELD_STREET)){self.handleSetDataQuery($widgetSelect,null,"load",$widgetSearch)}else{self.handleWidgetFilterSelect($widgetSelect)}})})},handleMenu($html){let $widget=$html;let self=this;if(!$html.hasClass("w30s-widget")){$widget=$html.find(this.config.selectorWidgetMenu)}let selectorId=$widget.attr("id");let selectorNav=$widget.data("nav");let $domCloneMenu=$(".w30s-widget-menu-root");let deviceDenied=["desktop","1024px"];switch($widget.data("device")){case"desktop":deviceDenied=[];break;case 1024:deviceDenied=["desktop"];break}let device=this.getDevice();let hasSlideMobile=false;if(!_.contains(deviceDenied,device)&&parseInt($widget.data("is_mobile"))===1){$widget.addClass("active");let $menuNav=$("#"+selectorNav);if($menuNav.length<=0){return false}let baseConfigure={counters:true,onClick:{close:true},wrappers:["bootstrap"],navbar:false,navbars:[{position:"top",content:["prev",$widget.data("title")?$widget.data("title"):"","close"]}],extensions:["pagedim-black","border-full","multiline",$widget.data("position_mobile")?$widget.data("position_mobile"):"position-left"]};if($domCloneMenu.find("#"+selectorNav).length<=0){$domCloneMenu.append($menuNav.clone())}$widget.find('a[href="#"], a[href="javascript:void(0)"]').removeAttr("href");if($widget.find("#"+selectorNav).length>0&&$("body").find(">#"+selectorNav).length<=0){$widget.find("nav i").addClass("d-none");$widget.find("nav>ul>li>ul").each(function(){$(this).attr("class",$(this).data("class"))});window[selectorNav]=new Mmenu("#"+selectorNav,baseConfigure,{offCanvas:{page:{selector:"#"+selectorId}},classNames:{selected:"active"}});let menuAPI=window[selectorNav].API;document.querySelector("#"+selectorId+">i").addEventListener("click",e=>{e.preventDefault();menuAPI.open()});if($widget.data("page_slideout")==1){$(".w30s-section").addClass("mm-page mm-slideout")}}hasSlideMobile=true}else{$widget.removeClass("active");$widget.find("nav i").removeClass("d-none");$widget.each(function(){let domNav=$(this).data("nav");let $domCLone=$domCloneMenu.find("#"+domNav);if($(this).find("#"+domNav).length<=0&&$domCLone.length>0){$(this).append($domCLone.clone())}});if($widget.find("nav ul.submenu-static").length<=0&&$widget.find(".w30s-widget-menu-type-3").length<=0){let sizeSubmenu=200;$widget.find("nav > ul > li.w30s-widget-menu-has-child").each(function(){let $li=$(this);if(!$li.find(">ul").hasClass("menu-product")){let lengthItem=0;sizeSubmenu=$(this).find(">ul").first().width();lengthItem+=sizeSubmenu;if($(this).find(">ul>li").hasClass("w30s-widget-menu-has-child")){lengthItem+=sizeSubmenu;if($(this).find(">ul>li li").hasClass("w30s-widget-menu-has-child")){lengthItem+=sizeSubmenu}}if(lengthItem>$(window).outerWidth()-$(this).offset().left){$(this).addClass("w30s-menu-overdue-window");$(this).find(">ul i").each(function(){$(this).removeAttr("class").addClass($(this).data("class-over"))})}}})}if($widget.find(".w30s-widget-menu-type-2 .w30s-menu-box-product").length>0){$widget.find(".w30s-widget-menu-type-2 .w30s-menu-box-product").css("width",$widget.outerWidth()+"px").parents(".w30s-widget-menu-has-child").first().removeClass("w30s-widget-menu-has-child");$widget.find(".w30s-menu-box-product").parent("li").each(function(){let $li=$(this);let ulWidth=$li.find(".w30s-menu-box-product > ul");ulWidth.parent(".w30s-menu-box-product").css({display:"block",opacity:0});if(ulWidth.outerWidth()<$widget.outerWidth()){if($li.offset().left>=$widget.outerWidth()*.33&&$li.offset().left<=$widget.outerWidth()*.66){$li.find(".w30s-menu-box-product > ul").css({left:"50%",transform:"translateX(-50%)"})}else if($li.offset().left>$widget.outerWidth()*.66){$li.find(".w30s-menu-box-product > ul").css({left:"100%",transform:"translateX(-100%)"})}}ulWidth.parent(".w30s-menu-box-product").css({display:"",opacity:1})})}if($widget.hasClass("w30s-widget-menu-click")){$widget.find("nav a, i").unbind("click").click(function(e){let $parent=$(e.target).parents("li").first();if($(e.currentTarget).prop("tagName").toLowerCase()==="a"){let $a=$(e.target);if($a.attr("href")=="#"||$a.attr("href")=="javascript:void(0)"||$a.attr("href")==""){e.preventDefault();if($parent.find(".w30s-menu-box-product").length>0){$parent.find(".w30s-menu-box-product").toggleClass("active")}else{$parent.find(">ul").toggleClass("active")}}}else{e.preventDefault();if($parent.find(".w30s-menu-box-product").length>0){$parent.find(".w30s-menu-box-product").toggleClass("active")}else{$parent.find(">ul").toggleClass("active")}}})}}this.handleEventSlideLandingPage($widget);if(hasSlideMobile){let $widgetMobile=$("#w30s-widget-menu-nav-"+$widget.data("id"));if($widgetMobile.length===0){let timer=0;let interval1=setInterval(()=>{timer++;if($widgetMobile.length>0){clearInterval(interval1);this.handleEventSlideLandingPage($widgetMobile)}if(timer>=5){clearInterval(interval1)}},1e3)}else{this.handleEventSlideLandingPage($widgetMobile);$widgetMobile=null}}},handleWidgetTab($html){let self=this;let $widgets=$html;if(!$widgets.hasClass(this.config.classWidgetTab)){$widgets=$html.find(this.config.selectorWidgetTab)}let _funcHandleSlide=(dataSlider,$widgetSlider,$tabActive)=>{let data=_.findWhere(dataSlider,{id:!_.isUndefined($widgetSlider.data("id"))?parseInt($widgetSlider.data("id")):0});if(!_.isUndefined(data)&&!_.isEmpty(data)){if($(".w30s-widget-"+$widgetSlider.data("id")).length>1&&!_.isUndefined($tabActive)){$widgetSlider.find(self.config.selectorWidgetSlider).attr("id","slider-"+$widgetSlider.data("id")+"-"+$tabActive.attr("id"));data.key=$widgetSlider.find(self.config.selectorWidgetSlider).attr("id")}self.handleSlider($widgetSlider[0],data)}};$widgets.each(function(){let $widget=$(this);let contentType=!_.isUndefined($widget.data("content_type"))?$widget.data("content_type"):"";let dataSlider=DataStorage.get("dataSlider",[]);$widget.find(".nav a.nav-item").click(function(e){if(!$(this).hasClass("active")){$widget.find(".w30s-stop-widget-youtube").each(function(){this.contentWindow.postMessage('{"event":"command","func":"stopVideo","args":""}',"*")})}if(!$(this).hasClass("has-link")){e.preventDefault();let $navItem=$(this);let $widget=$navItem.parents(self.config.selectorWidgetTab).first();if($widget.data("hash")==1){window.location.hash=$navItem.data("href")}$widget.find(".tab-pane").removeClass("active");let $tabActive=$widget.find($navItem.data("href")).tab("show");if($tabActive.length>0&&$tabActive.find(self.config.selectorWidgetSlider).length>0){$tabActive.find(self.config.selectorWidgetSlider).each(function(){let $widgetSlider=$(this);_funcHandleSlide(dataSlider,$widgetSlider,$tabActive)})}if(typeof window.fbAsyncInit==="function"){try{window.fbAsyncInit()}catch(e){}}}else{window.open($(this).attr("href"),$(this).attr("target"))}});switch(contentType){case self.CONTENT_TYPE_CLASSIFIED_NEWS_CATEGORY:let queryPage=DataStorage.get("query_page",{});if(queryPage.hasOwnProperty(self.SEARCH_NAME_CATEGORY_ID_IN)){let isContinue=true;$widget.find("nav .nav-item").each(function(){if(isContinue){let $tabItem=$(this);if(!_.isUndefined($(this).data("id"))&&(queryPage[self.SEARCH_NAME_CATEGORY_ID_IN].indexOf($(this).data("id"))>=0||queryPage[self.SEARCH_NAME_CATEGORY_ID_IN].indexOf($(this).data("id").toString())>=0)){isContinue=false;$tabItem.trigger("click")}else{$widget.find($tabItem.data("href")).find(self.config.selectorWidgetFilterSelect).find(self.config.selectorBootstrapSelect+" option").each(function(){if(!_.isUndefined($(this).data("id"))&&(queryPage[self.SEARCH_NAME_CATEGORY_ID].indexOf($(this).data("id"))>=0||queryPage[self.SEARCH_NAME_CATEGORY_ID].indexOf($(this).data("id").toString())>=0)){$tabItem.trigger("click")}})}}})}break;default:if(window.location.hash&&window.location.hash.length>0&&$widget.find('.nav a.nav-item[href="'+window.location.hash+'"]').length>0){$widget.find('.nav a.nav-item[href="'+window.location.hash+'"]').trigger("click")}else if(window.location.href&&$widget.find('.nav a.nav-item[href="'+window.location.href+'"]').length>0){$widget.find('.nav a.nav-item[href="'+window.location.href+'"]').trigger("click")}}$widget.find(".tab-content .tab-pane").map((k,el)=>{let $el=$(el);$el.find(".w30s-widget-repeater, "+self.config.selectorWidgetSlider).map((k_1,el_1)=>{let $el_1=$(el_1);if(!_.isUndefined($el_1.data("render"))&&$el_1.data("content_type")==self.CONTENT_TYPE_WIDGET&&_.contains([self.CONTENT_FIELD_PRODUCT_LIST,self.CONTENT_FIELD_CLASSIFIED_NEWS_LIST,self.CONTENT_FIELD_REALTY_PROJECT_LIST,self.CONTENT_FIELD_NEWS_LIST,self.CONTENT_FIELD_SERVICE_LIST,self.CONTENT_FIELD_VIDEO_LIST,self.CONTENT_FIELD_ALBUM_LIST],$el_1.data("content_field"))&&$el.find("input[name=category_id]").length>0){$el_1.data("category_id",$el.find("input[name=category_id]").val())}if($el.hasClass("active")&&_.isUndefined($el_1.data("render"))&&$el_1.hasClass(self.config.selectorWidgetSlider.replace(".",""))){_funcHandleSlide(dataSlider,$el_1)}})});self.renderAllWidget($widget)})},handleWidgetSubmenu($html){let $widgets=null;if($html.hasClass("w30s-widget")&&$html.hasClass(this.config.classWidgetSubmenu)){$widgets=$html}else{$widgets=$html.find(this.config.selectorWidgetSubmenu)}$widgets.each(function(){let selector=$(this);let isFinish=true;let isHorizontal=$(this).hasClass("w30s-submenu-horizontal");if(selector.data("limit")>0&&selector.data("limit")<selector.find(">ul>li:not(.w30s-submenu-showmore)").length){let isFinishShowMore=true;$(this).find(">ul>li.w30s-submenu-showmore").removeClass("d-none").unbind("click").click(function(){if(isFinishShowMore){isFinishShowMore=false;if($(this).hasClass("active")){selector.find(">ul>li:not(.w30s-submenu-showmore).is-hide").slideUp(400,()=>{isFinishShowMore=true})}else{selector.find(">ul>li:not(.w30s-submenu-showmore).is-hide").slideDown(400,()=>{isFinishShowMore=true})}$(this).find(">span").toggleClass("d-none");$(this).find("i").toggleClass("d-none");$(this).toggleClass("active");selector.css("height","auto")}})}if(!selector.hasClass("w30s-submenu-type-hover")){selector.find(">ul li:not(.w30s-submenu-showmore)>span i").unbind("click").click(function(e){if(isFinish){isFinish=false;e.preventDefault();let parentLi=$(this).closest("li").first();let siblingsLi=parentLi.siblings("li:not(.w30s-submenu-showmore)");if(parentLi.hasClass("active")){parentLi.find("i.is-show").removeClass("d-none");parentLi.find("i.is-hide").addClass("d-none");if(isHorizontal){parentLi.parent().find("ul").hide();isFinish=true}else{parentLi.parent().find("ul").stop().slideUp(200,()=>{isFinish=true})}}else{siblingsLi.find("i.is-show").removeClass("d-none");siblingsLi.find("i.is-hide").addClass("d-none");siblingsLi.removeClass("active");if(isHorizontal){siblingsLi.find(">ul").hide()}else{siblingsLi.find(">ul").stop().slideUp(200)}parentLi.find(">span>i.is-show").addClass("d-none");parentLi.find(">span>i.is-hide").removeClass("d-none");if(isHorizontal){parentLi.find(">ul").show();isFinish=true}else{parentLi.parent("ul").css("height","auto");parentLi.find(">ul").stop().slideDown(200,()=>{isFinish=true})}}parentLi.toggleClass("active")}})}else{selector.find(">ul li:not(.w30s-submenu-showmore)").unbind("hover").hover(function(){if(isHorizontal){$(this).find(">ul").first().stop().show()}else{$(this).parent("ul").css("height","auto");$(this).find(">ul").first().stop().slideDown(200)}},function(){if(isHorizontal){$(this).find(">ul").first().stop().hide()}else{$(this).find(">ul").first().stop().slideUp(200)}})}})},handleWidgetSubmenuV4($html){let $widgets=null;if($html.hasClass("w30s-widget")&&$html.hasClass(this.config.classWidgetSubmenuV4)){$widgets=$html}else{$widgets=$html.find("."+this.config.classWidgetSubmenuV4)}$widgets.each((id2,el)=>{let $widget=$(el);if($widget.find(">ul").length===0){return}this.changeReponsiveSubmenu4($widget);this.calcWidthSubmenu($widget,this.curentDevice);if($widget.data("limit")>0){if($widget.find(">ul>li:not(.w30s-show-more)").length>$widget.data("limit")){let limit=parseInt($widget.data("limit"))-1;$widget.find(">ul>li:not(.w30s-show-more):gt("+limit+")").css("display","none")}$widget.find(">ul>li.w30s-show-more").unbind("click").click(e=>{e.preventDefault();let $li=$(e.currentTarget);if($li.hasClass("running")){return}$li.toggleClass("opened").addClass("running");let items=$widget.find(">ul>li:not(.w30s-show-more):nth-child(n+"+($widget.data("limit")+1)+")");if($li.hasClass("opened")){items.slideDown(500,()=>$li.removeClass("running"))}else{items.slideUp(500,()=>$li.removeClass("running"))}})}this.handleEventOpenSubmenu4($widget)});this.handleEventSlideLandingPage($widgets)},openSubmenu4Default($widget,typeConfig){const openToLevel=($widget,level,target)=>{if(level==2){$widget.find("ul>li"+target+":not(.w30s-show-more)").removeClass("always-open").addClass("always-open")}if(level>=3){$widget.find("ul>li"+target+":not(.w30s-show-more)>.w30s-box-menu>ul>li").removeClass("always-open").addClass("always-open")}if(level>=4){$widget.find("ul>li"+target+":not(.w30s-show-more)>.w30s-box-menu>ul>li>.w30s-box-menu>ul>li").removeClass("always-open").addClass("always-open")}};$widget.find(".always-open").removeClass("always-open");if(typeConfig.open_to_level!==""&&typeConfig.open_to_level>1){openToLevel($widget,typeConfig.open_to_level,"")}if(_.isUndefined(typeConfig.style_custom)){return}$.each(typeConfig.style_custom,(key,item)=>{if(item==null){delete typeConfig.style_custom[key];return}if(item.open_to_level!==""&&item.open_to_level>1){openToLevel($widget,item.open_to_level,'[data-type="'+key+'"]')}})},handleEventOpenSubmenu4($widget){$widget.find("ul>li:not(.w30s-show-more)").unbind("mouseleave").unbind("mouseenter");$widget.find("ul>li:not(.w30s-show-more) a").unbind("click");if(!$widget.hasClass("w30s-hover")){$widget.find("ul>li:not(.w30s-show-more) a").click(e=>{let $objLi=$(e.target).parents("li").first();let $boxMenu=$objLi.find(">.w30s-box-menu");if(e.target.tagName.toLowerCase()!=="span"&&$objLi.find(">.w30s-box-menu>ul").length>0){e.preventDefault();let $old=$objLi.siblings("li:not(.w30s-show-more).open");$old.removeClass("active open");if($objLi.hasClass("open")&&!_.isUndefined(e.which)){$objLi.removeClass("active open")}else{$objLi.addClass("active open")}if($boxMenu.hasClass("w30s-slideDown")){$objLi.find(".active.open").find(">.w30s-box-menu").slideUp(300)}$objLi.find(".active.open").removeClass("active open");this.calcMaxheightToScreenBottom($widget,$objLi);if($objLi.hasClass("open")){if($boxMenu.hasClass("w30s-slideDown")){$old.find(">.w30s-box-menu").slideUp(300);$boxMenu.slideDown(300)}else{$objLi.addClass("open");if($boxMenu.hasClass("w30s-transition--flipXMatrix3d")){$boxMenu.css("--max-height",$boxMenu.find(">ul").outerHeight(true));$boxMenu.parents(".w30s-box-menu").css({"--max-height":"auto"})}}}else{if($boxMenu.hasClass("w30s-slideDown")){$boxMenu.slideUp(300)}}this.handleNiceSroll()}});if($widget.find("li li.active").length>0&&$widget.data("content_type")!=this.CONTENT_TYPE_MAIN_MENU){let $obj=$widget.find("li li.active").last();let arrItemsActive=[];$obj.parents("li").map((k,el)=>{arrItemsActive.unshift($(el))});arrItemsActive.map($el=>{$el.find(">div>a i").trigger("click")})}}else{$widget.find("ul>li:not(.w30s-show-more)").each((idx,el)=>{let $objLi=$(el);let $boxMenu=$objLi.find(">.w30s-box-menu");if($boxMenu.length>0){let timeL=0;let timeE=0;$objLi.unbind("mouseleave").mouseleave(e=>{if(moment().valueOf()-timeL<100){return}timeL=moment().valueOf();this.calcMaxheightToScreenBottom($widget,$(e.currentTarget));if($boxMenu.hasClass("w30s-slideDown")){$boxMenu.stop().slideUp(300)}this.handleNiceSroll()});$objLi.unbind("mouseenter").mouseenter(e=>{if(moment().valueOf()-timeE<100){return}timeE=moment().valueOf();let $obj=$(e.currentTarget);this.calcMaxheightToScreenBottom($widget,$obj);if($boxMenu.hasClass("w30s-slideDown")){$boxMenu.stop().slideDown(300)}else if($boxMenu.hasClass("w30s-transition--flipXMatrix3d")){$boxMenu.css("--max-height",$boxMenu.find(">ul").outerHeight(true))}this.handleNiceSroll()})}})}$widget.find("li.always-open").unbind("mouseleave").unbind("mouseenter");$widget.find("li.always-open>*:nth-child(1)>a").unbind("click")},calcPositionSubmenu($widget){let bounds=$("body")[0].getBoundingClientRect();$widget.find(">ul>li:not(.w30s-show-more)").each((idx,el1)=>{let $boxMenu2s=$(el1).find(">.w30s-box-menu");if($boxMenu2s.length===0){return}let left=$(el1).offset().left;$boxMenu2s.each((idx2,el2)=>{let $boxMenu2=$(el2);let $boxMenu3=$boxMenu2.find(">ul>li>.w30s-box-menu.w30s-position-right");let $boxMenu4=$boxMenu2.find(".w30s-box-menu.w30s-position-right .w30s-box-menu.w30s-position-right");$boxMenu4.removeClass("w30s-position-left").attr("style","");$boxMenu3.removeClass("w30s-position-left").attr("style","");$boxMenu2.removeClass("w30s-position-left").attr("style","");if($boxMenu2.find(">ul").hasClass("w30s-horizontal")){return}let maxWidth2=$boxMenu2.outerWidth();let maxWidth3=0;let maxWidth4=0;$boxMenu3.each(function(){if(maxWidth3<$(this).outerWidth()){maxWidth3=$(this).outerWidth()}});$boxMenu4.each(function(){if(maxWidth4<$(this).outerWidth()){maxWidth4=$(this).outerWidth()}});maxWidth2=maxWidth2===0?250:maxWidth2;maxWidth3=maxWidth3===0?250:maxWidth3;maxWidth4=maxWidth4===0?250:maxWidth4;if($boxMenu3.length>0){if(left+$boxMenu2.outerWidth()+maxWidth3+maxWidth4>bounds.right){$boxMenu4.addClass("w30s-position-left").css({left:"initial",right:"100%"});$boxMenu3.addClass("w30s-position-left").css({left:"initial",right:"100%"});$boxMenu2.addClass("w30s-position-left")}}else if(left+maxWidth2>bounds.right){$boxMenu2.addClass("w30s-position-left").css({left:"initial",right:0})}})})},calcWidthSubmenu($widget,currentDevice){$widget.find(">ul>li:not(.w30s-show-more)").each((idx,el)=>{let $objLi=$(el);let $box1=$objLi.find(">.w30s-box-menu");$box1.removeAttr("style");let $ul1=$widget.find(">ul");if($box1.length>0&&$box1.hasClass("w30s-fluid")&&$box1.data("level")==2){currentDevice=_.isUndefined(currentDevice)?this.getDevice():currentDevice;let currentDeviceNum=parseInt(currentDevice.replace("px",""));let dataSubmneu=DataStorage.get("dataSubmneu",{});let typeConfig=dataSubmneu.hasOwnProperty($widget.data("id"))?dataSubmneu[$widget.data("id")]:{};let keyStyle="style_lv"+$box1.data("level")+"_box";let style={};this.listDevice.map(device=>{if(device>=currentDeviceNum||device==="desktop"){device+=device==="desktop"?"":"px";typeConfig[device]=typeConfig[device]||{};style=$.extend(true,{},style,typeConfig[device][keyStyle]||{});if(_.isUndefined(typeConfig[device].style_custom)){return}if($objLi.data("type")&&typeConfig[device].style_custom[$objLi.data("type")]){style=$.extend(true,{},style,typeConfig[device].style_custom[$objLi.data("type")][keyStyle]||{})}}});if(_.isEmpty(style)){return}let calcLeft=$ul1.hasClass("w30s-horizontal");let calcWidth=true;let $boxCalc=$widget;if(style.width.toString().indexOf("w30s")>=0){$boxCalc=$widget.closest(".w30s-container-fluid");if($boxCalc.length===0){$boxCalc=$widget.closest(".w30s-container ")}}else if(!$box1.hasClass("w30s-position-bottom")&&!$box1.hasClass("w30s-position-right")){calcLeft=false;calcWidth=false}if(calcWidth){let matchCalc=style.width.match(/calc\(( )?([\d\.]+(%|w30s))( )+[+\-\*\/]( )+(\-)?([\d\.]+(px))( )?\)/i);if(matchCalc!==null){let percent=matchCalc[2];let widthTpl=($boxCalc.outerWidth()*(parseInt(percent.replace("%","").replace("w30s",""))/100)).toString()+"px";widthTpl=style.width.replace(matchCalc[2],widthTpl);$box1.css("width",widthTpl)}else if(style.width.toString().indexOf("%")>=0||style.width.toString().indexOf("w30s")>=0){let percent=parseFloat(style.width.toString().replace("%","").replace("w30s",""));$box1.css("width",percent/100*$boxCalc.outerWidth()+"px")}}if(calcLeft){setTimeout(()=>{$box1.css("left",-($objLi.offset().left-$boxCalc.offset().left)+($boxCalc.outerWidth()-$box1.outerWidth())/2)},500)}}})},calcMaxheightToScreenBottom($widget,$objLi){if($widget.parents(".w30s-section-position-fix").length===0){return}try{$widget.find(".w30s-box-menu>ul").removeAttr("style");let $ul=$objLi.find('>.w30s-box-menu[class*="w30s-position-"]>ul');if($ul.length===0){$ul=$objLi.parents('.w30s-box-menu[class*="w30s-position-"]').first().find(">ul")}if($ul.length===0||$ul.data("level")==1){return}let $boxUl=$ul.parent();$ul.removeAttr("style");$boxUl.removeAttr("style");let heightScrollTop=$(window).height()+$(window).scrollTop();let abc=$ul.outerHeight()-$(window).height()+20;abc=abc>0?-20:abc;let top=$ul.offset().top-$(window).scrollTop()+abc;if(top>0){$ul.parent().css("top",-top);let maxHeight=Math.abs($ul.offset().top-heightScrollTop)-20;$ul.css({"max-height":maxHeight+"px","overflow-y":"auto"})}else{$boxUl.css("top",0)}$boxUl=null;$ul=null}catch(e){}},changeReponsiveSubmenu4($html,currentDevice){currentDevice=_.isUndefined(currentDevice)?this.getDevice():currentDevice;let currentDeviceNum=parseInt(currentDevice.replace("px",""));let dataSubmneu=DataStorage.get("dataSubmneu",{});let $widgets=null;if($html.hasClass("w30s-widget")&&$html.hasClass(this.config.classWidgetSubmenuV4)){$widgets=$html}else{$widgets=$html.find("."+this.config.classWidgetSubmenuV4)}const setClassBox=($widget,typeConfig,classC)=>{let $ul2=$widget.find(">ul>li"+classC+">.w30s-box-menu>ul");let $box2=$ul2.parent();if(typeConfig.is_horizontal_lv2===1||typeConfig.column_lv2>1){if(!$ul2.hasClass("w30s-horizontal")){$ul2.addClass("w30s-horizontal")}if(!$box2.hasClass("w30s-fluid")){$box2.addClass("w30s-fluid")}}else{$ul2.removeClass("w30s-horizontal");$box2.removeClass("w30s-fluid")}$box2.removeClass("w30s-position-right w30s-position-bottom");if(!_.isUndefined(typeConfig.position_lv2)&&!_.isEmpty(typeConfig.position_lv2)){$box2.addClass("w30s-position-"+typeConfig.position_lv2)}for(let i=3;i<=4;i++){let $box=$widget.find(">ul>li"+classC+">.w30s-box-menu>ul>li>.w30s-box-menu");if(i===4){$box=$widget.find(">ul>li"+classC+">.w30s-box-menu>ul>li>.w30s-box-menu>ul>li>.w30s-box-menu")}let $ul=$box.find(">ul");if(typeConfig["is_horizontal_lv"+i]===1||typeConfig["column_lv"+i]>1){if(!$ul.hasClass("w30s-horizontal")){$ul.addClass("w30s-horizontal")}if(!$box.hasClass("w30s-fluid")){$box.addClass("w30s-fluid")}}else{$ul.removeClass("w30s-horizontal");$box.removeClass("w30s-fluid")}let iconShow=typeConfig.icon_open;let iconClose=typeConfig.icon_close;$box.removeClass("w30s-position-right w30s-position-bottom");if(!_.isUndefined(typeConfig["position_lv"+i])&&!_.isEmpty(typeConfig["position_lv"+i])){$box.addClass("w30s-position-"+typeConfig["position_lv"+i]);if(i===3&&typeConfig.position_lv4==="right"){iconShow=typeConfig.icon_open_horizontal;iconClose=typeConfig.icon_close_horizontal}}$ul.find(">li>*:nth-child(1) .icon-show").attr("class","icon-show "+iconShow);$ul.find(">li>*:nth-child(1) .icon-close").attr("class","icon-close "+iconClose)}let iconShow2=typeConfig.icon_open;let iconClose2=typeConfig.icon_close;if(typeConfig.position_lv3==="right"){iconShow2=typeConfig.icon_open_horizontal;iconClose2=typeConfig.icon_close_horizontal}$ul2.find(">li>*:nth-child(1) .icon-show").attr("class","icon-show "+iconShow2);$ul2.find(">li>*:nth-child(1) .icon-close").attr("class","icon-close "+iconClose2);setGap($widget,typeConfig,classC)};const setGap=($widget,typeConfig,classC)=>{for(let i=1;i<=4;i++){let $li=$widget.find(">ul>li:not(.w30s-show-more)"+classC);if(i===2){$li=$widget.find(">ul>li:not(.w30s-show-more)"+classC+">.w30s-box-menu>ul>li")}else if(i===3){$li=$widget.find(">ul>li:not(.w30s-show-more)"+classC+">.w30s-box-menu>ul>li>.w30s-box-menu>ul>li")}else if(i===4){$li=$widget.find(">ul>li:not(.w30s-show-more)"+classC+">.w30s-box-menu>ul>li>.w30s-box-menu>ul>li>.w30s-box-menu>ul>li")}$li.removeAttr("style");let css={width:"100%",margin:0};let columnGap=0;let column=typeConfig["column_lv"+i];if(column>1||typeConfig["is_horizontal_lv"+i]===1){columnGap=helper.parseFloat($li.last().find(">*:nth-child(1)").css("--column-gap"),0);if(columnGap===0){columnGap=helper.parseFloat($li.last().css("margin-right"),0);columnGap+=helper.parseFloat($li.last().css("margin-left"),0)}if(column===1){css.width="auto"}else if(columnGap>0){css.width="calc("+100/column+"% - "+columnGap*(column-1)/column+"px)"}else{css.width=100/column+"%"}}else if(typeConfig["is_horizontal_lv"+i]===1){css.width="auto"}let rowGap=helper.parseFloat($li.last().find(">*:nth-child(1)").css("--row-gap"),0);if(rowGap===0){rowGap=helper.parseFloat($li.last().css("margin-top"),0);rowGap+=helper.parseFloat($li.last().css("margin-bottom"),0)}if(rowGap>0||columnGap>0){css.margin=+rowGap+"px 0 0 "+columnGap+"px"}if(i===3){$widget.find(">ul>li:not(.w30s-show-more)"+classC+">.w30s-box-menu>ul>li>.w30s-box-menu>ul li").css(css)}else{$li.css(css)}if(typeConfig["is_horizontal_lv"+i]!==1||typeConfig["is_horizontal_lv"+i]===1&&column>1){$li.parent().find(">li:nth-child(-n+"+column+")").css({"margin-top":0});if(i===3){$li.parent().find(">li>.w30s-box-menu>ul>li:nth-child(-n+"+column+")").css({"margin-top":0})}}$li.parent().find(">li:nth-child("+(column>1||typeConfig["is_horizontal_lv"+i]!==1?column+"n+1":1)+")").css({"margin-left":0});if(i===3){$li.parent().find(">li>.w30s-box-menu>ul>li:nth-child("+(column>1||typeConfig["is_horizontal_lv"+i]!==1?column+"n+1":1)+")").css({"margin-left":0})}}};$widgets.each((idx,el)=>{let $widget=$(el);if($widget.find(">ul").length===0){return}let typeConfigTlp=dataSubmneu.hasOwnProperty($widget.data("id"))?dataSubmneu[$widget.data("id")]:{};let typeConfig={};this.listDevice.map(device=>{if(device>=currentDeviceNum||device==="desktop"){typeConfigTlp[device]=$.extend(true,{},typeConfigTlp[device]);if(_.isUndefined(typeConfigTlp[device].is_horizontal_lv4)){typeConfigTlp[device].is_horizontal_lv4=typeConfigTlp[device].is_horizontal_lv3}if(_.isUndefined(typeConfigTlp[device].is_horizontal_lv4)){typeConfigTlp[device].column_lv4=typeConfigTlp[device].column_lv3}if(_.isUndefined(typeConfigTlp[device].position_lv4)){typeConfigTlp[device].position_lv4=typeConfigTlp[device].position_lv3}device+=device==="desktop"?"":"px";typeConfig=$.extend(true,{},typeConfig,typeConfigTlp[device]||{})}});if(_.isEmpty(typeConfig)){return}if(typeConfig.is_horizontal_lv1===1||typeConfig.column_lv1>1){if(!$widget.find(">ul").hasClass("w30s-horizontal")){$widget.find(">ul").addClass("w30s-horizontal")}}else{$widget.find(">ul").removeClass("w30s-horizontal")}setClassBox($widget,typeConfig,"");if(typeConfig.style_custom){$.each(typeConfig.style_custom,(key,item)=>{if(item==null){delete typeConfig.style_custom[key];return}if($widget.find('>ul>li[data-type="'+key+'"]').length>0){if(_.isUndefined(item.is_horizontal_lv4)){item.is_horizontal_lv4=item.is_horizontal_lv3}if(_.isUndefined(item.is_horizontal_lv4)){item.column_lv4=item.column_lv3}if(_.isUndefined(item.position_lv4)){item.position_lv4=item.position_lv3}setClassBox($widget,$.extend(true,{},typeConfig,item),'[data-type="'+key+'"]')}})}if(typeConfig.turn_on_arrow_1!==1){$widget.find(">ul").removeClass("w30s-arrow-up w30s-arrow-left")}else{if($widget.find(">ul>li>.w30s-box-menu").hasClass("w30s-position-right")){$widget.find(">ul").removeClass("w30s-arrow-up").addClass("w30s-arrow-left")}else{$widget.find(">ul").removeClass("w30s-arrow-left").addClass("w30s-arrow-up")}}if(typeConfig.open_hover){if(currentDevice==="desktop"||currentDeviceNum>helper.parseInt(typeConfig.device_off_open_hover,0)){if(!$widget.hasClass("w30s-hover")){$widget.addClass("w30s-hover")}}else{$widget.removeClass("w30s-hover")}}this.openSubmenu4Default($widget,typeConfig);this.handleEventOpenSubmenu4($widget);this.calcPositionSubmenu($widget);this.calcWidthSubmenu($widget,this.curentDevice);this.handleEventSlideLandingPage($widget)})},handleViewImage($html){let $widgets=null;if($html.hasClass("w30s-widget")&&$html.hasClass(this.config.selectorViewImage.replace(".",""))){$widgets=$html}else{$widgets=$html.find(this.config.selectorViewImage)}$widgets.each(function(){let $widget=$(this);if(!_.isUndefined($widget.data("selector-viewimage"))&&!_.isEmpty($widget.data("selector-viewimage"))){let target="."+$widget.data("selector-viewimage");let selector=$widget.find(target);selector.click(function(e){e.preventDefault();$.fancybox.close()||"";let data=[];let src;let indexstart=0;let selectorF=null;let selectorFinal=$widget;if($(selector).length>1){if($(e.target).parents(".tab-pane.active").length>0){selectorF=$(selector).parents(".tab-pane.active")[0]}}let targetClick=$(e.target);let continute=false;if(targetClick.parents(target).length>0){targetClick=targetClick.parents(target)}src=targetClick.data("src");if(src!==undefined){continute=true}else if(targetClick.find("[data-src]").length>0){src=targetClick.find("[data-src]").first().data("src");continute=true}else if(targetClick.siblings("[data-src]").length>0){src=targetClick.siblings("[data-src]").first().data("src");continute=true}if(continute){if(selectorF!=null){selectorFinal=selectorF}if($(selectorFinal).find("[data-src]").length>0){$(selectorFinal).find("[data-src]").each(function(key,item){data.push({src:$(item).data("src"),opts:{thumb:$(item).data("src")}})});if(typeof src!="undefined"){for(let i=0;i<data.length;i++){if(data[i].src==src){indexstart=i;break}}}$.fancybox.open(data,{},indexstart)}}})}})},handleLoadMap($html){let $widgets=null;if($html.hasClass("w30s-widget")&&$html.hasClass(this.config.selectorLoadMap.replace(".",""))){$widgets=$html}else{$widgets=$html.find(this.config.selectorLoadMap)}$widgets.each((idx,el)=>{let $widget=$(el);let data=$widget.data();let $widgetMap=$(".w30s-widget-unique-"+data.selector_map+" .w30s-map");if($widgetMap.length===0){return}$widget.find(".w30s-repeater-item").unbind("click").click(e=>{let $widgetAddress=$(e.currentTarget).find(".w30s-widget-unique-"+data.selector_address);if($widgetAddress.length===0){return}$widgetMap.each((idx1,el1)=>{$(el1).data("address",$widgetAddress.text());map.renderMapEmbed($(el1))})})})},handleOverlay($html){let $widgets=null;if($html.hasClass("w30s-widget")&&$html.hasClass(this.config.selectorOverlay.replace(".",""))){$widgets=$html}else{$widgets=$html.find(this.config.selectorOverlay)}$widgets.each(function(){let $widget=$(this);let isContinue=true;if($widget.data("list_grid")!==undefined&&($widget.data("list_grid")==="list"&&$widget.hasClass("w30s-view-grid")||$widget.data("list_grid")==="grid"&&$widget.hasClass("w30s-view-list"))){isContinue=false}if(!_.isUndefined($widget.data("selector-overlay"))&&!_.isEmpty($widget.data("selector-overlay"))&&isContinue){let widgetSelector=$widget.find("."+$widget.data("selector-overlay")).addClass("w30s-hover");let isMouseleave=false;widgetSelector.hover(function(){isMouseleave=false;if($(this).find(".w30s-group-overplay").length>0){$(this).find(".w30s-group-overplay").stop(true,true).addClass("d-block").bind("mouseleave",function(){isMouseleave&&$(this).removeClass("d-block")}).bind("mouseenter",function(e){e.stopPropagation();e.preventDefault();$(this).addClass("d-block")})}else{$(this).siblings(".w30s-group-overplay").addClass("d-block").bind("mouseleave",function(){isMouseleave&&$(this).removeClass("d-block")}).bind("mouseenter",function(e){e.stopPropagation();e.preventDefault();$(this).addClass("d-block")})}},function(e){isMouseleave=true;$widget.find(".w30s-group-overplay").removeClass("d-block")})}else if(!_.isUndefined($widget.data("selector-overlay"))&&!_.isEmpty($widget.data("selector-overlay"))){$widget.find("."+$widget.data("selector-overlay")).unbind("mouseenter mouseleave")}})},handleEventSlideLandingPage($widget){let self=this;let dataSubmneu=DataStorage.get("dataSubmneu",{});let typeConfig=dataSubmneu.hasOwnProperty($widget.data("id"))?dataSubmneu[$widget.data("id")]:{};$widget.find("[data-section_landing]").unbind("click").click(function(e){e.preventDefault();let $obj=$(this);let hasRedirect=true;let sectionUnique=$obj.data("section_landing");let attrHref=$(this).attr("href");let href=window.location.origin;if(!_.isUndefined(attrHref)&&attrHref!="#"){href=attrHref}try{let $section=$(".w30s-section.w30s-unique-"+sectionUnique);if($section.length>0){helper.scrollToElement($section,0,self.timeScroll);hasRedirect=false}}catch(e){}if(hasRedirect&&sectionUnique.toString().length>0){if(typeof Storage!=="undefined"){sessionStorage.setItem("section_landing",sectionUnique);window.location.href=href}else{window.location.href=href+"/#"+sectionUnique}}let device_allow_event_toggle=!_.isUndefined(typeConfig.desktop)&&!_.isUndefined(typeConfig.desktop.device_allow_event_toggle)?parseInt(typeConfig.desktop.device_allow_event_toggle.replace("px","")):0;let currentDevice=parseInt(self.getDevice().replace("px",""));if(device_allow_event_toggle==0||device_allow_event_toggle>=currentDevice){if($widget.data("toggle_slide")!==undefined){let $target=$(".w30s-widget-unique-"+$widget.data("toggle_slide"));self._doToggleSlide($target,true)}}})},scrollToSection(){let objInterval=setInterval(()=>{if(_.isEmpty(this.listWidgetInProcess)){clearInterval(objInterval);try{if(typeof Storage!=="undefined"&&sessionStorage.getItem("section_landing")!==null&&!_.isEmpty(sessionStorage.getItem("section_landing"))){helper.scrollToElement($(".w30s-section.w30s-unique-"+sessionStorage.getItem("section_landing")),0,this.timeScroll);sessionStorage.removeItem("section_landing")}else if(window.location.hash.length>0){let $section=$(".w30s-section.w30s-unique-"+window.location.hash.replace("#",""));if($section.length>0){window.location.hash="";helper.scrollToElement($section,0,this.timeScroll)}}}catch(e){}}},1e3)},handleScrollTop($html){let $selector=$html.find(this.config.selectorEventWidgetScrollTop);if($selector.length>0){$selector.each(function(){let dataScroll=0;let widgetScroll=$(this);widgetScroll.unbind("click").on("click",function(){$("html, body").animate({scrollTop:0},400,"swing",()=>{if(widgetScroll.hasClass("w30s-widget-scroll-top")){widgetScroll.addClass("d-none")}})});if(widgetScroll.hasClass("w30s-widget-scroll-top")){$(window).scroll(function(){if($(this).scrollTop()===0){widgetScroll.addClass("d-none")}else if($(this).scrollTop()<dataScroll){widgetScroll.removeClass("d-none")}else if($(this).scrollTop()>dataScroll){widgetScroll.addClass("d-none")}dataScroll=$(this).scrollTop()})}})}},handleSlider(slider,data){let $slider=$(slider);let typeConfig=$.extend(true,{},data.type_config);let id=data.id;let $sliderContainer=$slider.find(".w30s-slider-container .swiper-container");let $sliderThumbs=$slider.find(".w30s-slider-thumbs");let $pagination=$slider.find(".swiper-pagination");let $buttonNavi=$slider.find(".swiper-button-navi");let classSliderContainer=".w30s-widget-"+data.id+" .w30s-slider-container";switch(this.curentDevice){case"1024px":typeConfig=helper.merge(typeConfig,typeConfig.responsive["1024px"]);break;case"768px":typeConfig=helper.merge(typeConfig,typeConfig.responsive["1024px"]);typeConfig=helper.merge(typeConfig,typeConfig.responsive["768px"]);break;case"640px":typeConfig=helper.merge(typeConfig,typeConfig.responsive["1024px"]);typeConfig=helper.merge(typeConfig,typeConfig.responsive["768px"]);typeConfig=helper.merge(typeConfig,typeConfig.responsive["640px"]);break;case"480px":typeConfig=helper.merge(typeConfig,typeConfig.responsive["1024px"]);typeConfig=helper.merge(typeConfig,typeConfig.responsive["768px"]);typeConfig=helper.merge(typeConfig,typeConfig.responsive["640px"]);typeConfig=helper.merge(typeConfig,typeConfig.responsive["480px"]);break;case"375px":typeConfig=helper.merge(typeConfig,typeConfig.responsive["1024px"]);typeConfig=helper.merge(typeConfig,typeConfig.responsive["768px"]);typeConfig=helper.merge(typeConfig,typeConfig.responsive["640px"]);typeConfig=helper.merge(typeConfig,typeConfig.responsive["480px"]);typeConfig=helper.merge(typeConfig,typeConfig.responsive["375px"]);break;case"320px":typeConfig=helper.merge(typeConfig,typeConfig.responsive["1024px"]);typeConfig=helper.merge(typeConfig,typeConfig.responsive["768px"]);typeConfig=helper.merge(typeConfig,typeConfig.responsive["640px"]);typeConfig=helper.merge(typeConfig,typeConfig.responsive["480px"]);typeConfig=helper.merge(typeConfig,typeConfig.responsive["375px"]);typeConfig=helper.merge(typeConfig,typeConfig.responsive["320px"]);break}if($sliderContainer.length>0&&$sliderContainer[0].hasOwnProperty("swiper")&&$sliderContainer[0].swiper!=null&&_.isFunction($sliderContainer[0].swiper.destroy)){$sliderContainer[0].swiper.destroy(true,true)}let configSlider=$.extend(true,{spaceBetween:10,lazy:true,loop:true,allowTouchMove:true,autoplay:true,effect:"slide",slidesPerView:1,slidesPerColumn:1,slidesPerGroup:1,cubeEffect:{shadow:true,slideShadows:true,shadowOffset:20,shadowScale:.94},coverflowEffect:{ronate:50,stretch:0,depth:100,modifier:1,slideShadows:true},flipEffect:{rotate:30,slideShadows:false},fadeEffect:{crossFade:true}},typeConfig.config_slider);if(typeConfig.is_used_pagi){configSlider.pagination=$.extend(true,{},configSlider.pagination,{el:classSliderContainer+" .swiper-pagination",dynamicBullets:true,type:"bullets",clickable:true});configSlider.type_pagi="number";if(!_.isUndefined(configSlider.type_pagi)&&!_.isEmpty(configSlider.type_pagi)){switch(configSlider.type_pagi){case"number":delete configSlider.pagination.type;configSlider.pagination.renderBullet=function(idx,className){return $("<span>"+(idx+1)+"</span>").addClass("swiper-pagination-bullet")[0].outerHTML};break;default:configSlider.pagination.type=typeConfig.config_slider.type_pagi}}delete configSlider.type_pagi;$pagination.removeClass("w30s-none")}else{$pagination.addClass("w30s-none");if(configSlider.hasOwnProperty("pagination")&&configSlider.pagination.hasOwnProperty("el")){configSlider.pagination.el=null}}if(typeConfig.is_used_nav){$buttonNavi.removeClass("w30s-none");$buttonNavi.find(".swiper-button-next i").attr("class",typeConfig.icon.nextEl);$buttonNavi.find(".swiper-button-prev i").attr("class",typeConfig.icon.prevEl);configSlider.navigation=$.extend(true,{},configSlider.navigation);configSlider.navigation.nextEl=classSliderContainer+" .swiper-button-next";configSlider.navigation.prevEl=classSliderContainer+" .swiper-button-prev"}else{$buttonNavi.addClass("w30s-none");try{delete configSlider.navigation}catch(e){}}if(typeConfig.is_used_thumb&&configSlider.slidesPerColumn==1){let $selectorThumb=$("#slider-thumb-"+id);$sliderThumbs.removeClass("w30s-none");if($selectorThumb.length>0&&!_.isUndefined($selectorThumb[0])&&$selectorThumb[0].hasOwnProperty("swiper")&&$selectorThumb[0].swiper!=null&&_.isFunction($selectorThumb[0].swiper.destroy)){$("#slider-thumb-"+id)[0].swiper.destroy(true,true)}let swiperThumb=new Swiper($selectorThumb,$.extend(true,{slidesPerView:4,spaceBetween:10,speed:300,freeMode:true,tag_image:"",allowTouchMove:true,watchSlidesVisibility:true,watchSlidesProgress:true},typeConfig.config_slider_thumb,{allowTouchMove:true}));configSlider=$.extend(true,{},configSlider,{thumbs:{swiper:swiperThumb}})}else{$sliderThumbs.addClass("w30s-none")}configSlider.pagination=$.extend(true,{},configSlider.pagination);configSlider.navigation=$.extend(true,{},configSlider.navigation);configSlider.coverflowEffect=$.extend(true,{},configSlider.coverflowEffect);configSlider.cubeEffect=$.extend(true,{},configSlider.cubeEffect);configSlider.fadeEffect=$.extend(true,{},configSlider.fadeEffect);configSlider.flipEffect=$.extend(true,{},configSlider.flipEffect);let configSliderLast=$.extend(true,{},configSlider,{initialSlide:0,upDateOnWindowResize:true,watchOverflow:true,autoResize:true,watchSlidesVisibility:true,watchSlidesProgress:true,autoHeight:!_.isUndefined($slider.data("auto_height"))&&$slider.data("auto_height")==1});if(configSliderLast.direction==="vertical"){configSliderLast.autoHeight=false}if(configSliderLast.slidesPerColumn>1||configSliderLast.slidesPerColumn*configSliderLast.slidesPerView>$sliderContainer.find(".swiper-wrapper > .swiper-slide").length){configSliderLast.loop=false}let target="slider-"+id;if(data.hasOwnProperty("key")){target=data.key;$sliderContainer.attr("id",target)}if(typeConfig.auto_calc_height_item===1){configSliderLast.autoHeight=true}const mySwiper=new Swiper($sliderContainer[0],configSliderLast);let spaceBetween=configSliderLast.slidesPerColumn>0?(configSliderLast.slidesPerColumn-1)*configSliderLast.spaceBetween:0;const calcHeightWidgetSlider=()=>{if(typeConfig.auto_calc_height_item===1){let $swiperSlide=$sliderContainer.find(".swiper-slide");$swiperSlide.height("auto");let heightWidget=Math.max.apply(null,$swiperSlide.map((idx,el)=>{return $(el).outerHeight()}).get());$swiperSlide.outerHeight(heightWidget+"px");$sliderContainer.height(heightWidget*configSliderLast.slidesPerColumn+spaceBetween+"px");setTimeout(()=>{$swiperSlide.height("auto");let heightWidget=Math.max.apply(null,$swiperSlide.map((idx,el)=>{return $(el).outerHeight()}).get());$swiperSlide.outerHeight(heightWidget+"px");$sliderContainer.height(heightWidget*configSliderLast.slidesPerColumn+spaceBetween+"px")},350)}else{let heightWidget=$slider.height()-spaceBetween;$sliderContainer.find(".swiper-slide").outerHeight((heightWidget>0?heightWidget/configSliderLast.slidesPerColumn:0)+"px")}};mySwiper.on("resize",calcHeightWidgetSlider);mySwiper.on("beforeSlideChangeStart",calcHeightWidgetSlider);let i=0;let interval=setInterval(()=>{calcHeightWidgetSlider();i++;if(i>=5){clearInterval(interval);interval=null}},1e3)},handleZoomImage($html){try{$html.find(".aaa").each(function(idx,el){let $element=$(el);let paneContainer=$element.parents(".w30s-widget-childs").first();let drift=new Drift(el)})}catch(e){console("handleZoomImage",e)}},handleClickDropdown($html){let self=this;let $target=$html.find(this.config.selectorWidgetClickDropdown);if($target.length>0){$target.each(function(){if($(this).data("widget-id")!==undefined&&$(this).data("widget-id")!==null){let $widgetDropdown=$(self.config.selectorWidgetTargetClickDropdown+"-"+$(this).data("widget-id"));if(!$(this).hasClass("is-display")){$widgetDropdown.hide()}$(this).unbind("click").click(function(){if($(this).hasClass("is-display")){$widgetDropdown.slideUp();$(this).removeClass("is-display")}else{$widgetDropdown.slideToggle()}})}})}},handleTriggerClickLivechatPA($html){$html.find(this.config.selectorShowLiveChatPA).click(function(){$("#purple_chat_30s").trigger("click")})},handleLivechatPAOffline(data){$html=$("body");$html.find(this.config.selectorShowLiveChatPA).each((k,el)=>{if(!_.isUndefined(data.is_offline)&&data.is_offline){$(el).css({"background-image":"url(/assets/images/livechat/icon_mail.svg)","background-size":"22px"})}})},handleHoverDropdown($html){if(_.isUndefined($html)){$html=$("body")}let self=this;let $targetHover=$html.find(this.config.selectorWidgetHoverDropdown);if($targetHover.length>0){$targetHover.each(function(){$(this).addClass("w30s-hover").hover(function(){let $objDropdown=$(this).find(self.config.selectorWidgetTargetHoverDropdown);if($objDropdown.hasClass("w30s-widget-repeater")||$objDropdown.hasClass("w30s-widget-group")){$objDropdown.css("height","auto")}if($objDropdown.attr("class").indexOf("w30s-animation--")>=0){$objDropdown.stop().show()}else if($objDropdown.attr("class").indexOf("w30s-transition--")>=0){$objDropdown.css("display","block")}else{$objDropdown.stop().slideDown()}},function(){let $objDropdown=$(this).find(self.config.selectorWidgetTargetHoverDropdown);if($objDropdown.attr("class").indexOf("w30s-animation--")>=0){$objDropdown.stop().hide()}else if($objDropdown.attr("class").indexOf("w30s-transition--")<0){$objDropdown.stop().slideUp()}})})}},initSliderFormHtml($htmlTextarea){$htmlTextarea.each(function(idx,el){let $textarea=$(el);let $widgetSlider=$textarea.parents().first();if($widgetSlider.length>0&&$textarea.html().length>0){try{widgetEvent.handleSlider($widgetSlider[0],{type_config:JSON.parse($textarea.html()).type_config_slider,id:$widgetSlider.data("id")})}catch(err){console.log("Err: WidgetEvent:initSliderFormHtml")}$widgetSlider=null}})},async renderAllWidget($html){await this.loadDataMore();$html.find('.w30s-widget-repeater[data-render]:not([data-content_type="'+this.CONTENT_TYPE_COMPANY_API+'"]), '+'.w30s-widget-tab[data-render]:not([data-content_type="'+this.CONTENT_TYPE_COMPANY_API+'"]), '+'.w30s-widget-slider[data-render]:not([data-content_type="'+this.CONTENT_TYPE_COMPANY_API+'"]), '+'.w30s-widget-submenu-4[data-render]:not([data-content_type="'+this.CONTENT_TYPE_MAIN_MENU+'"]):not([data-content_type="'+this.CONTENT_TYPE_COMPANY_API+'"]), '+".w30s-widget-submenu[data-render], .w30s-widget-menu[data-render], .w30s-widget-filter-select[data-render], .w30s-widget-statistical-access[data-render]").each((idx,el)=>{let $widgetRender=$(el);if($widgetRender.data("render").length<=0){console.log("Widget render not found Object: ",$widgetRender);return}this.loadDataWidget($widgetRender,undefined,true)})},setQueryData:function(widgetId,field,value,key){if(!this.queryDataWidget.hasOwnProperty(widgetId)){return false}switch(field){case"variant_options":let data=[];if(this.queryDataWidget[widgetId].hasOwnProperty(field)){if(this.queryDataWidget[widgetId][field].hasOwnProperty(key)){data=this.queryDataWidget[widgetId][field][key].split(",")}}else{this.queryDataWidget[widgetId][field]={}}if(!data.includes($.trim(value))){data.push($.trim(value))}this.queryDataWidget[widgetId][field][key]=data.join(",");break;case"brand_id":if(_.isUndefined(this.queryDataWidget[widgetId][field])){this.queryDataWidget[widgetId][field]=[]}if(!_.isArray(this.queryDataWidget[widgetId][field])){this.queryDataWidget[widgetId][field]=[this.queryDataWidget[widgetId][field]]}if(_.indexOf(this.queryDataWidget[widgetId][field],value)>=0){this.queryDataWidget[widgetId][field]=_.filter(this.queryDataWidget[widgetId][field],item=>item!=value)}else{this.queryDataWidget[widgetId][field].push(value)}break;default:this.queryDataWidget[widgetId][field]=value}if(field!=="page"){delete this.queryDataWidget[widgetId].page}},removeQueryData:function(widgetId,field,value,key){if(!this.queryDataWidget.hasOwnProperty(widgetId)){return false}if(this.queryDataWidget[widgetId].hasOwnProperty(field)){value=$.trim(value);switch(field){case"variant_options":let data=[];if(this.queryDataWidget[widgetId].hasOwnProperty(field)){if(this.queryDataWidget[widgetId][field].hasOwnProperty(key)){data=this.queryDataWidget[widgetId][field][key].split(",")}}data=data.filter(function(item){return item!==value});this.queryDataWidget[widgetId][field][key]=data.join(",");if(data.length===0){delete this.queryDataWidget[widgetId][field][key]}if(this.queryDataWidget[widgetId][field].length===0){delete this.queryDataWidget[widgetId][field]}break;default:delete this.queryDataWidget[widgetId][field]}delete this.queryDataWidget[widgetId].page;this.setLocationHash(widgetId)}},loadDataMainMenu:async function(){if(isBase==1){return false}let resp=await loader.ajaxPromise({url:base_url+"/widget/data-menu-top-json",data:{router:here_router}});let dataSubmneu=DataStorage.get("dataSubmneu",{});$('.w30s-widget-submenu-4[data-render][data-content_type="'+this.CONTENT_TYPE_MAIN_MENU+'"]').each((idx,el)=>{let dataRender=$.extend(true,{},resp);let $widgetRender=$(el);if(dataSubmneu.hasOwnProperty($widgetRender.data("id"))&&!_.isEmpty(dataSubmneu[$widgetRender.data("id")])){let type_config=dataSubmneu[$widgetRender.data("id")].desktop;try{if(type_config.unique_in.length>0){dataRender.items=_.filter(dataRender.items,item=>{item.index=type_config.unique_in.indexOf(item.unique.toString());return item.index>=0});dataRender.items=_.sortBy(dataRender.items,"index")}if(type_config.style_custom[this.TYPE_PRODUCT_BRAND].brand_a_z===1){dataRender.items.map((item,idItem)=>{if(item.type!=this.TYPE_PRODUCT_BRAND){return}let itemsTmp={};item.submenu.map(itemC=>{let charF=$.trim(itemC.name).substring(0,1);itemsTmp[charF]=itemsTmp[charF]?itemsTmp[charF]:[];itemsTmp[charF].push(itemC)});item.submenu=[];_.mapObject(itemsTmp,(submenu,name)=>{let item1={parent_id:item.id,name:name.toUpperCase(),url:"javascript:void(0)",submenu:submenu};item1.submenu=_.sortBy(item1.submenu,"name");item.submenu.push(item1)});item.submenu=_.sortBy(item.submenu,"name");dataRender.items[idItem]=item})}}catch(e){}}let $html=widgetEvent.renderWidget($widgetRender,dataRender);dataRender=null;if($html!==null){if($html.hasClass("w30s-widget-submenu-4")){this.handleWidgetSubmenuV4($html)}}})},loadDataConnectApi:async function(){let dataProcessing={};let content_data_page=await this.getDataContentPage();$('[data-content_type="'+this.CONTENT_TYPE_COMPANY_API+'"]').each((idx,el)=>{let $widget=$(el);let api=$widget.data("api");if(_.isUndefined(api)||api.toString().length===0){return}if($widget.hasClass("w30s-widget-repeater")||$widget.hasClass("w30s-widget-slider")||$widget.hasClass("w30s-widget-submenu-4")){api=api+"_"+$widget.data("id")}api=api.toString();if(!dataProcessing.hasOwnProperty(api)){dataProcessing[api]=[]}dataProcessing[api].push($widget)});let loadData=async(api,$widgets)=>{let content_data_page=await this.getDataContentPage();let queryData=$.extend(true,{api:api},content_data_page.data.query_api||{});if(content_data_page.data.search_keyword&&content_data_page.data.search_keyword.length>0){queryData.keyword=content_data_page.data.search_keyword}if(api.toString().indexOf("_")>0){api=api.split("_");queryData.api=api[0];queryData.widget_id=api[1];try{queryData.limit=$widgets[0].data("limit")}catch(e){}if(_.isUndefined(queryData.limit)){queryData.limit=8}this.queryDataWidget[$widgets[0].data("id")]=queryData}let resp=await loader.ajaxPromise({url:base_url+"/widget/data-api-json",data:queryData});if(resp.api.type===1){let data_api=DataStorage.get("data_api",{});data_api[queryData.api.toString()]=resp.items;DataStorage.set("data_api",data_api)}else if(resp.api.type===3){$(this.Cart.config.selectorBtnAddCart+".w30s-api").data("api",1).data("product_id",resp.data.id).data("type_api",resp.data.type_api).data("name",resp.data.name).data("image",resp.data.image_url).data("price",resp.data.price_final).data("seo_name",resp.data.seo_name).removeClass("d-none")}$widgets.map($widget=>{let $html=this.renderWidget($widget,resp);if($html){this.afterRenderDataApi($html,resp);this.afterRenderWidget($html)}})};_.mapObject(dataProcessing,($widgets,api)=>{loadData(api,$widgets)})},loadDataMore:async function(){let types=[];if(DataStorage.get("data_widget_more",null)===null){DataStorage.set("data_widget_more",{});_is_realty&&types.push("get_data_filter_realty");$(this.config.selectorWidgetStatisticAccess).length>0&&types.push(this.CONTENT_FIELD_STATISTIC);if(types.length>0){let resp=await loader.ajaxPromise({url:base_url+"/widget/get-data-more-json",data:{types:types}});DataStorage.set("data_widget_more",resp.data)}}},getDataMore:function($widget){let result=null;let dataWidgetMore=DataStorage.get("data_widget_more",null);if(dataWidgetMore!==null){if($widget.data("type")==this.TYPE_FILTER_SELECT&&$widget.data("content_type")==this.CONTENT_TYPE_ROOT&&_.contains([this.CONTENT_FIELD_FILTER_AREA,this.CONTENT_FIELD_FILTER_NUMBER_FLOOR,this.CONTENT_FIELD_FILTER_NUMBER_TOILET,this.CONTENT_FIELD_FILTER_NUMBER_ROOM,this.CONTENT_FIELD_PRICE_UNIT,this.CONTENT_FIELD_PRICE_SEARCH,this.CONTENT_FIELD_DIRECT_HOUSE],$widget.data("content_field"))||$widget.hasClass(this.config.selectorWidgetStatisticAccess.replace(".",""))){result=dataWidgetMore.hasOwnProperty($widget.data("content_field"))?dataWidgetMore[$widget.data("content_field")]:null}}return result},afterRenderDataApi:function($html,resp){if(resp.api.type===1){if(this.Cart!==null){$html.find(this.Cart.config.selectorBtnAddCart).data("api",resp.api.unique);$html.find(this.Cart.config.selectorBtnAddCart).data("type_api",resp.api.type_api)}}this.handleToggleSlide($html)},loadDataWidget:async function($widgetRender,url,isStartInit){let widgetId=$widgetRender.data("id");let data=this.getDataMore($widgetRender);if(data===null){if(_.isUndefined(url)||url.length<1||url===null){url=this.getUrlByContentType($widgetRender)}if(_.isUndefined(url)||url===null){return false}if(url.substr(0,4)==="http"){url=base_url+url}if(isStartInit){this.listWidgetInProcess[widgetId]=1}this.getQueryByContentType($widgetRender);if(!_.isUndefined($widgetRender.data("active"))&&$widgetRender.data("active")>0&&$widgetRender.hasClass("w30s-widget-submenu-4")){this.queryDataWidget[widgetId].active=$widgetRender.data("active")}if(!$widgetRender.hasClass("w30s-load-more")){loader.showLoaderWidget($widgetRender)}data=await loader.ajaxPromise({url:url,data:this.queryDataWidget[widgetId]})}let $html=widgetEvent.renderWidget($widgetRender,data);if($html!==null){if(data.hasOwnProperty("api")&&data.api.hasOwnProperty("type")&&data.api.type>0){this.afterRenderDataApi($html,data)}this.afterRenderWidget($html);if(isStartInit){delete this.listWidgetInProcess[widgetId];if(_.isEmpty(this.listWidgetInProcess)){this.handleToggleSlide($("body"));this.handleClickCopyContent($("body"))}}}},afterRenderWidget($html,$widgetRender){widgetAnimation.setPositionMarquee();widgetAnimation.handleRebuildAnimation();this.handleViewImage($html);this.handleOverlay($html);this.handleShowPopup($html);this.handleHoverDropdown();this.handleEventSlideLandingPage($html);this.handleCountUp($html);if($html.hasClass("w30s-widget-repeater")){this.handlePagination($html);if($html.find(this.config.selectorClassNameCustomListView)){this.handleClassCustomListView($html)}this.handleCountDownTimer($html);this.handleUpDownBtnQuantity($html);if(!_.isUndefined(this.Cart)&&!_.isEmpty(this.Cart)){this.Cart.handleSetQuantity($html)}this.handleLoadMap($html)}else if($html.hasClass("w30s-widget-filter-select")){this.handleWidgetFilterSelect($html)}else if($html.hasClass("w30s-widget-submenu")){this.handleWidgetSubmenu($html)}else if($html.hasClass("w30s-widget-submenu-4")){this.handleWidgetSubmenuV4($html)}else if($html.hasClass("w30s-widget-tab")){if($html.find(this.config.selectorWidgetSlider).length>0){this.setDataSlider($html)}if($html.find(this.config.selectorWidgetFilterSelect).length>0){this.handleWidgetFilterSelect($html)}if($html.closest(this.config.selectorWidgetSearch).length>0){this.handleSearch($html.closest(this.config.selectorWidgetSearch))}this.handleWidgetTab($html)}else if($html.hasClass(this.config.selectorWidgetSlider.replace(".",""))){this.setDataSlider($html)}if(_.isUndefined($widgetRender)){$widgetRender=$html}let contentType=parseInt($widgetRender.data("content_type"));let contentField=$widgetRender.data("content_field");switch(contentType){case this.CONTENT_TYPE_COMPANY_API:case this.CONTENT_TYPE_ALBUM_PHOTO:case this.CONTENT_TYPE_PRODUCT:if(!_.isUndefined(product)){product.handleQuickView($html)}core.initLazyLoad();if(this.Cart!==null){this.Cart.handleAddCompare($html);this.Cart.handleFavorite($html);this.Cart.handleAddCart($html)}if(!_.isUndefined(product)){product.handleChangeSort($html);product.handleChangeLimit($html)}this.handleClickAddNumberPhoneTongDai($html);this.handleClickAddServiceTongDai($html);break;case this.CONTENT_TYPE_WIDGET:case this.CONTENT_TYPE_PRODUCT_CATEGORY:if(contentType==this.CONTENT_TYPE_WIDGET&&contentField==this.CONTENT_FIELD_PRODUCT_LIST||contentType==this.CONTENT_TYPE_PRODUCT_CATEGORY&&$html.find('.w30s-widget[data-content_field="'+this.CONTENT_FIELD_PRODUCT_LIST+'"]').length>0){if(!_.isUndefined(product)){product.handleQuickView($html)}core.initLazyLoad();if(this.Cart!==null){this.Cart.handleAddCompare($html);this.Cart.handleFavorite($html);this.Cart.handleAddCart($html);if(!_.isUndefined(product)){product.handleChangeSort($html);product.handleChangeLimit($html)}}}break;case this.CONTENT_TYPE_CLASSIFIED_NEWS:this.handleSaveClassifiedNewsSave($html);break;case this.CONTENT_TYPE_VIDEO:this.handleQuickViewVideo($html);break;case-999:this.handleMenu($html);break;case 999:switch(contentField){case this.CONTENT_FIELD_LIST_VIEWED:if(!_.isUndefined(product)){product.handleRemoveViewed($html);product.handleQuickView($html)}core.initLazyLoad();if(this.Cart!==null){this.Cart.handleFavorite($html);this.Cart.handleAddCompare($html);this.Cart.handleAddCart($html)}break;case this.CONTENT_FIELD_LIST_FAVORITE:if(!_.isUndefined(product)){product.handleQuickView($html)}core.initLazyLoad();if(this.Cart!==null){this.Cart.handleAddCart($html);this.Cart.handleAddCompare($html);this.Cart.handleRemoveFavorite($html)}break;case this.CONTENT_FIELD_LIST_CLASSIFIED_SAVE:this.handleRemoveClassifiedNewsSave($html);break}break;default:return null}this.handleNiceSroll()},handlePagination:function($html){let self=this;$html.find(".w30s-widget-pagging>.w30s-item>a").unbind("click").click(function(e){let $obj=$(this);if($obj.parent().hasClass("disable")||$obj.parent().hasClass("active")){e.preventDefault();return false}let $widgetRender=$obj.parents(".w30s-widget-repeater").first();let widgetId=$widgetRender.data("id");if(!self.queryDataWidget.hasOwnProperty(widgetId)){e.preventDefault();return false}e.preventDefault();self.queryDataWidget[widgetId]=helper.getParamFromUrl($obj.attr("href"));widgetEvent.loadDataWidget($widgetRender);if(!$widgetRender.hasClass("w30s-load-more")){$("html, body").animate({scrollTop:$widgetRender.offset().top},400,"swing")}})},handleCountDownTimer($html){let $widgets=$html.find(this.config.selectorWidgetCountdownTimer);let dataInterval={};if($widgets.length>0){$widgets.each(function(){let $widget=$(this);let now=(new Date).getTime();if(!_.isUndefined($widget.data("time-end"))&&!_.isEmpty($widget.data("time-end").toString())&&$widget.data("time-end")-now>0){let timeEnd=$widget.data("time-end");dataInterval["widget-"+$widget.data("id")]=setInterval(function(){$widget.removeClass("d-none");let detroyEvt=false;let timeNow=(new Date).getTime();let data={date:Math.floor((timeEnd-timeNow)/(1e3*60*60*24)),hour:Math.floor((timeEnd-timeNow)%(1e3*60*60*24)/(1e3*60*60)),minute:Math.floor((timeEnd-timeNow)%(1e3*60*60)/(1e3*60)),second:Math.floor((timeEnd-timeNow)%(1e3*60)/1e3)};if(data.date>0){$widget.find(".countdown-timer-date > .countdown-timer-number").html(data.date)}else{detroyEvt=true}if(data.hour>0){$widget.find(".countdown-timer-hour > .countdown-timer-number").html(data.hour);detroyEvt=false}else if(detroyEvt){detroyEvt=true}if(data.minute>0){$widget.find(".countdown-timer-minute > .countdown-timer-number").html(data.minute);detroyEvt=false}else if(detroyEvt){detroyEvt=true}if(data.second>0){$widget.find(".countdown-timer-second > .countdown-timer-number").html(data.second);detroyEvt=false}else if(detroyEvt){detroyEvt=true}if(detroyEvt&&!_.isUndefined(window["widget-"+$widget.data("id")])){clearInterval(window["widget-"+$widget.data("id")]);if(parseInt($widget.data("is-hide"))===1){$widget.addClass("d-none")}$widget.find(".countdown-timer-date > .countdown-timer-number").html(0);$widget.find(".countdown-timer-hour > .countdown-timer-number").html(0);$widget.find(".countdown-timer-minute > .countdown-timer-number").html(0);$widget.find(".countdown-timer-second > .countdown-timer-number").html(0)}},1e3)}else if(parseInt($widget.data("is-hide"))===0){$widget.removeClass("d-none")}})}},handleQrCode($html){$html.find(this.config.selectorWidgetQrCode).each((idx,el)=>{let $widgets=$(el);if($widgets.length>0){let qrcode=new QRCode($($widgets)[0],{width:$widgets[0].dataset.widgetWidth.replace("px",""),height:$widgets[0].dataset.widgetHeight.replace("px","")});qrcode.makeCode($widgets[0].dataset.widgetLink)}})},handleNiceSroll($html){if($.nicescroll){if(_.isUndefined($html)){$html=$("body")}$html.find(this.config.selectorNiceScroll).each((idx,el)=>{let $widget=$(el);let NiceScroll=$widget.getNiceScroll();let device=helper.parseInt($widget.data("device"),0);let curentDevice=helper.parseInt(this.curentDevice,1366);if(NiceScroll&&NiceScroll.length>0){if(device<curentDevice){NiceScroll.remove();return}}else if(device===0||device>=curentDevice){$widget.niceScroll({cursorcolor:helper.parseString($widget.data("color"),"#afb0b0"),cursorwidth:helper.parseInt($widget.data("width"),5)+"px",cursorborder:"none",autohidemode:false,horizrailenabled:false,zindex:31});NiceScroll=$widget.getNiceScroll()}NiceScroll.resize();setTimeout(()=>{if(!_.isEmpty(NiceScroll[0])){NiceScroll.resize()}},500);setTimeout(()=>{if(!_.isEmpty(NiceScroll[0])){NiceScroll.resize()}},1e3);setTimeout(()=>{if(!_.isEmpty(NiceScroll[0])){NiceScroll.resize()}},2e3)})}},handleAutoComplete($html){if(!$html.hasClass(this.config.selectorAutocomplete.replace(".",""))){$html=$html.find(this.config.selectorAutocomplete)}let timeOutTyping={};$html.find("input").each((idx,el)=>{let $input=$(el);let $widgetInput=$input.parents(this.config.selectorAutocomplete);let $widgetSearch=$widgetInput.parents(".w30s-widget-search");let $resultSearch=$widgetSearch.find(".w30s-result-search");if($resultSearch.length===0){$resultSearch=$('<div class="w30s-result-search"><div>');$widgetSearch.find(".w30s-widget-childs").append($resultSearch)}timeOutTyping[$widgetInput.data("id")]=null;$input.unbind("keyup").keyup(e=>{clearTimeout(timeOutTyping[$widgetInput.data("id")]);timeOutTyping[$widgetSearch.data("id")]=setTimeout(async()=>{timeOutTyping[$widgetSearch.data("id")]=null;let value=$.trim(e.currentTarget.value);$resultSearch.find(".w30s-result-footer a").unbind("click");let resp={items:[]};if(value.length>0){resp=await loader.ajaxPromise({url:base_url+"/widget/getDataSearchAllJson",data:{keyword:value,limit:helper.parseInt($widgetSearch.data("limit"),10)}})}if(resp.items.length>0){$resultSearch.removeClass("d-none");$resultSearch.html(template.render(resp,"result-autocomplete"));$resultSearch.find(".w30s-result-footer a").click(e=>{e.preventDefault();$resultSearch.addClass("d-none")})}else{$resultSearch.addClass("d-none")}},500)})})},handleWidgetFilterSelect($html){let self=this;let $element=$html;let queryPage=DataStorage.get("query_page",{});let dataFilterSelect=DataStorage.get("dataFilterSelect",[]);if(!$element.hasClass(this.config.selectorWidgetFilterSelect.replace(".",""))){$element=$html.find(this.config.selectorWidgetFilterSelect)}$element.each(function(){let $widget=$(this);let $selectorSelect=$widget.find(self.config.selectorBootstrapSelect).first();let widgetContentField=$widget.data("content_field");let widgetContentType=$widget.data("content_type");let data=$selectorSelect.data();$selectorSelect.selectpicker({container:"body",countSelectedText:function(num,element){return num+" "+data.countSelectedText}}).on("changed.bs.select",function(e,isClickIndex,isSelected,oldVal){let val=helper.parseInt($(e.currentTarget).val(),0);if(_.isArray($(e.currentTarget).val())){val=$(e.currentTarget).val()}let $objCurrent=$(e.currentTarget);if(isClickIndex!==null){if(_.contains([self.CONTENT_FIELD_PROVINCE,self.CONTENT_FIELD_DISTRICT],widgetContentField)&&widgetContentType===self.CONTENT_TYPE_ROOT){let $parentWidget=$widget.parents(".w30s-widget").first();if($parentWidget.hasClass("w30s-widget-tab")){$parentWidget=$parentWidget.find(".tab-pane.active")}self.handleSetDataQuery($widget,val,"click",$parentWidget)}let classNameEvent=self.config.selectorEventChangeLoadData.replace(".","");if($widget.hasClass(classNameEvent)&&$widget.find("select").data("object_apply")!=undefined&&!_.isUndefined($widget.data("content_type"))&&!_.contains([self.CONTENT_TYPE_DEFAULT],parseInt($widget.data("content_type")))){let unique=$widget.find("select").data("object_apply");let $widgetObject=$(".w30s-widget-unique-"+unique);let idObjectApply=$widgetObject.data("id");if($widgetObject.length>0){let $selectPicker=$widgetObject.find("select.w30s-bootstrap-select").first();$selectPicker.addClass("w30s-has-load-data-select");$selectPicker.html("");try{let dataFilterSelectCurrent=_.findWhere(dataFilterSelect,{id:$widget.data("id")});if(dataFilterSelectCurrent!=undefined&&val>0){let dataCategorySelected=_.findWhere(dataFilterSelectCurrent.content_data,{id:val});let dataContentObjectApply=dataCategorySelected.submenu;self.setDataFilterSelect(null,{id:idObjectApply,content_data:dataContentObjectApply});dataContentObjectApply.map((item,key)=>{$selectPicker.append("<option value="+item.id+" data-id="+item.id+">"+item.name+"</option>")})}}catch(e){console.log("==== handleSelecteFilter ===");console.log(e)}$selectPicker.selectpicker("refresh");$selectPicker.trigger("change")}}if($widget.find("select").hasClass("w30s-has-load-data-select")){let uniqueCurrent=$widget.data("unique");let funcRemoveAttr=$obj=>{let nameTmp=$widget.find("select").attr("name");if(nameTmp==undefined||nameTmp==""){nameTmp=$obj.closest("form").find('select[data-object_apply="'+uniqueCurrent+'"]').attr("name")}$obj.attr("name-tmp",nameTmp);$obj.closest("form").find('select[name="'+nameTmp+'"]').removeAttr("name")};if(val>0){funcRemoveAttr($objCurrent);if(($objCurrent.attr("name")==undefined||$objCurrent.attr("name")=="")&&$objCurrent.attr("name-tmp")!=undefined){$objCurrent.attr("name",$objCurrent.attr("name-tmp"))}}}}val=null}).on("show.bs.select",function(){$widget.addClass("show")}).on("hide.bs.select",function(){$widget.removeClass("show")});try{let queryName=$selectorSelect.attr("name").replace("[","").replace("]","");if(queryPage.hasOwnProperty(queryName)){$selectorSelect.selectpicker("val",queryPage[queryName])}}catch(e){}$widget.hasClass("d-none")&&$widget.removeClass("d-none")})},handleChangeLoadDataDefault($html){if(!$html.hasClass(this.config.selectorEventChangeLoadData)){$html=$html.find(this.config.selectorEventChangeLoadData)}let self=this;$html.each((key,el)=>{let contentType=$(el).data("content_type");if(contentType==self.CONTENT_TYPE_DEFAULT){if($(el).hasClass("w30s-widget-filter-radio")){self._doHandleChangeLoadDataDefaultWidgetRadio($(el))}}})},_doHandleChangeLoadDataDefaultWidgetRadio($widgetDom){let dataWidgetStorage=DataStorage.get("dataWidgetUsedEventLoadDataDefault");$widgetDom.find("input").unbind("change").change(e=>{let uniqueLink=$widgetDom.data("object_apply");let idWidget=$widgetDom.data("id");let $widgetLink=$(".w30s-widget-unique-"+uniqueLink);let idInputCurrent=$(e.currentTarget).attr("id").replace(`widget-checkbox-${idWidget}-`,"");idInputCurrent=parseInt(idInputCurrent);try{let dataWidgetCurrent=_.findWhere(dataWidgetStorage,{id:idWidget});let dataMapping=_.findWhere(dataWidgetCurrent.setting.event.changed.loadDataWidget.data_mapping,{id:idInputCurrent});let $wrapperListRadio=$widgetLink.find(">div");$wrapperListRadio.find("span").each((key,optionTmp)=>{let idInputLinktmp=$(optionTmp).find("input").attr("id").replace(`widget-checkbox-${$widgetLink.data("id")}-`,"");idInputLinktmp=parseInt(idInputLinktmp);if(!_.isUndefined(dataMapping)&&_.isArray(dataMapping.ids_link_not_show)&&_.contains(dataMapping.ids_link_not_show,idInputLinktmp)){$(optionTmp).hide();$(optionTmp).prop("checked",false)}else{$(optionTmp).show()}})}catch(e){console.log(e);console.log("error - _doHandleChangeLoadDataDefaultWidgetRadio")}})},handleSetDataQuery($widget,data,event,$parentWidget){let $widgetRender=null;let queryPage=DataStorage.get("query_page",{});if(_.isUndefined(queryPage)){queryPage={}}else if(event==="click"){let field=$widget.data("content_field");if($widget.find("select").length>0&&!_.isUndefined($widget.find("select").attr("name"))){field=$widget.find("select").attr("name");field=field.replace("[]","")}if(_.isArray(data)){data=data.filter(v=>{return parseInt(v)>0})}if(_.isArray(data)&&data.length>0||parseInt(data)>0&&data!=null){queryPage[field]=data}else{delete queryPage[field]}}if($widget.length>0){switch($widget.data("content_field")){case this.CONTENT_FIELD_DIRECT_HOUSE:case this.CONTENT_FIELD_PRICE_SEARCH:case this.CONTENT_FIELD_AREA:case this.CONTENT_FIELD_NUMBER_TOILET:case this.CONTENT_FIELD_NUMBER_FLOOR:if(event==="load"){$widgetRender=$widget}break;case this.CONTENT_FIELD_PROVINCE:if(event==="load"){$widgetRender=$widget}else{let $widgetRealtyProject=$parentWidget.find(this.config.selectorWidgetFilterSelect+'[data-content_type="'+this.CONTENT_TYPE_REALTY_PROJECT+'"]');if($widgetRealtyProject.length>0){DataStorage.set("query_page",queryPage);this.loadDataWidget($widgetRealtyProject)}$widgetRender=$parentWidget.find(this.config.selectorWidgetFilterSelect+'[data-content_field="'+this.CONTENT_FIELD_DISTRICT+'"]');if(queryPage.hasOwnProperty("district_id")){delete queryPage["district_id"]}}break;case this.CONTENT_FIELD_DISTRICT:if(event==="load"){$widgetRender=$widget}else{$widgetRender=$parentWidget.find(this.config.selectorWidgetFilterSelect+'[data-content_field="'+this.CONTENT_FIELD_WARD+'"]');if(queryPage.hasOwnProperty(this.CONTENT_FIELD_WARD)){delete queryPage["ward_id"]}if(queryPage.hasOwnProperty(this.CONTENT_FIELD_STREET)){delete queryPage["ward_id"]}let $widgetStreet=$parentWidget.find(this.config.selectorWidgetFilterSelect+'[data-content_field="'+this.CONTENT_FIELD_STREET+'"]');if($widgetStreet.length>0){DataStorage.set("query_page",queryPage);this.loadDataWidget($widgetStreet)}let $widgetRealtyProject=$parentWidget.find(this.config.selectorWidgetFilterSelect+'[data-content_type="'+this.CONTENT_TYPE_REALTY_PROJECT+'"]');if($widgetRealtyProject.length>0){DataStorage.set("query_page",queryPage);this.loadDataWidget($widgetRealtyProject)}}break;case this.CONTENT_FIELD_STREET:case this.CONTENT_FIELD_WARD:if(event==="load"){$widgetRender=$widget}break;default:$widgetRender=$widget}}if($widgetRender!==null){DataStorage.set("query_page",queryPage);this.loadDataWidget($widgetRender)}},handleWidgetFilterCheckbox($html){let self=this;let $element=$html;if(!$html.hasClass(this.config.selectorWidgetFilterCheckbox.replace(".",""))){$element=$html.find(this.config.selectorWidgetFilterCheckbox)}$element.each(function(){if($(this).hasClass(self.config.selectorEventFilterBrand.replace(".",""))){self.handleFilterProductBrand($(this))}})},handleFilterProductBrand($html){let self=this;let $element=$html;if(!$html.hasClass(this.config.selectorEventFilterBrand.replace(".",""))){$element=$html.find(this.config.selectorEventFilterBrand)}$element.each(function(){let $widget=$(this);$widget.find('input[type="checkbox"]').unbind("change").on("change",function(){let val=$(this).val();if(!_.isUndefined(product)){$(".w30s-list-product[data-render]").each(function(idx1,el1){let $widgetRender=$(el1);let widgetId=$widgetRender.data("id");if(!self.queryDataWidget.hasOwnProperty(widgetId)){self.queryDataWidget[widgetId]={}}$widgetRender.find(".w30s-repeater-box").html("");self.setQueryData(widgetId,"brand_id",val,null);self.loadDataWidget($widgetRender)})}})})},handleFilterProductVariant($html){try{let self=this;$html.find(".w30s-widget-filter-product-variant .w30s-widget-product-variant-item").click(function(e){let $obj=$(e.currentTarget);let data=$obj.data();$obj.toggleClass("active");data.key=data.hasOwnProperty("key")?data.key:0;data.value=data.hasOwnProperty("value")?data.value:0;if(!_.isUndefined(product)){$(".w30s-list-product[data-render]").each(function(idx1,el1){let $widgetRender=$(el1);let widgetId=$widgetRender.data("id");if(!self.queryDataWidget.hasOwnProperty(widgetId)){return}$widgetRender.find(".w30s-repeater-box").html("");if($obj.hasClass("active")){self.setQueryData(widgetId,"variant_options",data.value,data.key)}else{self.removeQueryData(widgetId,"variant_options",data.value,data.key)}delete self.queryDataWidget[widgetId].page;self.loadDataWidget($widgetRender)})}})}catch(e){console.log("$html",$html);console.log(e)}},handleCountUp($html){let self=this;let $widgets=$html.find(this.config.selectorEventCountUp);if($html.hasClass(this.config.selectorEventCountUp.replace(".",""))){$widgets=$html}$widgets.each(function(){let $widget=$(this);let data={start:0,end:parseInt($widget.data("end")),speed:1};if(!_.isNaN(data.end)){let $child=$widget.children().clone(true,true);if($child.children().length<=0){$child=$widget.html()}let timeOut=setInterval(()=>{if(data.start>data.end){$widget.text("").append($child).removeClass(self.config.selectorEventCountUp.replace(".",""));clearInterval(timeOut);data=null}else{$widget.text(data.start);++data.start}},data.speed)}})},handleClickTranslateX($html){let $selectors=$html;if(!$selectors.hasClass(this.config.selectorEventClickTranslateX.replace(".",""))){$selectors=$html.find(this.config.selectorEventClickTranslateX)}if($selectors.length>0){$selectors.each(function(){let $widget=$(this);if(!_.isUndefined($widget.data("translate_x_id"))){let direction=!_.isUndefined($widget.data("translate_x_direction"))&&$widget.data("translate_x_direction")==="left"?"left":"right";$widget.unbind("click").click(function(){$("body").find(".w30s-widget-unique-"+$widget.data("translate_x_id")).toggleClass("event-translate-x-"+direction)})}})}},handleClickLoadMore($html){$html.find(this.config.selectorEventClickLoadMore).each((idx,el)=>{let $widget=$(el);if($widget.find(".w30s-widget-pagging>.w30s-item.active").next().hasClass("disable")){$widget.hide();return}$widget.off().click(function(e){e.preventDefault();let $widget=$(this);let $widgetRepeater=$(".w30s-load-more.w30s-widget-unique-"+$widget.data("target_unique"));let $itemNext=$widgetRepeater.find(".w30s-widget-pagging>.w30s-item.active").next();if($itemNext.length>0){if($itemNext.hasClass("disable")||$itemNext.next().hasClass("disable")){$widget.hide()}else{$itemNext.find("a").trigger("click")}}})})},handleClickLoadData($html){let self=this;$html.find(this.config.selectorEventClickLoadData).each((idx,el)=>{$(el).off().click(function(e){let $widget=$(this);let $form=$widget.parents("form");if($form.length>0){if(_.last($form.attr("action").split("/"))===_.last(window.location.pathname.split("/"))||window.location.host==_.last($form.attr("action").split("/"))){let $widgetRepeater=$(".w30s-widget-unique-"+$widget.data("target_unique"));if($widgetRepeater.length===0){$widgetRepeater=null;e.preventDefault();return}let dataForm=$form.serializeObject();let widgetId=$widgetRepeater.data("id");if(_.isUndefined(self.queryDataWidget[widgetId])){self.queryDataWidget[widgetId]={}}self.queryDataWidget[widgetId].keyword=dataForm.hasOwnProperty("keyword")?$.trim(dataForm.keyword):"";self.queryDataWidget[widgetId].category_id=dataForm.hasOwnProperty("category_id")?$.trim(dataForm.category_id):"";self.queryDataWidget[widgetId].brand_id=dataForm.hasOwnProperty("brand_id")?$.trim(dataForm.brand_id):"";if(dataForm.hasOwnProperty("province_id")){self.queryDataWidget[widgetId].province_id=$.trim(dataForm.province_id)}if(dataForm.hasOwnProperty("district_id")){self.queryDataWidget[widgetId].district_id=$.trim(dataForm.district_id)}if(dataForm.hasOwnProperty("ward_id")){self.queryDataWidget[widgetId].ward_id=$.trim(dataForm.ward_id)}$widgetRepeater.attr("data-keyword",self.queryDataWidget[widgetId].keyword).data("keyword",self.queryDataWidget[widgetId].keyword);$widgetRepeater.attr("data-category_id",self.queryDataWidget[widgetId].category_id).data("category_id",self.queryDataWidget[widgetId].category_id);$widgetRepeater.attr("data-brand_id",self.queryDataWidget[widgetId].brand_id).data("brand_id",self.queryDataWidget[widgetId].brand_id);dataForm=null;widgetId=null;self.loadDataWidget($widgetRepeater)}else{$form.submit()}}$widget=null;$widgetRepeater=null;$form=null})})},handleClickStarRate(){$(this.config.selectorEventClickStarRate).find("span").click(function(){let index=$(this).index();let siblings=$(this).siblings("span");siblings.map((key,el)=>{let indexTmp=$(el).index();if(indexTmp<index){$(el).css("--star-rate","100%")}else{$(el).css("--star-rate","0%")}});$(this).css("--star-rate","100%");let input=$(this).siblings("input").first();$(input).val(index+1)})},renderWidget($widgetRender,resp,source_html_default){if($widgetRender.data("render")&&$widgetRender.data("render").length>0){if(($widgetRender.hasClass("w30s-widget-repeater")||$widgetRender.hasClass("w30s-widget-slider")||$widgetRender.hasClass("w30s-widget-filter-select"))&&$widgetRender.closest(".w30s-widget-tab").length>0&&!_.isEmpty($widgetRender.closest(".w30s-widget-tab").data("render"))){let class_tmp=".w30s-widget-"+$widgetRender.data("id");let $objhandlebars=$($("#w30s__"+$widgetRender.closest(".w30s-widget-tab").data("render")).html());source_html_default=$objhandlebars.find(class_tmp)[0].outerHTML;this.setDataSlider($objhandlebars.find(class_tmp))}let html=$(template.render(resp,$widgetRender.data("render"),undefined,source_html_default));let hasRemoveWidgetOld=false;$widgetRender.find(".widget-loader").remove();if($widgetRender.hasClass("w30s-widget-repeater")){if($widgetRender.find(".w30s-repeater-box").length===0){$widgetRender.html(html.html());widgetEvent.handleChangeStyleView($widgetRender)}else{let widgetId=$widgetRender.data("id");if($widgetRender.hasClass("w30s-load-more")&&!_.isUndefined(this.queryDataWidget[widgetId].page)&&this.queryDataWidget[widgetId].page!==1){$widgetRender.find(".w30s-repeater-box").append(html.find(".w30s-repeater-box").html())}else{if(html.find(".w30s-repeater-box").length===0){$widgetRender.find(".w30s-repeater-box").html(html.html())}else{$widgetRender.find(".w30s-repeater-box").html(html.find(".w30s-repeater-box").html())}}$widgetRender.find(".w30s-widget-pagging").html(html.find(".w30s-widget-pagging").html())}html=$widgetRender;if(html.data("hide_empty_data")==1&&html.find(".w30s-repeater-box>.w30s-repeater-item").length===0){html.addClass("d-none")}else{html.removeClass("d-none")}}else{if($(html).hasClass("w30s-widget-image")){if($(html).attr("style")!=null){$widgetRender.attr("style",$(html).attr("style"));$widgetRender.data("src",$(html).data("src"))}}$widgetRender.html(html.html());html=$widgetRender;if(html.hasClass(this.config.selectorWidgetSlider.replace(".",""))){let dataSlider=_.findWhere(DataStorage.get("dataSlider",[]),{id:$widgetRender.data("id")});if(dataSlider){this.handleSlider(html,dataSlider)}}}this.replaceSvgChild(html);this.handleHideParentPriceDiscount(html);this.handleHideOptionProduct(html);if(hasRemoveWidgetOld){$widgetRender.remove()}return html}return null},handleFullHeight($html){let innerHeight=window.innerHeight+"px";$html.find(this.config.selectorSettingFullHeight).each((idx,el)=>{$(el).css({height:innerHeight})})},handleClickAddNumberPhoneTongDai($html){let self=this;$html.find(this.config.selectorEventClickAddNumberPhoneTongDai).click(function(e){e.preventDefault();let number_phone=$(this).data("product_id");let msg=$(this).data("event_add_number_msg");if(msg&&msg!=""){alert(msg)}$(self.config.selectorEventClickAddServiceTongDai).each((idx,el)=>{$(el).data("number_phone",number_phone)});let $section=$(self.config.selectorEventClickAddServiceTongDai).first().closest(".w30s-section");if($section.length>0){helper.scrollToElement($section,50,self.timeScroll)}})},handleClickAddServiceTongDai($html){$html.find(this.config.selectorEventClickAddServiceTongDai).click(function(e){let url=$(this).attr("href");let number=$(this).data("number_phone");if(number){$(this).attr("href",url+"?dauso="+number)}})},handleClassCustomListView($html){$html.find(".w30s-repeater-item:first-child "+this.config.selectorClassNameCustomListView).each(function(){if($(this).find("textarea").length>0){let data=$(this).data();let dataSetting=$(this).find("textarea").html();dataSetting=JSON.parse(dataSetting);dataSetting.class_name_custom.map((val,idx)=>{let $wgTmp=$(this).parents(".w30s-widget-repeater").find(".w30s-repeater-item:nth-of-type("+val.selector+") .w30s-widget-"+data.widgetId);$wgTmp.find(".w30s-content").addClass(val.class_name);if($wgTmp.find(".w30s-icon").length>0){$wgTmp.find(".w30s-icon").addClass(val.class_name)}})}})},renderWidgetTableOfContent($html){let func_set_id=($obj,key)=>{let id=$obj.attr("id");if(_.isUndefined(id)){id=moment().unix()+key}id="id-"+id;return id};$html.find(this.config.selectorWidgetTableOfContents).each((key,el)=>{let dataWidget=JSON.parse($(el).find(".w30s-data-widget").html());if(dataWidget.content_field=="list_section"){let sections_data="";let section_not=!_.isUndefined(dataWidget.content_setting.exclude_sections)?dataWidget.content_setting.exclude_sections:[];let section_class_not_unique=section_not.map(unique=>{return".w30s-unique-"+unique});section_class_not_unique=section_class_not_unique.join(",");section_class_not_unique=!_.isEmpty(section_class_not_unique)?".w30s-section-footer-end, .w30s-section-hide, "+section_class_not_unique:".w30s-section-footer-end, .w30s-section-hide";$('section[id*="w30s-section-"]'+":not("+section_class_not_unique+")").each(function(key1,elSection){let id=$(elSection).attr("id");sections_data+='<li><a href="#'+id+'">'+$(elSection).data("name")+"</a></li>"});$(el).html(sections_data)}else if(dataWidget.content_field=="widget_repeater"&&!_.isUndefined(dataWidget.content_setting.widget_title_unique)){let html="";$('.w30s-widget-title[data-widget-unique="'+dataWidget.content_setting.widget_title_unique+'"]').each(function(key1,elwidget){let id=$(elwidget).attr("id");if(_.isUndefined(id)){id=moment().unix()+key1+parseInt(dataWidget.content_setting.widget_title_unique);$(this).attr("id","id-"+id)}html+='<li><a href="#id-'+id+'">'+$(elwidget).text()+"</a></li>"});$(el).find("ul").html(html)}else if(dataWidget.content_field=="tag_heading"){let html="";let data_heading=[];let heading_item={};let $selectorAll=$(".w30s-widget-text").find("h2,h3,h4,h5,h6");$selectorAll.each(function(key){let number_heading=$(this).prop("tagName").replace("H");number_heading=parseInt(number_heading);let number_heading_prev=number_heading--;let unique=$(this).closest(".w30s-widget-text").data("widget-unique");unique=parseInt(unique);let id_tmp=func_set_id($(this),unique+key);if($(this).prop("tagName")=="H2"&&!_.isEmpty(heading_item)){data_heading.push(heading_item);heading_item={}}if($(this).prop("tagName")=="H2"){$(this).attr("id",id_tmp);heading_item={tag_name:$(this).prop("tagName"),name:$(this).text(),id:id_tmp,H3s:[],H4s:[],H5s:[],H6s:[]}}if(!_.isEmpty(heading_item)&&_.contains(["H3","H4","H5","H6"],$(this).prop("tagName"))){if($(this).prop("tagName")=="H3"||!_.isEmpty(heading_item["H"+number_heading_prev+"s"])){$(this).attr("id",id_tmp);heading_item[$(this).prop("tagName")+"s"].push({name:$(this).text(),id:id_tmp})}}if(key+1==$selectorAll.length&&!_.isEmpty(heading_item)){data_heading.push(heading_item);heading_item={}}});let func_data_content=(item,number_heading)=>{let html_tmp="";if(number_heading<=6){let items=item["H"+number_heading+"s"];number_heading++;items.map(item_tmp=>{html_tmp+='<li><a href="#'+item_tmp.id+'">'+item_tmp.name+"</a>";if(item["H"+number_heading+"s"].length>0){html_tmp+="<ul>";html_tmp+=func_data_content(item,number_heading);html_tmp+="</ul>"}html_tmp+="</li>"})}return html_tmp};data_heading.map(item=>{html+='<li><a href="#'+item.id+'">'+item.name+"</a>";if(item.H3s.length>0){html+="<ul>";html+=func_data_content(item,3);html+="</ul>"}html+="</li>"});$(el).find("ul").html(html)}});this.handleClickWidgetTableOfContents($html)},handleClickWidgetTableOfContents($html){$html.find(this.config.selectorWidgetTableOfContents).find("a").click(function(e){e.preventDefault();e.stopPropagation();$(this).closest("li").addClass("active");$(this).closest("li").siblings().removeClass("active");let id=$(this).attr("href");helper.scrollToElement($(id),20,500)})},handleSaveClassifiedNewsSave($html){let self=this;$html.find(self.config.selectorAddClassifiedNewsSave).on("click",function(e){e.preventDefault();var data=$(this).data();if(data.hasOwnProperty("classified_news_id")){loader.showLoader();let id=data.classified_news_id;$.when(loader.postAjax(self.config.urlClassifiedNewsSave,{classified_news_id:id})).then(function(resp){loader.hideLoader(function(){if(resp.result){core.showSuccess(resp.message)}else{core.showError(resp.message)}})})}})},handleRemoveClassifiedNewsSave:function($html){var self=this;$html.find(self.config.selectorRemoveClassifiedNewsSave).off().click(function(e){e.preventDefault();(async()=>{let respConfrim=await core.confirmPromise({text:lang.classified_news_save_confirm_remove});if(respConfrim.value){loader.showLoader();let data=$(this).data();let classified_news_id=data.hasOwnProperty("classified_news_id")?data.classified_news_id:0;let resp=await loader.ajaxPromise({type:"POST",url:self.config.urlClassifiedNewsRemove,data:{classified_news_id:classified_news_id}});if(resp.result){core.showSuccess(resp.message);let html=self.renderWidget($(e.currentTarget).parents(".w30s-widget-repeater").first(),resp);if(html!==null){self.handleRemoveClassifiedNewsSave(html)}}else{core.showError(resp.message)}}})()})},initWidget3dFlipbook($html){let template={html:"/admin/assets/libs/3dflipbook/templates/default-book-view.html",links:[{rel:"stylesheet",href:"/admin/assets/libs/3dflipbook/css/font-awesome.min.css"}],styles:["/admin/assets/libs/3dflipbook/css/short-black-book-view.css"],defaultStyleSheet:function(){return'<style type="text/css"> body {color: red} </style>'},script:"/admin/assets/libs/3dflipbook/js/default-book-view.js"};if(_.isUndefined(window.PDFJS_LOCALE)){window.PDFJS_LOCALE={pdfJsWorker:"/admin/assets/libs/3dflipbook/js/pdf.worker.js",pdfJsMapUrl:"cmaps"}}let data3DFlipBook=DataStorage.get("data3DFlipBook",[]);$html.find(this.config.selectorWidget3dFlipBook).map((k,v)=>{try{let $el=$(v);let path=_.isUndefined($el.data("path_file"))?"":$el.data("path_file");let data=_.findWhere(data3DFlipBook,{id:$el.data("id")});let config_lib=!_.isUndefined(data)&&!_.isUndefined(data.config_lib)&&_.isObject(data.config_lib)?data.config_lib:{};let config={pdf:path,template:template,propertiesCallback:function(props){$.extend(true,props,config_lib);return props}};$el.FlipBook(config)}catch(err){console.log(err)}})},handleHideParentPriceDiscount($html){let self=this;$html.find(this.config.selectorPriceDiscount).each(function(){if($(this).data("hide_unique_parent")!==undefined){$($html.find(self.config.selectorPriceDiscount).closest(".w30s-widget-unique-"+$(this).data("hide_unique_parent"))).hide()}})},handleHideOptionProduct($html){$html.find(".w30s-text-option").each(function(){if($(this).data("option_product")==""){$(this).hide()}})},handleQuickViewVideo($html){var self=this;$html.find(self.config.selectorVideoQuickView).off().click(function(e){e.preventDefault();loader.showLoader();let $obj=$(e.currentTarget);console.log($(this).data());(async()=>{let resp=await loader.ajaxPromise({url:self.config.urlQuickViewVideo,data:$(this).data()});if(!resp.result){core.showError(resp.message)}else{console.log(resp);let dataRender={content_data_widget:resp.data,content_data_page:(await widgetEvent.getDataContentPage()).data};let $sectionPopup=$("body .w30s-section-popup");if($sectionPopup.length<=0){$sectionPopup=$('<div class="w30s-section w30s-section-popup"></div>');$("body").append($sectionPopup)}let $htmlNew=$(template.render(dataRender,$obj.data("render")));$htmlNew.hide();$sectionPopup.append($htmlNew);$htmlNew.show();widgetEvent.handleHidePopup($htmlNew);widgetEvent.handleTriggerHidePopup($htmlNew);widgetEvent.initEvents($htmlNew);widgetEvent.initSliderFormHtml($htmlNew.find(".w30s-widget-slider textarea"));$htmlNew=null;$sectionPopup=null;dataRender=null}})()})}};var WidgetAnimation=function(){return WidgetAnimation.fn.init()};WidgetAnimation.fn=WidgetAnimation.prototype={config:{data:{}},init:function(){},initEvent(data){this.setPositionMarquee();try{if(!_.isUndefined(data)&&!_.isEmpty(data)){this.config.data=data}data.map(item=>{this.handleBuildAnimation(item.selector,item.class,item.type,item.config)})}catch(e){}$(window).scroll(e=>{this.runAnimationScroll($(e.currentTarget).scrollTop())});this.runAnimationScroll($(window).scrollTop())},runAnimationScroll(scrollTop){let scroll=scrollTop+$(window).height();$(".animation-scroll").each(function(){let $obj=$(this);if(scroll>=$obj.offset().top&&scrollTop<$obj.offset().top+$obj.outerHeight()&&!$obj.hasClass($obj.data("animation"))){$obj.addClass($obj.data("animation")).removeClass("animation-scroll invisible")}})},setPositionMarquee(){$(".w30s-animation--marquee").each(function(){let $widget=$(this);$widget.removeClass("w30s-animation--marquee");let $box=$widget.parents(".w30s-widget-childs").first();if($box.length>0){if($widget.css("--w30s-animation-position-start")==1){$widget.css("--scroll-start",$box.offset().left+$box.outerWidth()-$widget.offset().left+"px");$widget.css("--scroll-end",-($widget.offset().left+$widget.outerWidth())+"px")}else{let scrollEnd=$box.offset().left+$box.outerWidth()-$widget.offset().left-$widget.outerWidth();if(scrollEnd>0){scrollEnd=-($widget.offset().left+$widget.outerWidth())}$widget.css("--scroll-end",scrollEnd+"px")}}$widget.addClass("w30s-animation--marquee")});$(".w30s-animation--marquee-vertical").each(function(){let $widget=$(this);$widget.removeClass("w30s-animation--marquee-vertical");let $box=$widget.parents(".w30s-widget-childs").first();if($box.length>0){if($widget.css("--w30s-animation-position-start")==1){$widget.css("--scroll-start",$box.offset().top+$box.outerHeight()-$widget.offset().top+"px");$widget.css("--scroll-end",-($widget.offset().top+$widget.outerHeight())+"px")}else{let scrollEnd=$box.offset().top+$box.outerHeight()-$widget.offset().top-$widget.outerHeight();if(scrollEnd>0){scrollEnd=-($widget.offset().top+$widget.outerHeight())}$widget.css("--scroll-end",scrollEnd+"px")}}$widget.addClass("w30s-animation--marquee-vertical")})},buildHtmlEffect(type){if(type.indexOf("w30s-effect-")>=0){return'<span class="w30s-effect w30s-effect-frist-'+type.replace("w30s-effect-","")+'"></span>'}return""},handleBuildAnimation(Selector,classAnimation,typeAction,dataConfig){let $domSelector=$(Selector);if(classAnimation!==""){if($(Selector).hasClass("w30s-widget-popup")&&$(Selector).find(">.w30s-modal-dialog").length>0){$domSelector=$(Selector).find(">.w30s-modal-dialog")}if(!dataConfig.hasOwnProperty("duration")){dataConfig.duration=1500}if(!Number.isInteger(dataConfig.duration)){dataConfig.duration=parseInt(dataConfig.duration.replace("s",""))*1e3}if($domSelector.length>0&&typeAction!==""){if(classAnimation.indexOf("w30s-effect-")>=0){$domSelector.find(">.w30s-effect").remove();$domSelector.prepend(this.buildHtmlEffect(classAnimation))}switch(typeAction){case"load":if(dataConfig.scroll===1){$domSelector.addClass("animation-scroll invisible").data("animation",classAnimation)}else{let dataTmp={animation:classAnimation};if(!_.isUndefined(dataConfig)&&dataConfig.hasOwnProperty("duration")){dataTmp.duration=dataConfig.duration}$domSelector.addClass(classAnimation).data(dataTmp)}break;case"hover":$domSelector.addClass(classAnimation+" w30s-animation-hover").data("animation",classAnimation);$domSelector.unbind("animationstart webkitAnimationStart oAnimationStart MSAnimationStart").bind("animationstart webkitAnimationStart oAnimationStart MSAnimationStart",function(){if(!_.contains(["w30s-animation-scale-to"],classAnimation)&&classAnimation.indexOf("w30s-effect-")<0){$(this).removeClass("w30s-animation-hover")}});$domSelector.unbind("animationend webkitAnimationEnd oAnimationEnd MSAnimationEnd").bind("animationend webkitAnimationEnd oAnimationEnd MSAnimationEnd",function(){if(!_.contains(["w30s-animation-scale-to"],classAnimation)&&classAnimation.indexOf("w30s-effect-")<0){$(this).addClass("w30s-animation-hover")}});$domSelector.unbind("mouseover").mouseover(function(){if(_.contains(["w30s-animation-scale-to"],classAnimation)||classAnimation.indexOf("w30s-effect-")>=0){let $obj=$(this);if(!$obj.hasClass("w30s-animation-out")){$obj.addClass("w30s-animation-out")}}});break;case"click":$domSelector.on({mousedown:function(){$domSelector.addClass(classAnimation);setTimeout(function(){$domSelector.one({mouseup:function(){if($domSelector.hasClass(classAnimation)){$domSelector.removeClass(classAnimation)}}})},dataConfig.duration)},mouseup:function(){if($domSelector.hasClass(classAnimation)){$domSelector.removeClass(classAnimation)}}});break}}}},handleRebuildAnimation(){if(!_.isUndefined(this.config.data)&&!_.isEmpty(this.config.data)&&_.isArray(this.config.data)){let self=this;try{this.config.data.map(widgetIdx=>{if(!_.isUndefined(widgetIdx)&&!_.isUndefined(widgetIdx.class)&&!_.isEmpty(widgetIdx.class)&&$(widgetIdx.selector+":not(."+widgetIdx.class+")").length>0){self.handleBuildAnimation(widgetIdx.selector,widgetIdx.class,widgetIdx.type,widgetIdx.config)}})}catch(e){console.log(e)}}}};var SectionEvent=function(){return SectionEvent.fn.init()};SectionEvent.fn=SectionEvent.prototype={config:{urlSetDeviceInfo:"/page/set-device-info",classEventPositionFixed:"w30s-section-event-position-fixed",eventPositionFixedKey:"position-fixed"},data:{},curentDevice:"desktop",init:function(){},startInit(data){this.data=data;this.initWindowResize();if(!_.isUndefined(this.data[this.config.eventPositionFixedKey])&&!_.isEmpty(this.data[this.config.eventPositionFixedKey])){this.handleScroll($(window).scrollTop(),this.data[this.config.eventPositionFixedKey])}},getDevice(){let device="desktop";let deviceWidth=document.body.clientWidth;if(deviceWidth<=1024&&deviceWidth>768){device="1024px"}else if(deviceWidth<=768&&deviceWidth>640){device="768px"}else if(deviceWidth<=640&&deviceWidth>480){device="640px"}else if(deviceWidth<=480&&deviceWidth>375){device="480px"}else if(deviceWidth<=375&&deviceWidth>320){device="375px"}else if(deviceWidth<=320){device="320px"}return device},initWindowResize(){this.curentDevice=this.getDevice();$(window).resize(()=>{let device=this.getDevice();if(this.curentDevice!==device){this.curentDevice=device}if(!_.isUndefined(this.data[this.config.eventPositionFixedKey])&&!_.isEmpty(this.data[this.config.eventPositionFixedKey])){this.handleScroll($(window).scrollTop(),this.data[this.config.eventPositionFixedKey])}});$(window).scroll(e=>{if(!_.isUndefined(this.data[this.config.eventPositionFixedKey])&&!_.isEmpty(this.data[this.config.eventPositionFixedKey])){this.handleScroll($(e.currentTarget).scrollTop(),this.data[this.config.eventPositionFixedKey])}})},setDeviceInfo(){$.when(loader.postAjax(this.config.urlSetDeviceInfo,{device_width:document.body.clientWidth})).then(function(resp){if(resp.reload===true){window.location.reload()}})},handleScroll(offset,data){if(_.isUndefined(offset)){return}let curentDevice=this.curentDevice;if(!data.hasOwnProperty(this.curentDevice)||_.isEmpty(data[this.curentDevice])){switch(curentDevice){case"320px":curentDevice="375px";if(data.hasOwnProperty(curentDevice)&&!_.isEmpty(data[curentDevice])){break}case"375px":curentDevice="480px";if(data.hasOwnProperty(curentDevice)&&!_.isEmpty(data[curentDevice])){break}case"480px":curentDevice="640px";if(data.hasOwnProperty(curentDevice)&&!_.isEmpty(data[curentDevice])){break}case"640px":curentDevice="768px";if(data.hasOwnProperty(curentDevice)&&!_.isEmpty(data[curentDevice])){break}case"768px":curentDevice="1024px";if(data.hasOwnProperty(curentDevice)&&!_.isEmpty(data[curentDevice])){break}case"1024px":curentDevice="desktop";if(data.hasOwnProperty(curentDevice)&&!_.isEmpty(data[curentDevice])){break}break;default:curentDevice="desktop"}}if(curentDevice!=null&&data.hasOwnProperty(curentDevice)){_.mapObject(data[curentDevice],(section,offsetMain)=>{offsetMain=parseInt(offsetMain);if(offsetMain>=0&&(offset<offsetMain||offset<10)){$(section.before_remove_fixed).removeClass("position-fixed d-none w30s-opacity-0");widgetEvent.handleMenu($(section.before_remove_fixed));$(section.before_hide).addClass("d-none")}else if(offset>=offsetMain){let selector_stop_event="";if(section.hasOwnProperty("to_bottom")&&!_.isEmpty(section.to_bottom)){_.mapObject(section.to_bottom,(value,idSection)=>{if($(".w30s-unique-"+value).length>0){$(idSection).css({height:"auto"});let h=$(idSection).outerHeight();$(idSection).css({height:""});let bottom=$(".w30s-unique-"+value).offset().top;let stickyToBottom=bottom;if(offset+h>=stickyToBottom){$(idSection).css({top:"-3000px"});selector_stop_event+=(!_.isEmpty(selector_stop_event)?",":"")+idSection}else{$(idSection).css({top:""})}}})}let $sectionShow=$(section.after_scrol_show);if(!_.isEmpty(section.after_scrol_show)&&!_.isEmpty(selector_stop_event)){$sectionShow=$(section.after_scrol_show+":not("+selector_stop_event+")")}$sectionShow.removeClass("w30s-opacity-0 d-none").addClass("position-fixed");$(section.after_scrol_hide).addClass("w30s-opacity-0");widgetEvent.handleMenu($sectionShow);if(_.isUndefined($sectionShow.data("has-first"))){$sectionShow.data("has-first",1);widgetEvent.handleWidgetSubmenuV4($sectionShow)}}})}}};var W30sMap=function(){return W30sMap.fn.init()};W30sMap.fn=W30sMap.prototype={init:function(){},initMap:function(useInput){var _this=this;if(typeof _active_lang==="undefined"){_active_lang="vn"}if(_is_demo){_api_key="AIzaSyDyxNK6shHjCa0a2ATwbs2kbsur0QTcMMI"}else{if(typeof _api_key==="undefined"||_api_key===""){_api_key="AIzaSyBUqJrD80qnxzg3_L99iwCcba8g9xfzOrQ"}}$.getScript("https://maps.google.com/maps/api/js?key="+_api_key+" & libraries=places & region="+_active_lang+" & language="+_active_lang,function(){var map_canvass=$(".w30s__map-item-canvas");map_canvass.each(function(idx,item){if(typeof useInput!=="undefined"&&useInput===true){_this.mapInitializeInput($(this)[0])}else{_this.mapInitialize($.extend({},{map:null,marker:null,geocoder:null,infoWindow:null,map_canvas:item},$(this).data()))}})})},mapInitialize:function(dataMap){try{let defaultLabelAdr="Địa chỉ:";if(typeof dataMap.label_address!="undefined"){defaultLabelAdr=dataMap.label_address}if(dataMap.latitude===""||dataMap.longitude===""||dataMap.latitude===null||dataMap.longitude===null||dataMap.latitude==="0"||dataMap.longitude==="0"){dataMap.latitude="10.777067";dataMap.longitude="106.688700";dataMap.address="Công ty P.A Việt Nam"}if(typeof dataMap.zoom!="undefined"){dataMap.zoom=parseInt(dataMap.zoom)}else{dataMap.zoom=15}dataMap.map=new google.maps.Map(dataMap.map_canvas,{scrollwheel:false,zoom:dataMap.zoom,center:new google.maps.LatLng(dataMap.latitude,dataMap.longitude),mapTypeId:google.maps.MapTypeId.ROADMAP});var position=new google.maps.LatLng(dataMap.latitude,dataMap.longitude);dataMap.marker=new google.maps.Marker({map:dataMap.map,position:position,draggable:!dataMap.readonly});dataMap.map.setCenter(position);dataMap.infoWindow=new google.maps.InfoWindow;dataMap.infoWindow.setContent('<span id="address"><b>'+defaultLabelAdr+"</b> "+dataMap.address+"</span>");dataMap.infoWindow.open(dataMap.map,dataMap.marker);dataMap.geocoder=new google.maps.Geocoder}catch(error){console.error(error)}},mapInitializeInput:function(map_canvas_arr){let self=this;let pamap={map:null,marker:null,geocoder:null,infoWindow:null,map_canvas:map_canvas_arr,inputLat:document.getElementById(map_canvas_arr.getAttribute("data-id-latitude")),inputLng:document.getElementById(map_canvas_arr.getAttribute("data-id-longitude")),inputAddr:document.getElementById(map_canvas_arr.getAttribute("data-id-address")),inputZoom:document.getElementById(map_canvas_arr.getAttribute("data-id-zoom")),readonly:Boolean(map_canvas_arr.getAttribute("readonly"))};pamap.latitude=typeof pamap.inputLat!=="undefined"&&pamap.inputLat!==null?pamap.inputLat.value:null;pamap.longitude=typeof pamap.inputLng!=="undefined"&&pamap.inputLng!==null?pamap.inputLng.value:null;pamap.address=typeof pamap.inputAddr!=="undefined"&&pamap.inputAddr!==null?pamap.inputAddr.value:null;pamap.zoom=typeof pamap.inputZoom!=="undefined"&&pamap.inputZoom!==null?pamap.inputZoom.value:15;this.mapInitialize(pamap);console.log(pamap);if(typeof pamap.inputLat!=="undefined"&&pamap.inputLat!==null){pamap.inputLat.addEventListener("change",function(){self.showLocation(pamap.inputLat,"lat",pamap)})}if(typeof pamap.inputLng!=="undefined"&&pamap.inputLng!==null){pamap.inputLng.addEventListener("change",function(){self.showLocation(pamap.inputLng,"lng",pamap)})}if(typeof pamap.inputAddr!=="undefined"&&pamap.inputAddr!==null){pamap.inputAddr.addEventListener("change",function(){self.showLocation(pamap.inputAddr,"addr",pamap)})}if(typeof pamap.inputZoom!=="undefined"&&pamap.inputZoom!==null){pamap.inputZoom.addEventListener("change",function(){self.showLocation(pamap.inputZoom,"zoom",pamap)})}let callback=pamap.map_canvas.getAttribute("data-onload");if(typeof window[callback]==="function"){window[callback](pamap[index])}},showLocation:function(input,type,pamap){if(typeof input==="string"){input=document.querySelector(input)}if(!(input instanceof HTMLInputElement)){console.error("showLocation: parameter input must be a input tag or string selector.");console.log(input);return}if(type==="zoom"){pamap.map.setZoom(parseInt(input.value));return}let address=input.value;let geocodeOption={address:address};if(type==="lat"||type==="lng"){let latLng=new google.maps.LatLng(pamap.inputLat.value,pamap.inputLng.value);geocodeOption={latLng:latLng}}else if(geocodeOption.address===""){console.log("showLocation: skip.");return}if(pamap.marker!==null){pamap.marker.setMap(null)}pamap.geocoder.geocode(geocodeOption,function(result,status){if(status!==google.maps.GeocoderStatus.OK||result===null||result[0]===null){console.error("showLocation: Could not load map.");console.log(result);console.log(status);return}pamap.map.setCenter(result[0].geometry.location);pamap.marker=new google.maps.Marker({map:pamap.map,position:result[0].geometry.location,draggable:true});pamap.inputLat.value=result[0].geometry.location.lat();pamap.inputLng.value=result[0].geometry.location.lng();if(pamap.infoWindow!==null){if(type==="lat"||type==="lng"){address=result[0].formatted_address}pamap.infoWindow.setContent('<span id="address"><b>Địa chỉ : </b>'+address+"</span>");pamap.infoWindow.open(pamap.map,pamap.marker)}let callback=pamap.map_canvas.getAttribute("data-onmark");if(typeof window[callback]==="function"){window[callback](result[0].formatted_address)}google.maps.event.addListener(pamap.marker,"dragstart",function(){if(pamap.infoWindow!==null){pamap.infoWindow.close()}});google.maps.event.addListener(pamap.marker,"dragend",function(){getAddress(pamap)})})},renderMapEmbed($iemMap){$iemMap.parent().find("iframe").remove();let data=$iemMap.data();let params={width:"100%",height:"100%",q:data.address||"",hl:"en",t:"",z:data.zoom||15,ie:"UTF8",iwloc:"B",output:"embed"};let src="https://maps.google.com/maps?"+$.param(params);$iemMap.after('<iframe width="100%" height="100%" frameborder="0" '+'scrolling="no" marginheight="0" marginwidth="0" '+'src="'+src+'"></iframe>')}};var Product=function(){return Product.fn.init()};Product.fn=Product.prototype={queryData:{keyword:"",category_id:0},constant:{STATUS_INVENTORY_INSTOCK:1,STATUS_INVENTORY_OUTSTOCK:3,STATUS_ORDER_CONTACT:7,STATUS_ORDER_OUTSTOCK:3,STATUS_ORDER_ADD_CART:5},config:{urlRemoveView:"/product/remove-viewed-json",urlQuickView:"/product/detail-v3-json",urlListProduct:"/product/index-v3-json",selectorRemoveView:".w30s-remove-viewed",selectorQuickView:".w30s-product-quick-view",selectorSliderRange:".w30s-slider-range",selectorChangeLimit:".w30s-repeater-header .w30s-repeater-limit select",selectorChangeSort:".w30s-repeater-header .w30s-repeater-sort select"},init:function(){},startInit:function(){let $html=$("body");this.handleQuickView($html);this.handleRemoveViewed($html);this.handleChangeLimit($html);this.handleChangeSort($html)},handleChangeLimit($html){let $objLimit=$html.find(this.config.selectorChangeLimit);$objLimit.change(e=>{let $obj=$(e.currentTarget);let $widgetRender=$obj.parents(".w30s-widget-repeater").first();let widgetId=$widgetRender.data("id");let limit=parseInt($obj.val());if(limit<=0||isNaN(limit)){limit=$widgetRender.data("limit")}widgetEvent.setQueryData(widgetId,"limit",limit);widgetEvent.removeQueryData(widgetId,"page");widgetEvent.loadDataWidget($widgetRender);$widgetRender=null;widgetId=null;$obj=null;limit=null});let $widgetRender=$objLimit.parents(".w30s-widget-repeater").first();let widgetId=$widgetRender.data("id");if(!_.isUndefined(widgetEvent.queryDataWidget[widgetId])){if(!_.isUndefined(widgetEvent.queryDataWidget[widgetId].limit)&&$objLimit.find('option[value="'+widgetEvent.queryDataWidget[widgetId].limit+'"]').length>0){$objLimit.val(widgetEvent.queryDataWidget[widgetId].limit)}}$objLimit=null;$widgetRender=null;widgetId=null},handleChangeSort($html){let $objSort=$html.find(this.config.selectorChangeSort);$objSort.change(e=>{let $obj=$(e.currentTarget);let $widgetRender=$obj.parents(".w30s-widget-repeater").first();let widgetId=$widgetRender.data("id");let sortby=parseInt($obj.val());if(sortby<=0||isNaN(sortby)){widgetEvent.removeQueryData(widgetId,"sortby")}else{widgetEvent.setQueryData(widgetId,"sortby",sortby)}widgetEvent.removeQueryData(widgetId,"page");widgetEvent.loadDataWidget($widgetRender);$widgetRender=null;widgetId=null;$obj=null;sortby=null});let $widgetRender=$objSort.parents(".w30s-widget-repeater").first();let widgetId=$widgetRender.data("id");if(!_.isUndefined(widgetEvent.queryDataWidget[widgetId])){if(!_.isUndefined(widgetEvent.queryDataWidget[widgetId].sortby)){$objSort.val(widgetEvent.queryDataWidget[widgetId].sortby)}}$objSort=null;$widgetRender=null;widgetId=null},handleRemoveViewed:function($html){let self=this;$html.find(self.config.selectorRemoveView).off().click(function(e){e.preventDefault();let $elRepeart=$(this).closest(".w30s-widget-repeater");let dataRepeart=$elRepeart.data();(async()=>{let respConfrim=await core.confirmPromise({text:lang.product_viewed_confrim_remove});if(respConfrim.value){loader.showLoader();let data=$(this).data();data.product_id=data.hasOwnProperty("product_id")?data.product_id:0;data.widget_repeater_id=dataRepeart.id;let resp=await loader.ajaxPromise({type:"POST",url:self.config.urlRemoveView,cache:false,data:data});if(resp.result){core.showSuccess(resp.message);let html=widgetEvent.renderWidget($(e.currentTarget).parents(".w30s-widget-repeater").first(),resp);if(html!==null){self.handleRemoveViewed(html)}}else{core.showError(resp.message)}}})()})},handleQuickView:function($html){var self=this;$html.find(self.config.selectorQuickView).off().click(function(e){e.preventDefault();loader.showLoader();let $obj=$(e.currentTarget);if(widgetEvent.Cart!==null){widgetEvent.Cart.quantity=1}(async()=>{let resp=await loader.ajaxPromise({url:self.config.urlQuickView,data:$(this).data()});if(!resp.result){core.showError(resp.message)}else{resp.data.constant=self.constant;let dataRender={content_data_widget:resp.data,content_data_page:(await widgetEvent.getDataContentPage()).data};let $sectionPopup=$("body .w30s-section-popup");if($sectionPopup.length<=0){$sectionPopup=$('<div class="w30s-section w30s-section-popup"></div>');$("body").append($sectionPopup)}let $htmlNew=$(template.render(dataRender,$obj.data("render")));$htmlNew.hide();$sectionPopup.append($htmlNew);$htmlNew.show();widgetEvent.handleHideParentPriceDiscount($htmlNew);widgetEvent.handleHidePopup($htmlNew);widgetEvent.handleTriggerHidePopup($htmlNew);widgetEvent.initEvents($htmlNew);widgetEvent.initSliderFormHtml($htmlNew.find(".w30s-widget-slider textarea"));if(typeof variantQuickView!="undefined"){variantQuickView.clearData();variantQuickView.setData({images:resp.data.image_list,options:resp.data.variant_options,variants:resp.data.variants,variantIdDefault:resp.data.variantIdDefault});variantQuickView.setup($htmlNew)}if(widgetEvent.Cart!==null){widgetEvent.Cart.handleAddCompare($sectionPopup);widgetEvent.Cart.handleFavorite($sectionPopup);widgetEvent.Cart.handleAddCart($sectionPopup);widgetEvent.Cart.handleSetQuantity($sectionPopup)}$htmlNew=null;$sectionPopup=null;dataRender=null}})()})}};var Member=function(){return Member.fn.init()};Member.fn=Member.prototype={config:{urlChangePassword:"/member/changePasswordJson",urlUpdateMember:"/member/updateMemberJson",selectorChangePassword:".w30s-change-password",selectorUpdateMember:".w30s-update-member"},init(){},handleUpdateMember($html){let self=this;var $obj=$html.find(this.config.selectorUpdateMember);let $form=$obj.parents("form").first();let $inputForm=$form.find("input");$obj.off().click(function(e){e.preventDefault();(async()=>{loader.showLoader();let data=self._UpdateMemberValidate($form.serializeObject());if(!data.pass){core.showError(lang.member_change_info_fail);core.showErrorForm(data.error,$form);loader.hideLoader()}else{let resp=await loader.ajaxPromise({type:"POST",url:self.config.urlUpdateMember,data:data.data});if(resp.result){core.showSuccess(resp.message);if(resp.data.is_auth_phone){window.location.href=`/member/phone-authentication/${resp.data.member.id}`}}else{if(resp.hasOwnProperty("message")){core.showError(resp.message)}if(resp.hasOwnProperty("error")){core.showErrorForm(resp.error,$form)}}}})()});if($inputForm.length>0){$inputForm.on("keydown",function(e){if(e.which===13){$(selector).trigger("click")}})}},handleChangePassword($html){let self=this;var $obj=$html.find(this.config.selectorChangePassword);let $form=$obj.parents("form").first();let $inputForm=$form.find("input");$obj.off().click(function(e){e.preventDefault();(async()=>{loader.showLoader();let data=self._ChangePasswordValidate($form.serializeObject());if(!data.pass){core.showError(lang.member_change_password_fail);core.showErrorForm(data.error,$form);loader.hideLoader()}else{let resp=await loader.ajaxPromise({type:"POST",url:self.config.urlChangePassword,data:data.data});if(resp.result){core.showSuccess(resp.message);widgetEvent.clearForm($form)}else{if(resp.hasOwnProperty("message")){core.showError(resp.message)}if(resp.hasOwnProperty("error")){core.showErrorForm(resp.error,$form)}}}})()});if($inputForm.length>0){$inputForm.on("keydown",function(e){if(e.which===13){$(selector).trigger("click")}})}},_UpdateMemberValidate(formData){let data={pass:true,error:{}};if(formData.fullname.length===0){data.error.fullname=lang.error_fullname_required;data.pass=false}data.data=formData;return data},_ChangePasswordValidate(formData){let data={pass:true,error:{}};if(formData.password_old.length===0){data.error.password_old=lang.error_password_old_required;data.pass=false}if(formData.password.length===0){data.error.password=lang.error_password_not_regex;data.pass=false}if(formData.password.match(".*^(?=.{6,})(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9]).*")===null||formData.password.match(".*^(?=.{6,})(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9]).*")<1){data.error.password=lang.error_password_not_regex;data.pass=false}formData.password_old=MD5("bang.vn"+$.trim(formData.password_old));formData.password=MD5("bang.vn"+$.trim(formData.password));formData.password_confirm=MD5("bang.vn"+$.trim(formData.password_confirm));if(formData.password!==formData.password_confirm){data.error.password_confirm=lang.error_password_confirm_invalid;data.pass=false}data.data=formData;return data}};var Realty=function(){return Realty.fn.init()};Realty.fn=Realty.prototype={queryData:{keyword:"",category_id:0},constant:{FILTER_NAME:"name",FILTER_PROVINCE:"province",FILTER_DISTRICT:"district",FILTER_WARD:"ward",FILTER_STREET:"street",FILTER_DIRECT_HOUSE:"direct_house",FILTER_AREA:"area",FILTER_PRICE:"price",FILTER_PRICE_UNIT_ID:"price_unit_id",FILTER_TYPE:"type",FILTER_CATEGORY_ID:"category_id",FILTER_CONTACT_FULLNAME:"contact_fullname",FILTER_CONTACT_TELEPHONE:"contact_telephone"},config:{urlAddFormClassifiedNews:"/classified-news/save-form-json",urlDeleteClassifiedNews:"/classified-news/delete-json",selectorFrom:".w30s-form-post-realty form",selectorSelect:".w30s-realty-select",selectorSubmitFormRealty:".w30s-submit-post-realty",selectorClearFormRealty:".w30s-clear-post-realty",selectorBoxUploadMultiImage:".w30s-group-upload-multi-image",selectorBoxReviewMultiImage:".w30s-box-review-multi-image",selectorBtnUploadImg:".w30s-upload-image-btn",selectorBtnDelelteRealty:".w30s-delete-realty",selectorInputAddressMap:"#map_data_address",classSelect:"w30s-realty-select",limitImage:5,files:[],image:""},init:function(){let self=this;let adress=$(".form-control:disabled, .form-control[readonly]").val();$(".w30s-widget-map .w30s-map").each(function(){self.renderMapEmbed($(this),adress)})},renderMapEmbed($iemMap,value){console.log("2222");$iemMap.parent().find("iframe").remove();let params={width:"100%",height:"100%",q:value||"",hl:"en",t:"",z:15,ie:"UTF8",iwloc:"B",output:"embed"};let src="https://maps.google.com/maps?"+$.param(params);$iemMap.after('<iframe width="100%" height="350px" frameborder="0" '+'scrolling="no" marginheight="0" marginwidth="0" '+'src="'+src+'"></iframe>')},startInitForm:function(){this.handleChangeAddress($("body").find(this.config.selectorFrom).first());this.handleUploadMultiImage($("body").find(this.config.selectorFrom).first());this.initCkeditor($("body").find(this.config.selectorFrom).first(),"content");this.handleSubmitRealty($("body").find(this.config.selectorFrom).first());this.handleClearForm($("body").find(this.config.selectorFrom).first());map.initMap(true)},startInitList:function(){let self=this;$("body").find("table").each(function(){let $table=$(this);$table.find(self.config.selectorBtnDelelteRealty).unbind().click(function(){let $parentColum=$(this).closest("tr").first();if(!_.isUndefined($parentColum.data("id"))&&!_.isEmpty($parentColum.data("id").toString())){self.handleDelete(parseInt($parentColum.data("id")))}})})},handleChangeAddress($html,config){let self=this;let $form=$html;if(!$html.hasClass(this.config.classSelect)){$html=$html.find(this.config.selectorSelect)}else{$form=$html.parents("form").first()}$html.each(function(){let $select=$(this);let callback=null;$(this).selectpicker($.extend(true,{width:"100%",liveSearch:1},config)).on("changed.bs.select",function(e,clickedIndex,newValue,oldValue){let query={};let $target=null;let type="";let isLoadMap=false;switch($select.attr("name")){case self.constant.FILTER_PROVINCE:type=self.constant.FILTER_DISTRICT;query.province_id=$(e.currentTarget).val();$target=$form.find(self.config.selectorSelect+'[name="'+self.constant.FILTER_DISTRICT+'"]');isLoadMap=true;break;case self.constant.FILTER_DISTRICT:type=self.constant.FILTER_WARD;query.district_id=$(e.currentTarget).val();$target=$form.find(self.config.selectorSelect+'[name="'+self.constant.FILTER_WARD+'"]');callback=(()=>{self.loadDataAddress($form.find(self.config.selectorSelect+'[name="'+self.constant.FILTER_STREET+'"]'),self.constant.FILTER_STREET,query)});isLoadMap=true;break;case self.constant.FILTER_WARD:case self.constant.FILTER_STREET:isLoadMap=true;break;case self.constant.FILTER_TYPE:self.handleGetCategoryByType($form.find(self.config.selectorSelect+'[name="'+self.constant.FILTER_CATEGORY_ID+'"]'),$(e.currentTarget).val());break}self.loadDataAddress($target,type,query,callback);if(isLoadMap){self.handleReloadMap($form)}})})},loadDataAddress:async function($target,type,data,callback){if($target!==null&&$target.length>0){$target.html("");let resp=await loader.ajaxPromise({url:"/address/get-address-v3-json",data:$.extend(true,{type:type},data)});if(resp.result&&!_.isEmpty(resp.items)){resp.items.map(item=>{$target.append("<option value="+item.id+" data-id="+item.id+">"+item.name+"</option>")})}$target.selectpicker("destroy");this.handleChangeAddress($target);if(!_.isUndefined(callback)&&_.isFunction(callback)){callback()}}},handleGetCategoryByType:async function($element,type){let self=this;if($element.length>0){let resp=await loader.ajaxPromise({url:"/classified-news-category/get-data-by-child-type-json",data:{type:type}});if(resp.result&&!_.isEmpty(resp.items)){$element.each(function(){let $select=$(this);$select.html("");resp.items.map(item=>{$select.append("<option value="+item.id+">"+item.name+"</option>")});$select.selectpicker("destroy");self.handleChangeAddress($select)})}}},handleClearForm($form){$form.find(this.config.selectorClearFormRealty).unbind().click(function(){$form.find(".w30s-error").html("");$form[0].reset();$form.find("input, textarea, select").not(":submit, :reset").val("")})},handleUploadMultiImage($form){let self=this;let boxUpload=$form.find(self.config.selectorBoxUploadMultiImage).first();let boxReview=$form.find(self.config.selectorBoxReviewMultiImage).first();let inputUpFile=boxUpload.find(".image_upload");this.config.limitImage=inputUpFile.data("allow");this.config.image=boxReview.find('input[data-main="1"]').val();$form.find(this.config.selectorBtnUploadImg).click(function(e){if(self.config.limitImage<=0){core.showError(lang.error_realty_post_limit_upload_file)}else{inputUpFile.trigger("click")}});inputUpFile.on("change",function(e){if(this.files&&this.files.length>0){if(this.files.length>self.config.limitImage){core.showError(lang.error_realty_post_limit_upload_file)}else{self.config.files=self.config.files.concat(Array.from(this.files));_.map(this.files,file=>{boxReview.append('<div class="w30s-image-review show">'+'<label><input type="checkbox"/><span class="item-checkbox"></span></label>'+'<i class="far fa-trash-alt" title="'+lang.remove_image+'"></i>'+'<input type="hidden" name="image_name[]" value="'+file.name+'"/>'+"</div>");let $target=boxReview.find(".w30s-image-review").last();$target.append('<image src="'+URL.createObjectURL(file)+'"/>');URL.revokeObjectURL(this.src);if(boxReview.find('input[type="checkbox"]:checked').length<=0){$target.find('input[type="checkbox"]').prop("checked",true);self.config.image=file.name}--self.config.limitImage});self.eventReviewImage($form)}}});this.eventReviewImage($form)},eventReviewImage($form){let self=this;let $boxReview=$form.find(this.config.selectorBoxReviewMultiImage);$boxReview.find(".w30s-image-review").each(function(){let $target=$(this);$target.find('input[type="checkbox"]').unbind().on("change",function(){self.config.image=$target.find('[name="image_name[]"]').val();$target.closest(".w30s-image-review").siblings().find('input[type="checkbox"]:checked').prop("checked",false);$(this).prop("checked",true)});$target.find("i").unbind().on("click",function(){$target.remove();if(self.config.limitImage<5){++self.config.limitImage}if($boxReview.find('input[type="checkbox"]').length<=0){self.config.image=""}self.config.files=_.filter(self.config.files,file=>{return file.name!==$target.find('[name="image_name[]"]').val()});if($boxReview.find('input[type="checkbox"]:checked').length<=0){$boxReview.find('.w30s-image-review input[type="checkbox"]').first().prop("checked",true).trigger("change")}})})},handleSubmitRealty($form){let self=this;$form.submit(function(e){e.preventDefault();loader.showLoader();let data=new FormData(this);let fieldRequired=[self.constant.FILTER_NAME,self.constant.FILTER_PROVINCE,self.constant.FILTER_DISTRICT,self.constant.FILTER_TYPE,self.constant.FILTER_CATEGORY_ID,self.constant.FILTER_CONTACT_FULLNAME,self.constant.FILTER_CONTACT_TELEPHONE,self.constant.FILTER_PRICE_UNIT_ID];let isSave=true;let errors={};$form.find(".w30s-error").html();data.set("content",CKEDITOR.instances["content"].getData());data.set("location",$(this).find('[name="location"]').val());data.set("image",self.config.image);fieldRequired.map(item=>{if(data.get(item)===null||data.get(item).length<=0){errors[item]=lang.forms_required;isSave=false}});if((data.get(self.constant.FILTER_PRICE_UNIT_ID)===null||data.get(self.constant.FILTER_PRICE_UNIT_ID).length<=0)&&data.get(self.constant.FILTER_PRICE)!==null&&data.get(self.constant.FILTER_PRICE_UNIT_ID).length>0&&data.get(self.constant.FILTER_PRICE_UNIT_ID)>0&&isSave){errors[self.constant.FILTER_PRICE_UNIT_ID]=lang.forms_required;isSave=false}if(data.get(self.constant.FILTER_CONTACT_TELEPHONE)!==null&&data.get(self.constant.FILTER_CONTACT_TELEPHONE).length>0&&isSave&&data.get(self.constant.FILTER_CONTACT_TELEPHONE).match(/^(\+\d\d{8,20})|(0\d\d{8,10})$/)===null){errors[self.constant.FILTER_CONTACT_TELEPHONE]=lang.realty_advance_error_phone_syntax;isSave=false}let listImageNotDelete=[];if($(self.config.selectorBoxReviewMultiImage).find('input[name="image_name[]"]').length>1){$(self.config.selectorBoxReviewMultiImage).find('input[name="image_name[]"]').each(function(){if($(this).data("id")!=undefined&&$(this).data("id")>0&&$(this).parents(".w30s-image-review").find('input[type="checkbox"]:checked').length<=0){listImageNotDelete.push($(this).data("id"))}})}_.map(self.config.files,(item,key)=>{data.set("images["+key+"]",item,item.name)});data.set("image_not_delete",listImageNotDelete.join(","));isSave=true;if(isSave){$.ajax({url:self.config.urlAddFormClassifiedNews,type:"POST",data:data,success:function(resp){if(resp.result){core.showSuccess(lang.realty_post_success);$form.find(self.config.selectorClearFormRealty).trigger("click");if(resp.hasOwnProperty("url")&&!_.isEmpty(resp.url)){window.location.href=resp.url}loader.hideLoader()}else{if(resp.message!==undefined){core.showError(resp.message)}else{core.showError(lang.realty_post_failed)}if(resp.error!==undefined&&resp.error!==null){core.showErrorForm(resp.error,$form)}loader.hideLoader()}},cache:false,contentType:false,processData:false,error:function(){loader.hideLoader()}})}else{loader.hideLoader();core.showError(lang.realty_post_failed);core.showErrorForm(errors,$form)}})},initCkeditor($form,attr){let config={language:"vi",height:"350px",skin:"office2013",allowedContent:true,filebrowserBrowseUrl:"/ckfinder3/ckfinder.html",filebrowserImageBrowseUrl:"/ckfinder3/ckfinder.html",filebrowserFlashBrowseUrl:"/ckfinder3/ckfinder.html",filebrowserUploadUrl:"/ckfinder3/core/connector/php/connector.php?command=QuickUpload&type=files",filebrowserImageUploadUrl:"/ckfinder3/core/connector/php/connector.php?command=QuickUpload&type=images",filebrowserFlashUploadUrl:"/ckfinder3/core/connector/php/connector.php?command=QuickUpload",toolbar:[{name:"styles",items:["Font","FontSize","-"]},{name:"basicstyles",items:["Bold","Italic","Underline","Strike","Subscript","Superscript"]},{name:"colors",items:["TextColor","BGColor"]},{name:"cleanup",items:["CopyFormatting","RemoveFormat"]},"/",{name:"paragraph",items:["-","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock"]},{name:"clipboard",items:["SelectAll","ShowBlocks","-","Paste","PasteText","PasteFromWord","-","Undo","Redo"]},{name:"links",items:["Link","Unlink"]}]};$form.find(".w30s-ckeditor").each(function(){let e=CKEDITOR.replace(attr,config);CKFinder.setupCKEditor(e,"/ckfinder3/")})},handleDelete(id){(async()=>{let resp=await loader.ajaxPromise({type:"POST",url:this.config.urlDeleteClassifiedNews,data:{id:id}});if(resp.result){core.showSuccess(lang[resp.message]);window.location.reload(true)}else{core.showError(lang[resp.message])}})()},handleReloadMap($html){let address="";let data={};let $province=$html.find('[name="'+this.constant.FILTER_PROVINCE+'"]');let $district=$html.find('[name="'+this.constant.FILTER_DISTRICT+'"]');let $ward=$html.find('[name="'+this.constant.FILTER_WARD+'"]');let $street=$html.find('[name="'+this.constant.FILTER_STREET+'"]');let $inputAdrMap=$html.find(this.config.selectorInputAddressMap);let self=this;if($inputAdrMap.length>0&&$province.length>0){data.province=$province.find('option[data-id="'+$province.val()+'"]');if(data.province.length>0&&!_.isEmpty(data.province.text())){address+=data.province.text();if($district.length>0){data.district=$district.find('option[data-id="'+$district.val()+'"]');if(data.district.length>0&&!_.isEmpty(data.district.text())){address=data.district.text()+", "+address;if($ward.length>0){data.ward=$ward.find('option[data-id="'+$ward.val()+'"]');if(data.ward.length>0&&!_.isEmpty(data.ward.text())){address=data.ward.text()+", "+address;if($street.length>0){data.street=$street.find('option[data-id="'+$street.val()+'"]');if(data.street.length>0&&!_.isEmpty(data.street.text())){address=data.street.text()+", "+address}}}}}}}$html.find('input[name="location"]').val(address).change();$inputAdrMap.val(address);$(".w30s-widget-map .w30s-map").each(function(){self.renderMapEmbed($(this),address)})}}};